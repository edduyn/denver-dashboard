<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Denver Satellite Dashboard</title>
    <link rel="manifest" href="data:application/json,{&quot;name&quot;:&quot;Denver Dashboard&quot;,&quot;short_name&quot;:&quot;Denver&quot;,&quot;display&quot;:&quot;standalone&quot;}">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); color: #fff; min-height: 100vh; }
        
        /* Login Screen */
        .login-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; padding: 20px; }
        .login-box { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border-radius: 20px; padding: 40px; text-align: center; max-width: 400px; width: 100%; }
        .login-box h1 { color: #f59e0b; margin-bottom: 10px; font-size: 1.8em; }
        .login-box p { color: #94a3b8; margin-bottom: 30px; }
        .login-box input { width: 100%; padding: 15px; border: 2px solid #334155; background: #1e293b; color: #fff; border-radius: 10px; font-size: 16px; margin-bottom: 15px; }
        .login-box input:focus { outline: none; border-color: #f59e0b; }
        .login-box button { width: 100%; padding: 15px; background: #f59e0b; color: #000; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; }
        .login-box button:hover { background: #d97706; }
        .error-msg { color: #ef4444; margin-top: 10px; display: none; }
        
        /* Main Dashboard */
        .dashboard { display: none; min-height: 100vh; }
        .header { background: rgba(0,0,0,0.3); padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
        .header-left { display: flex; align-items: center; gap: 15px; }
        .logo { height: 40px; }
        .header h1 { font-size: 1.3em; color: #f59e0b; }
        .header-right { display: flex; gap: 10px; align-items: center; }
        .header-btn { padding: 8px 15px; border-radius: 8px; border: none; cursor: pointer; font-size: 14px; font-weight: 500; }
        .btn-full { background: #3b82f6; color: #fff; }
        .btn-rotate { background: #10b981; color: #fff; }
        .btn-lock { background: #64748b; color: #fff; }
        .status-indicator { padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .status-active { background: #10b981; color: #fff; }
        .status-paused { background: #ef4444; color: #fff; }
        
        /* Tabs */
        .tabs { display: flex; background: rgba(0,0,0,0.2); padding: 10px; gap: 5px; overflow-x: auto; }
        .tab { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 500; white-space: nowrap; transition: all 0.3s; }
        .tab:hover { background: rgba(255,255,255,0.1); }
        .tab.active { background: #f59e0b; color: #000; }
        .tab-goals { border-left: 3px solid #8b5cf6; }
        .tab-actions { border-left: 3px solid #ef4444; }
        .tab-overview { border-left: 3px solid #3b82f6; }
        .tab-employees { border-left: 3px solid #10b981; }
        .tab-workorders { border-left: 3px solid #f97316; }
        .tab-quotes { border-left: 3px solid #ec4899; }
        .tab-quality { border-left: 3px solid #06b6d4; }
        .tab-rankings { border-left: 3px solid #eab308; }
        .tab-wip { border-left: 3px solid #22c55e; }
        .tab-training { border-left: 3px solid #a855f7; }
        
        /* Content */
        .content { padding: 20px; display: none; }
        .content.active { display: block; }
        
        /* Cards */
        .card { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border-radius: 15px; padding: 20px; margin-bottom: 15px; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .card-title { font-size: 1.1em; color: #f59e0b; }
        .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        
        /* Metrics */
        .metric { text-align: center; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px; }
        .metric-value { font-size: 2em; font-weight: bold; color: #f59e0b; }
        .metric-label { color: #94a3b8; font-size: 0.9em; margin-top: 5px; }
        .metric-sub { color: #64748b; font-size: 0.8em; }
        
        /* Progress Bars */
        .progress-container { margin: 10px 0; }
        .progress-bar { height: 20px; background: #334155; border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; border-radius: 10px; transition: width 0.5s; }
        .progress-green { background: linear-gradient(90deg, #10b981, #34d399); }
        .progress-amber { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
        .progress-red { background: linear-gradient(90deg, #ef4444, #f87171); }
        
        /* Tables */
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        th { color: #f59e0b; font-weight: 600; }
        tr:hover { background: rgba(255,255,255,0.05); }
        
        /* Status Badges */
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 0.8em; font-weight: 600; }
        .badge-green { background: #10b981; color: #fff; }
        .badge-amber { background: #f59e0b; color: #000; }
        .badge-red { background: #ef4444; color: #fff; }
        .badge-blue { background: #3b82f6; color: #fff; }
        .badge-gray { background: #64748b; color: #fff; }

        /* Goal Cards */
        .goal-card { background: rgba(0,0,0,0.2); border-radius: 12px; padding: 15px; margin-bottom: 12px; }
        .goal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .goal-title { font-weight: 600; }
        .goal-progress { display: flex; align-items: center; gap: 10px; }
        .goal-pct { font-size: 1.2em; font-weight: bold; }
        .goal-notes { color: #94a3b8; font-size: 0.85em; margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.1); }
        
        /* Action Items */
        .action-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px; margin-bottom: 8px; }
        .action-check { width: 24px; height: 24px; border: 2px solid #64748b; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .action-check.checked { background: #10b981; border-color: #10b981; }
        .action-check.checked::after { content: '‚úì'; color: #fff; font-weight: bold; }
        .action-text { flex: 1; }
        .action-priority { padding: 2px 8px; border-radius: 4px; font-size: 0.75em; }
        .priority-high { background: #ef4444; color: #fff; }
        .priority-med { background: #f59e0b; color: #000; }
        
        /* Alert Banner */
        .alert-banner { background: linear-gradient(90deg, #ef4444, #dc2626); padding: 15px 20px; text-align: center; font-weight: 600; }
        
        /* Rankings specific */
        .rank-item { display: flex; align-items: center; gap: 15px; padding: 10px; border-radius: 8px; margin-bottom: 5px; }
        .rank-item.denver { background: rgba(245, 158, 11, 0.2); border: 2px solid #f59e0b; }
        .rank-num { width: 30px; height: 30px; background: #334155; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .rank-shop { flex: 1; }
        .rank-value { font-weight: bold; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .card-grid { grid-template-columns: 1fr 1fr; }
            .header h1 { font-size: 1.1em; }
            .metric-value { font-size: 1.5em; }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <h1>üõ©Ô∏è Denver Satellite</h1>
            <p>Department 889 Performance Dashboard</p>
            <input type="password" id="passwordInput" placeholder="Enter access code" autocomplete="off" onkeypress="if(event.key==='Enter')login()">
            <button onclick="const p=document.getElementById('passwordInput').value; if(p==='denver889'){console.log('Login successful, setting localStorage');localStorage.setItem('denver_auth','true');console.log('localStorage set to:',localStorage.getItem('denver_auth'));document.getElementById('loginScreen').style.display='none';document.getElementById('dashboard').style.display='block';if(typeof loadDashboardData==='function')loadDashboardData();}else{document.getElementById('errorMsg').style.display='block';setTimeout(()=>document.getElementById('errorMsg').style.display='none',3000);}">Access Dashboard</button>
            <p class="error-msg" id="errorMsg">Invalid access code</p>
        </div>
    </div>
    
    <!-- Main Dashboard -->
    <div class="dashboard" id="dashboard">
        <div class="header">
            <div class="header-left">
                <h1>üõ©Ô∏è Denver Satellite (889)</h1>
            </div>
            <div class="header-right">
                <span class="status-indicator" id="statusIndicator">Ready</span>
                <button class="header-btn btn-full" onclick="toggleFullscreen()">‚õ∂ Full</button>
                <button class="header-btn btn-rotate" id="rotateBtn" onclick="toggleRotate()">‚ñ∂Ô∏è Auto</button>
                <button class="header-btn btn-lock" onclick="logout()">üîí Lock</button>
            </div>
        </div>
        
        <div class="tabs">
            <div class="tab tab-goals active" data-tab="goals">üéØ Goals</div>
            <div class="tab tab-actions" data-tab="actions">‚ö° Actions</div>
            <div class="tab tab-overview" data-tab="overview">üìä Overview</div>
            <div class="tab tab-employees" data-tab="employees">üë• Employees</div>
            <div class="tab tab-workorders" data-tab="workorders">üìã Work Orders</div>
            <div class="tab tab-training" data-tab="training">üìö Training</div>
            <div class="tab tab-quality" data-tab="quality">‚úÖ Quality</div>
            <div class="tab tab-wip" data-tab="wip">üí∞ WIP</div>
            <div class="tab tab-rankings" data-tab="rankings">üèÜ Rankings</div>
        </div>
        
        <!-- GOALS TAB -->
        <div class="content active" id="goals">
            <!-- Active Goals Card -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üéØ 2026 Denver 889 Goals</span>
                    <span class="badge badge-amber">3/11 Active</span>
                </div>

                <!-- Goal #1: A/B Ratio -->
                <div class="goal-card">
                    <div class="goal-header">
                        <span class="goal-title">üìä #1: A/B Ratio Target (58.5%)</span>
                        <span class="badge" id="abGoalBadge">Loading...</span>
                    </div>
                    <div class="goal-progress">
                        <div style="flex: 1;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="abProgressBar" style="width: 0%;"></div>
                            </div>
                        </div>
                        <span class="goal-pct" id="abProgressPct">--</span>
                    </div>
                    <div class="goal-notes">
                        <strong>Current:</strong> <span id="currentAB">--</span> |
                        <strong>Target:</strong> 58.5% |
                        <strong>Rank:</strong> <span id="networkRank">--</span> of 21 shops
                    </div>
                </div>

                <!-- Goal #2: NPS Program -->
                <div class="goal-card">
                    <div class="goal-header">
                        <span class="goal-title">üìß #2: NPS Program (12 completed/year)</span>
                        <span class="badge" id="npsGoalBadge">Loading...</span>
                    </div>
                    <div class="goal-progress">
                        <div style="flex: 1;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="npsProgressBar" style="width: 0%;"></div>
                            </div>
                        </div>
                        <span class="goal-pct" id="npsProgressPct">--</span>
                    </div>
                    <div class="goal-notes">
                        <strong>YTD Completed:</strong> <span id="pendingSurveys">--</span> of 12 |
                        <strong>This Month Sent:</strong> <span id="surveysSent">--</span> |
                        <strong>Billed WOs:</strong> <span id="billedWOsMonth">--</span>
                    </div>
                </div>

                <!-- Goal #3: Training -->
                <div class="goal-card">
                    <div class="goal-header">
                        <span class="goal-title">üìö #3: Training Completion (100% on time)</span>
                        <span class="badge" id="trainingGoalBadge">Loading...</span>
                    </div>
                    <div class="goal-progress">
                        <div style="flex: 1;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="trainingProgressBar" style="width: 0%;"></div>
                            </div>
                        </div>
                        <span class="goal-pct" id="trainingProgressPct">--</span>
                    </div>
                    <div class="goal-notes">
                        <strong>Completed:</strong> <span id="completedTraining">--</span> |
                        <strong>Past Due:</strong> <span id="pastDueTraining" style="color: #ef4444;">--</span> |
                        <strong>Due Soon:</strong> <span id="upcomingTraining">--</span>
                    </div>
                </div>

                <!-- Placeholder: Goals 4-6 -->
                <div class="goal-card" style="opacity: 0.6;">
                    <div class="goal-header">
                        <span class="goal-title">üìä #4-6: Pending Implementation</span>
                        <span class="badge badge-gray">Coming Soon</span>
                    </div>
                    <div style="padding: 10px; color: #94a3b8; font-size: 0.9em;">
                        #4: Flat-Rate System Evaluation | #5: Customer Experience | #6: Billing Accuracy
                    </div>
                </div>

                <!-- Goal #7: FAA and Internal Audits -->
                <div class="goal-card">
                    <div class="goal-header">
                        <span class="goal-title">‚úÖ #7: FAA & Internal Audits (No Findings)</span>
                        <span class="badge" id="auditGoalBadge">Loading...</span>
                    </div>
                    <div class="goal-progress">
                        <div style="flex: 1;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="auditProgressBar" style="width: 0%;"></div>
                            </div>
                        </div>
                        <span class="goal-pct" id="auditProgressPct">--</span>
                    </div>
                    <div class="goal-notes">
                        <strong>2026 Audits:</strong> <span id="auditTotal">--</span> |
                        <strong>No Findings:</strong> <span id="auditPassed">--</span> |
                        <strong>Findings:</strong> <span id="auditFindings">--</span>
                    </div>
                </div>
            </div>

            <!-- 2026 Goals Overview -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üìã 2026 Strategic Goals Overview</span>
                    <span class="badge badge-amber">3/11 Tracking</span>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Goal</th>
                                <th>Target</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>1</strong></td>
                                <td>A/B Ratio & ELR Financial Objectives</td>
                                <td>Meet or exceed 2026 targets</td>
                                <td><span class="badge badge-green">Active Tracking</span></td>
                            </tr>
                            <tr>
                                <td><strong>2</strong></td>
                                <td>NPS Program Participation</td>
                                <td>200 entries network-wide (1/month Denver)</td>
                                <td><span class="badge badge-green">Active Tracking</span></td>
                            </tr>
                            <tr>
                                <td><strong>3</strong></td>
                                <td>Training Completion</td>
                                <td>All mandatory & technical on time</td>
                                <td><span class="badge badge-green">Active Tracking</span></td>
                            </tr>
                            <tr>
                                <td><strong>4</strong></td>
                                <td>Flat-Rate System Evaluation</td>
                                <td>Re-evaluate using hard data</td>
                                <td><span class="badge badge-amber">Data Gathering</span></td>
                            </tr>
                            <tr>
                                <td><strong>5</strong></td>
                                <td>Customer Experience Management</td>
                                <td>Prompt, consistent, professional communication</td>
                                <td><span class="badge badge-amber">Pending</span></td>
                            </tr>
                            <tr>
                                <td><strong>6</strong></td>
                                <td>Shop Expense Management</td>
                                <td>Stay within budgeted amounts</td>
                                <td><span class="badge badge-amber">Pending</span></td>
                            </tr>
                            <tr>
                                <td><strong>7</strong></td>
                                <td>FAA & Internal Audits</td>
                                <td>Complete with no findings</td>
                                <td><span class="badge badge-amber">Pending</span></td>
                            </tr>
                            <tr>
                                <td><strong>8</strong></td>
                                <td>Monthly A/B Budget Plan</td>
                                <td>Meet budget each month</td>
                                <td><span class="badge badge-amber">Pending</span></td>
                            </tr>
                            <tr>
                                <td><strong>9</strong></td>
                                <td>Dealer Programs Tracking</td>
                                <td>Track customer reactions & success rates</td>
                                <td><span class="badge badge-amber">Pending</span></td>
                            </tr>
                            <tr>
                                <td><strong>10</strong></td>
                                <td>Vendor Dispute Communication</td>
                                <td>Communicate to BZ within 30 days</td>
                                <td><span class="badge badge-amber">Pending</span></td>
                            </tr>
                            <tr>
                                <td><strong>11</strong></td>
                                <td>Risk Assessment Reduction</td>
                                <td>Identify areas to reduce overall risk score</td>
                                <td><span class="badge badge-amber">Pending</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Other tabs - placeholder content -->
        <!-- ACTIONS TAB -->
        <div class="content" id="actions">
            <!-- NPS Survey Sending Interface -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üìß Send NPS Survey</span>
                    <span class="badge" id="npsSendBadge">Ready</span>
                </div>
                <div style="padding: 20px;">
                    <form id="npsForm" onsubmit="sendNPSSurvey(event)">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; color: #94a3b8; font-size: 0.9em;">Customer Name *</label>
                                <input type="text" id="customerName" required style="width: 100%; padding: 10px; border: 1px solid #334155; border-radius: 8px; background: #1e293b; color: #f1f5f9;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; color: #94a3b8; font-size: 0.9em;">Email Address *</label>
                                <input type="email" id="customerEmail" required style="width: 100%; padding: 10px; border: 1px solid #334155; border-radius: 8px; background: #1e293b; color: #f1f5f9;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; color: #94a3b8; font-size: 0.9em;">Work Order # *</label>
                                <input type="text" id="woNumber" required style="width: 100%; padding: 10px; border: 1px solid #334155; border-radius: 8px; background: #1e293b; color: #f1f5f9;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; color: #94a3b8; font-size: 0.9em;">Aircraft Registration</label>
                                <input type="text" id="regNumber" style="width: 100%; padding: 10px; border: 1px solid #334155; border-radius: 8px; background: #1e293b; color: #f1f5f9;">
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button type="submit" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                                üìß Send & Log Survey
                            </button>
                            <button type="button" onclick="logOnlyNPS()" style="flex: 1; padding: 12px; background: #334155; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                                üìù Log Only (Already Sent)
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Customer Recommendations -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üí° Recommended Customers for NPS Survey</span>
                    <span class="badge" id="recommendBadge">Loading...</span>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Customer</th>
                                <th>Email</th>
                                <th>Last WO</th>
                                <th>Days Since</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="customerRecommendations">
                            <tr><td colspan="5" style="text-align:center; color:#94a3b8;">Loading recommendations...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Recent NPS Activity -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üìä Recent NPS Survey Activity</span>
                    <span class="badge" id="activityBadge">Loading...</span>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Date Sent</th>
                                <th>Customer</th>
                                <th>WO #</th>
                                <th>Status</th>
                                <th>Score</th>
                            </tr>
                        </thead>
                        <tbody id="npsActivity">
                            <tr><td colspan="5" style="text-align:center; color:#94a3b8;">Loading activity...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="content" id="overview">
            <!-- A/B Ratio Comparison Header -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0; color: #e2e8f0;">üìä A/B Ratio Comparison</h2>
                <div style="background: #f59e0b; color: #000; padding: 8px 16px; border-radius: 6px; font-weight: bold;">
                    Target: 58.5%
                </div>
            </div>

            <!-- A/B Comparison Cards -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                <!-- Matt's Official Numbers (Left - Orange/Red) -->
                <div style="background: linear-gradient(135deg, #92400e 0%, #78350f 100%); border: 2px solid #d97706; border-radius: 12px; padding: 24px;">
                    <div style="text-align: center; margin-bottom: 16px; color: #fbbf24;">
                        üìß MATT'S FRIDAY UPDATE
                    </div>
                    <div style="text-align: center; font-size: 64px; font-weight: bold; color: #fbbf24; margin-bottom: 12px;" id="mattAB">
                        --
                    </div>
                    <div style="text-align: center; color: #fcd34d; margin-bottom: 8px;" id="mattPeriod">
                        Jan Final (2/6 Update)
                    </div>
                    <div style="text-align: center; color: #fcd34d;" id="mattRank">
                        Rank: 21st/21 | Gap: -20.9 pts
                    </div>
                </div>

                <!-- Denver Real-Time (Right - Blue/Green) -->
                <div style="background: linear-gradient(135deg, #064e3b 0%, #065f46 100%); border: 2px solid #10b981; border-radius: 12px; padding: 24px;">
                    <div style="text-align: center; margin-bottom: 16px; color: #6ee7b7;">
                        üìä DENVER LOCAL (Real-Time)
                    </div>
                    <div style="text-align: center; font-size: 64px; font-weight: bold; color: #10b981; margin-bottom: 12px;" id="denverAB">
                        --
                    </div>
                    <div style="text-align: center; color: #6ee7b7; margin-bottom: 8px;" id="denverRolling">
                        1-Month Rolling: 42.1%
                    </div>
                    <div style="text-align: center; color: #6ee7b7;" id="denverFebOnly">
                        Feb-only: 54.0% ‚úÖ Improving!
                    </div>
                </div>
            </div>

            <!-- Comparison Stats Row -->
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 30px;">
                <div style="background: #1e293b; border-radius: 8px; padding: 16px; text-align: center;">
                    <div style="color: #ef4444; font-size: 24px; font-weight: bold;" id="janFinal">33.1%</div>
                    <div style="color: #94a3b8; font-size: 14px;">Jan Final (Official)</div>
                    <div style="color: #ef4444; font-size: 12px;" id="janRank">21st</div>
                </div>
                <div style="background: #1e293b; border-radius: 8px; padding: 16px; text-align: center;">
                    <div style="color: #10b981; font-size: 24px; font-weight: bold;" id="febTrend">54.0%</div>
                    <div style="color: #94a3b8; font-size: 14px;">Feb Trend (MTD)</div>
                    <div style="color: #10b981; font-size: 12px;">üìàüìà</div>
                </div>
                <div style="background: #1e293b; border-radius: 8px; padding: 16px; text-align: center;">
                    <div style="color: #10b981; font-size: 24px; font-weight: bold;" id="rollingAvg">42.1%</div>
                    <div style="color: #94a3b8; font-size: 14px;">1-Mo Rolling Avg</div>
                    <div style="color: #10b981; font-size: 12px;">üìà</div>
                </div>
            </div>

            <!-- Status Message -->
            <div id="abStatusMessage" style="background: #065f46; border-left: 4px solid #10b981; padding: 16px; border-radius: 8px; margin-bottom: 30px;">
                <div style="color: #10b981; font-weight: bold;">
                    ‚úÖ Feb is STRONG! 54.0% Feb-only A/B vs 33.1% Jan final. Nearly at 58.5% target! Keep pushing.
                </div>
            </div>

            <!-- Jan Final Details -->
            <div style="background: #78350f; border-left: 4px solid #f59e0b; padding: 16px; border-radius: 8px; margin-bottom: 30px;">
                <div style="color: #fbbf24; font-weight: bold;">
                    üìß Jan Final: 33.1% A/B | 21st/21 | $310K Rev | -$1,305 NI
                </div>
            </div>
        </div>
        <div class="content" id="employees">
            <!-- YTD A/B Performance by Employee -->
            <div class="card">
                <div class="card-title">üìà YTD A/B Performance (2026)</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Employee</th>
                            <th>Code</th>
                            <th>YTD Total Hrs</th>
                            <th>YTD Billable</th>
                            <th>YTD A/B %</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="ytdABTable">
                        <tr><td colspan="6" style="text-align:center;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Monthly A/B Breakdown -->
            <div class="card">
                <div class="card-title">üìÖ A/B by Month - Per Technician</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Employee</th>
                            <th>Jan Total</th>
                            <th>Jan Bill</th>
                            <th>Jan A/B</th>
                            <th>Feb MTD Total</th>
                            <th>Feb MTD Bill</th>
                            <th>Feb MTD A/B</th>
                        </tr>
                    </thead>
                    <tbody id="monthlyABTable">
                        <tr><td colspan="7" style="text-align:center;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Individual A/B Performance -->
            <div class="card">
                <div class="card-title" id="individualABTitle">‚è±Ô∏è Individual A/B Performance - Loading...</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Employee</th>
                            <th>Code</th>
                            <th>Total Hours</th>
                            <th>Billable Hours</th>
                            <th>A/B %</th>
                            <th>Status</th>
                            <th>Work Orders (Previous Day)</th>
                        </tr>
                    </thead>
                    <tbody id="individualABTable">
                        <tr><td colspan="7" style="text-align:center;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Team Roster -->
            <div class="card">
                <div class="card-title">üìã Complete Team Roster</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Code</th>
                            <th>Title</th>
                            <th>QI</th>
                            <th>RTS</th>
                            <th>SRA</th>
                            <th>Stamps</th>
                            <th>Years Exp</th>
                            <th>Rating</th>
                        </tr>
                    </thead>
                    <tbody id="rosterTable">
                        <tr><td colspan="9" style="text-align:center;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="content" id="workorders">
            <!-- Work Orders Summary -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üìã Work Orders Pending Billing</span>
                    <span class="badge" id="workOrdersBadge">Loading...</span>
                </div>
                <div class="card-grid">
                    <div class="metric">
                        <div class="metric-value" id="totalWorkOrders">--</div>
                        <div class="metric-label">Total Pending</div>
                        <div class="metric-sub">Awaiting Billing</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" style="color: #10b981;" id="greenWorkOrders">--</div>
                        <div class="metric-label">Green (0-3 days)</div>
                        <div class="metric-sub">On Track</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" style="color: #f59e0b;" id="amberWorkOrders">--</div>
                        <div class="metric-label">Amber (4-7 days)</div>
                        <div class="metric-sub">Watch List</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" style="color: #ef4444;" id="redWorkOrders">--</div>
                        <div class="metric-label">Red (8+ days)</div>
                        <div class="metric-sub">Urgent</div>
                    </div>
                </div>
            </div>

            <!-- Work Orders List -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üìù Work Orders Detail</span>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>WO Number</th>
                                <th>Tail Number</th>
                                <th>Signoff Date</th>
                                <th>Days Pending</th>
                                <th>Status</th>
                                <th>Notes / Warnings</th>
                            </tr>
                        </thead>
                        <tbody id="workOrdersList">
                            <tr><td colspan="6" style="text-align:center; color:#94a3b8;">Loading data...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Billing Priority: 7-Day Tracking (Daily WOs) -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">‚ö° Billing Priority - 7-Day Tracking</span>
                    <span class="badge badge-amber" id="billingPriorityBadge">Active</span>
                </div>
                <div style="margin-bottom: 16px; padding: 12px; background: #1e293b; border-left: 4px solid #f59e0b; border-radius: 6px;">
                    <div style="color: #fbbf24; font-weight: bold;">üìß From Demarest's Daily Email - Track & Bill within 7 Days</div>
                    <div style="color: #94a3b8; font-size: 0.9em; margin-top: 4px;">Goal: Improve cash flow by billing completed work orders promptly</div>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>WO Number</th>
                            <th>Customer</th>
                            <th>Tail #</th>
                            <th>Completion Date</th>
                            <th>Days Open</th>
                            <th>Status</th>
                            <th>Priority</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody id="billingPriorityTable">
                        <tr><td colspan="8" style="text-align:center;">No active work orders tracked</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Over 30 Days Work Orders -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üìÖ Over 30 Days Work Orders</span>
                    <span class="badge badge-red" id="over30Badge">Monthly Report</span>
                </div>
                <div style="margin-bottom: 16px; padding: 12px; background: #1e293b; border-left: 4px solid #ef4444; border-radius: 6px;">
                    <div style="color: #ef4444; font-weight: bold;">üìß From Brian Zitek's Monthly Email (Last week of month)</div>
                    <div style="color: #94a3b8; font-size: 0.9em; margin-top: 4px;">Goal: Clear this list monthly or have justified notes for each WO</div>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>WO Number</th>
                            <th>Customer</th>
                            <th>Tail #</th>
                            <th>Open Date</th>
                            <th>Days Open</th>
                            <th>Status</th>
                            <th>Justification / Action Plan</th>
                            <th>Owner</th>
                        </tr>
                    </thead>
                    <tbody id="over30Table">
                        <tr><td colspan="8" style="text-align:center;">No over 30 work orders</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="content" id="training">
            <!-- Training Summary -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üìö Training Completion Status</span>
                    <span class="badge" id="trainingBadge">Loading...</span>
                </div>
                <div class="card-grid">
                    <div class="metric">
                        <div class="metric-value" id="totalTraining">--</div>
                        <div class="metric-label">Total Assignments</div>
                        <div class="metric-sub">All Training</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" style="color: #10b981;" id="completedTrainingCount">--</div>
                        <div class="metric-label">Completed</div>
                        <div class="metric-sub">On Time</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" style="color: #f59e0b;" id="dueSoonTrainingCount">--</div>
                        <div class="metric-label">Due Soon</div>
                        <div class="metric-sub">Within 30 Days</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" style="color: #ef4444;" id="pastDueTrainingCount">--</div>
                        <div class="metric-label">Past Due</div>
                        <div class="metric-sub">Overdue</div>
                    </div>
                </div>
            </div>

            <!-- Training by Category -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üìä Training by Category</span>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Total</th>
                                <th>Completed</th>
                                <th>Past Due</th>
                                <th>Completion %</th>
                            </tr>
                        </thead>
                        <tbody id="trainingByCategory">
                            <tr><td colspan="5" style="text-align:center; color:#94a3b8;">Loading data...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Training Detail List -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üìã Training Assignments Detail</span>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 200px;">Employee</th>
                                <th style="width: 450px;">Training Course</th>
                                <th style="width: 120px;">Category</th>
                                <th style="width: 120px;">Due Date</th>
                                <th style="width: 120px;">Status</th>
                            </tr>
                        </thead>
                        <tbody id="trainingDetail">
                            <tr><td colspan="5" style="text-align:center; color:#94a3b8;">Loading training data...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="content" id="quality">
            <!-- Quality Metrics Summary -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">‚úÖ Quality & Inspections - 2026</span>
                    <span class="badge" id="qualityBadge">Loading...</span>
                </div>
                <div class="metrics-grid">
                    <div class="metric">
                        <div class="metric-value" id="totalInspections">--</div>
                        <div class="metric-label">Total Inspections</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="passedInspections">--</div>
                        <div class="metric-label">Passed (No Issues)</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="failedInspections">--</div>
                        <div class="metric-label">Discrepancies Found</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="passRate">--</div>
                        <div class="metric-label">Pass Rate %</div>
                    </div>
                </div>
            </div>

            <!-- Inspection Progress -->
            <div class="card">
                <div class="card-title">üìä 2026 Pass Rate Target: 95%</div>
                <div style="margin-top: 20px;">
                    <div class="progress-bar" style="height: 30px;">
                        <div class="progress-fill" id="qualityProgressBar" style="width: 0%; background: linear-gradient(90deg, #10b981, #059669);"></div>
                    </div>
                    <div style="text-align: center; margin-top: 10px; font-size: 1.2em; font-weight: bold;" id="qualityProgressText">--</div>
                </div>
            </div>

            <!-- Discrepancies by Technician -->
            <div class="card">
                <div class="card-title">üë• Discrepancies by Technician</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Technician</th>
                            <th>Total Work</th>
                            <th>Discrepancies</th>
                            <th>Pass Rate</th>
                        </tr>
                    </thead>
                    <tbody id="discrepancyByTech">
                        <tr><td colspan="4" style="text-align:center;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Discrepancies by Category -->
            <div class="card">
                <div class="card-title">üìã Discrepancies by Category</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Count</th>
                            <th>% of Total</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody id="discrepancyByCategory">
                        <tr><td colspan="4" style="text-align:center;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Monthly Trend -->
            <div class="card">
                <div class="card-title">üìÖ Monthly Quality Trend (2026)</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Month</th>
                            <th>Inspections</th>
                            <th>Discrepancies</th>
                            <th>Pass Rate</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="monthlyTrend">
                        <tr><td colspan="5" style="text-align:center;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Recent Inspections & Discrepancies -->
            <div class="card">
                <div class="card-title">üîç 2026 Inspection Details</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Work Order</th>
                            <th>Tech</th>
                            <th>Discrepancy</th>
                            <th>Category</th>
                            <th>Resolution</th>
                        </tr>
                    </thead>
                    <tbody id="inspectionDetails">
                        <tr><td colspan="6" style="text-align:center;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="content" id="wip">
            <!-- Current Month WIP Summary -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üí∞ Work in Progress (WIP) Summary</span>
                    <span class="badge" id="wipBadge">Loading...</span>
                </div>
                <div class="card-grid">
                    <div class="metric">
                        <div class="metric-value" id="wipTotalValue">--</div>
                        <div class="metric-label">Total WIP Value</div>
                        <div class="metric-sub" id="wipMonth">--</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="wipTotalHours">--</div>
                        <div class="metric-label">Total Hours</div>
                        <div class="metric-sub">Current Month</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="wipShopCount">--</div>
                        <div class="metric-label">Active Shops</div>
                        <div class="metric-sub">With WIP</div>
                    </div>
                </div>
            </div>

            <!-- WIP by Shop -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üìä WIP by Shop</span>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Shop</th>
                            <th>Hours</th>
                            <th>Rate</th>
                            <th>WIP Value</th>
                            <th>% of Total</th>
                        </tr>
                    </thead>
                    <tbody id="wipShopDetails">
                        <tr><td colspan="5" style="text-align:center;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- WIP Explanation -->
            <div class="card">
                <div class="card-title">‚ÑπÔ∏è About WIP</div>
                <p><strong>Work in Progress (WIP)</strong> smooths out billing peaks by accounting for labor and parts sold to work orders on a monthly basis.</p>
                <ul style="margin-left: 20px; line-height: 1.8;">
                    <li><strong>Standard WIP:</strong> SDN, SDR, SHC @ $145/hr (2026 rate)</li>
                    <li><strong>Special WIP:</strong> SDV installs @ $80/hr + 15% parts margin</li>
                    <li><strong>Scope:</strong> Only work orders opened in the current month (or with additional hours sold)</li>
                    <li><strong>Goal:</strong> Stay ahead of the curve and avoid hills/valleys in billing</li>
                </ul>
            </div>
        </div>
        <div class="content" id="rankings">
            <!-- Denver Position Card -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üèÜ Denver Shop Rankings</span>
                    <span class="badge" id="rankingsBadge">Loading...</span>
                </div>
                <div class="card-grid">
                    <div class="metric">
                        <div class="metric-value" id="denverPosition">--</div>
                        <div class="metric-label">Current Position</div>
                        <div class="metric-sub" id="positionDate">--</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="abActual">--</div>
                        <div class="metric-label">A/B Percentage</div>
                        <div class="metric-sub">Actual Performance</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="abBudget">--</div>
                        <div class="metric-label">A/B Budget</div>
                        <div class="metric-sub">Target Goal</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="abVariance">--</div>
                        <div class="metric-label">Variance</div>
                        <div class="metric-sub" id="varianceStatus">vs Budget</div>
                    </div>
                </div>
            </div>

            <!-- Rankings History -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üìà Recent Rankings History</span>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Week Ending</th>
                                <th>Position</th>
                                <th>A/B Actual</th>
                                <th>A/B Budget</th>
                                <th>Variance</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="rankingsHistory">
                            <tr><td colspan="6" style="text-align:center; color:#94a3b8;">Loading data...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const PASSWORD = 'denver889';
        let isRotating = false;
        let currentTab = 0;
        const tabs = ['goals', 'actions', 'overview', 'employees', 'workorders', 'training', 'quality', 'wip', 'rankings'];
        
        // Login function (backup - button uses inline code)
        function login() {
            const pwd = document.getElementById('passwordInput').value;
            if (pwd === PASSWORD) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                localStorage.setItem('denver_auth', 'true');
                showTab(tabs[0]);
                loadDashboardData();
            } else {
                document.getElementById('errorMsg').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('errorMsg').style.display = 'none';
                }, 3000);
            }
        }
        
        function logout() {
            localStorage.removeItem('denver_auth');
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('passwordInput').value = '';
        }
        
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(()=>{});
            } else if (document.exitFullscreen) {
                document.exitFullscreen();
            }
        }
        
        function showTab(tabId) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');

            // Load tab-specific data
            if (tabId === 'actions') {
                loadActionsData();
            }
        }
        
        function toggleRotate() {
            isRotating = !isRotating;
            document.getElementById('rotateBtn').textContent = isRotating ? '‚è∏Ô∏è Stop' : '‚ñ∂Ô∏è Auto';
            document.getElementById('rotateBtn').style.background = isRotating ? '#ef4444' : '#10b981';

            if (!isRotating) {
                // Reset to first tab when stopped
                currentTab = 0;
                showTab(tabs[currentTab]);
            }
        }

        // Auto-rotate through tabs every 30 seconds
        setInterval(() => {
            if (isRotating) {
                currentTab = (currentTab + 1) % tabs.length;
                showTab(tabs[currentTab]);
                console.log(`Auto-rotated to tab: ${tabs[currentTab]}`);
            }
        }, 30000); // 30 seconds
        
        // Tab click handlers
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => showTab(tab.dataset.tab));
        });
        
        // Supabase Configuration
        const SUPABASE_URL = 'https://pjielffstfzqffrpmyyt.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBqaWVsZmZzdGZ6cWZmcnBteXl0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2NTQzOTgsImV4cCI6MjA4NjIzMDM5OH0.uAu8sr_oZcAuysJTWUg3CuAnfbXMsPqQ-UzH43BxPSw';
        const HEADERS = {
            'apikey': SUPABASE_KEY,
            'Authorization': `Bearer ${SUPABASE_KEY}`,
            'Content-Type': 'application/json'
        };

        // Load all dashboard data
        async function loadDashboardData() {
            await loadRankings();
            await loadWorkOrders();
            await loadBillingPriority();
            await loadOver30WOs();
            await loadTrainingData();
            await loadQualityData();
            await loadDailyMetrics();
            await loadGoalsData();
            await loadEmployeeData();
            await loadWIP();
        }

        // Helper function to get ordinal suffix (1st, 2nd, 3rd, etc.)
        function getOrdinalSuffix(num) {
            const j = num % 10;
            const k = num % 100;
            if (j === 1 && k !== 11) return 'st';
            if (j === 2 && k !== 12) return 'nd';
            if (j === 3 && k !== 13) return 'rd';
            return 'th';
        }

        // Load Rankings Data
        async function loadRankings() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/rankings?select=*&order=week_ending.desc&limit=10`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                const rankings = await response.json();

                if (rankings.length > 0) {
                    const latest = rankings[0];

                    // Update current position metrics
                    document.getElementById('denverPosition').textContent = `#${latest.denver_position} of ${latest.total_shops}`;
                    document.getElementById('abActual').textContent = `${latest.denver_ab_actual}%`;
                    document.getElementById('abBudget').textContent = `${latest.denver_ab_budget}%`;

                    const variance = (latest.denver_ab_actual - latest.denver_ab_budget).toFixed(1);
                    document.getElementById('abVariance').textContent = `${variance > 0 ? '+' : ''}${variance}%`;
                    document.getElementById('abVariance').style.color = variance >= 0 ? '#10b981' : '#ef4444';

                    const weekDate = new Date(latest.week_ending).toLocaleDateString();
                    document.getElementById('positionDate').textContent = `Week of ${weekDate}`;

                    // Status badge
                    const isGood = variance >= 0;
                    document.getElementById('rankingsBadge').textContent = isGood ? 'On Target' : 'Below Target';
                    document.getElementById('rankingsBadge').className = `badge ${isGood ? 'badge-green' : 'badge-red'}`;

                    // Load history table
                    const historyHTML = rankings.map(r => {
                        const v = (r.denver_ab_actual - r.denver_ab_budget).toFixed(1);
                        const statusClass = v >= 0 ? 'badge-green' : 'badge-red';
                        const statusText = v >= 0 ? 'On Target' : 'Below';
                        return `
                            <tr>
                                <td>${new Date(r.week_ending).toLocaleDateString()}</td>
                                <td><strong>#${r.denver_position}</strong> of ${r.total_shops}</td>
                                <td>${r.denver_ab_actual}%</td>
                                <td>${r.denver_ab_budget}%</td>
                                <td style="color:${v >= 0 ? '#10b981' : '#ef4444'}">${v > 0 ? '+' : ''}${v}%</td>
                                <td><span class="badge ${statusClass}">${statusText}</span></td>
                            </tr>
                        `;
                    }).join('');
                    document.getElementById('rankingsHistory').innerHTML = historyHTML;
                }
            } catch (error) {
                console.error('Error loading rankings:', error);
                document.getElementById('rankingsBadge').textContent = 'Error';
                document.getElementById('rankingsBadge').className = 'badge badge-red';
            }
        }

        // Load Work Orders Data
        async function loadWorkOrders() {
            try {
                // Fetch pending work orders
                const woResponse = await fetch(`${SUPABASE_URL}/rest/v1/work_orders?select=*&status=eq.pending_billing&order=signoff_date.asc`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                const workOrders = await woResponse.json();

                // Fetch over 30 WOs to get open_date and days_open
                const over30Response = await fetch(`${SUPABASE_URL}/rest/v1/over_30_wos?select=wo_number,open_date,days_open`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                const over30WOs = await over30Response.json();

                // Create lookup map
                const over30Map = {};
                over30WOs.forEach(wo => {
                    over30Map[wo.wo_number] = {
                        open_date: wo.open_date,
                        days_open: wo.days_open
                    };
                });

                const today = new Date();
                today.setHours(0, 0, 0, 0);

                // Calculate days pending and categorize
                const workOrdersWithDays = workOrders.map(wo => {
                    const signoffDate = new Date(wo.signoff_date);
                    const daysPending = Math.floor((today - signoffDate) / (1000 * 60 * 60 * 24));
                    let category = 'green';
                    if (daysPending >= 8) category = 'red';
                    else if (daysPending >= 4) category = 'amber';

                    // Add over 30 data if available
                    const over30Data = over30Map[wo.work_order_number];

                    return {
                        ...wo,
                        daysPending,
                        category,
                        open_date: over30Data?.open_date || null,
                        current_days_open: over30Data?.days_open || null
                    };
                });

                // Count by category
                const greenCount = workOrdersWithDays.filter(w => w.category === 'green').length;
                const amberCount = workOrdersWithDays.filter(w => w.category === 'amber').length;
                const redCount = workOrdersWithDays.filter(w => w.category === 'red').length;

                // Update metrics
                document.getElementById('totalWorkOrders').textContent = workOrders.length;
                document.getElementById('greenWorkOrders').textContent = greenCount;
                document.getElementById('amberWorkOrders').textContent = amberCount;
                document.getElementById('redWorkOrders').textContent = redCount;

                // Badge
                const badge = redCount > 0 ? { text: `${redCount} Urgent`, class: 'badge-red' } :
                              amberCount > 0 ? { text: `${amberCount} Watch`, class: 'badge-amber' } :
                              { text: 'All Green', class: 'badge-green' };
                document.getElementById('workOrdersBadge').textContent = badge.text;
                document.getElementById('workOrdersBadge').className = `badge ${badge.class}`;

                // Load work orders list
                const listHTML = workOrdersWithDays.map(wo => {
                    const badgeClass = wo.category === 'green' ? 'badge-green' :
                                     wo.category === 'amber' ? 'badge-amber' : 'badge-red';
                    const statusText = wo.category === 'green' ? 'On Track' :
                                     wo.category === 'amber' ? 'Watch' : 'Urgent';

                    // Calculate if WO will be over 30 days by month-end
                    const endOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                    const daysUntilMonthEnd = Math.floor((endOfMonth - today) / (1000 * 60 * 60 * 24));

                    let warning = '';

                    // Use open_date if available (from over_30_wos table), otherwise estimate
                    if (wo.open_date) {
                        // Calculate actual days open by month-end
                        const openDate = new Date(wo.open_date);
                        const daysOpenByMonthEnd = Math.floor((endOfMonth - openDate) / (1000 * 60 * 60 * 24));
                        const currentDaysOpen = wo.current_days_open || Math.floor((today - openDate) / (1000 * 60 * 60 * 24));

                        if (currentDaysOpen >= 30) {
                            // Already over 30 days!
                            warning = `<div style="background: #7c2d12; padding: 8px; border-radius: 4px; border-left: 3px solid #ef4444;">
                                <strong style="color: #fca5a5;">üî¥ ALREADY OVER 30 DAYS</strong><br/>
                                <span style="color: #fed7aa; font-size: 0.85em;">
                                    Currently <strong>${currentDaysOpen} days</strong> open (opened ${new Date(wo.open_date).toLocaleDateString()})<br/>
                                    <strong>URGENT:</strong> Bill immediately to avoid Brian's report!
                                </span>
                            </div>`;
                        } else if (daysOpenByMonthEnd >= 30) {
                            // Will be over 30 by month-end
                            warning = `<div style="background: #7c2d12; padding: 8px; border-radius: 4px; border-left: 3px solid #f59e0b;">
                                <strong style="color: #fbbf24;">‚ö†Ô∏è Will Hit 30 Days</strong><br/>
                                <span style="color: #fed7aa; font-size: 0.85em;">
                                    Currently ${currentDaysOpen} days, will be <strong>${daysOpenByMonthEnd} days</strong> by month-end<br/>
                                    <strong>${daysUntilMonthEnd} days</strong> to bill before appearing in Brian's report
                                </span>
                            </div>`;
                        }
                    } else {
                        // No open_date available - show info message
                        warning = '<span style="color: #94a3b8; font-size: 0.85em;">‚ÑπÔ∏è Open date unknown - bill ASAP to be safe</span>';
                    }

                    return `
                        <tr>
                            <td><strong>${wo.work_order_number}</strong></td>
                            <td>${wo.tail_number}</td>
                            <td>${new Date(wo.signoff_date).toLocaleDateString()}</td>
                            <td>${wo.daysPending} days</td>
                            <td><span class="badge ${badgeClass}">${statusText}</span></td>
                            <td>${warning || '<span style="color: #10b981;">‚úì Will not exceed 30 days</span>'}</td>
                        </tr>
                    `;
                }).join('');
                document.getElementById('workOrdersList').innerHTML = listHTML || '<tr><td colspan="6" style="text-align:center;">No pending work orders</td></tr>';
            } catch (error) {
                console.error('Error loading work orders:', error);
                document.getElementById('workOrdersBadge').textContent = 'Error';
                document.getElementById('workOrdersBadge').className = 'badge badge-red';
            }
        }

        // Load Billing Priority Work Orders (7-Day Tracking)
        async function loadBillingPriority() {
            try {
                // Pull from work_orders table (pending_billing status)
                const response = await fetch(`${SUPABASE_URL}/rest/v1/work_orders?select=*&status=eq.pending_billing&order=signoff_date.asc`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                const workOrders = await response.json();

                if (workOrders.length > 0) {
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);

                    const tableHTML = workOrders.map(wo => {
                        // Calculate days open since signoff
                        const signoffDate = new Date(wo.signoff_date);
                        const daysOpen = Math.floor((today - signoffDate) / (1000 * 60 * 60 * 24));

                        const priorityClass = daysOpen >= 7 ? 'badge-red' : daysOpen >= 5 ? 'badge-amber' : 'badge-green';
                        const priorityText = daysOpen >= 7 ? 'URGENT' : daysOpen >= 5 ? 'High' : 'Normal';

                        return `
                            <tr>
                                <td><strong>${wo.work_order_number || '--'}</strong></td>
                                <td>${wo.customer || '--'}</td>
                                <td>${wo.tail_number || '--'}</td>
                                <td>${wo.signoff_date ? new Date(wo.signoff_date).toLocaleDateString() : '--'}</td>
                                <td><span class="badge ${priorityClass}">${daysOpen} days</span></td>
                                <td>Pending Billing</td>
                                <td><span class="badge ${priorityClass}">${priorityText}</span></td>
                                <td>${daysOpen >= 7 ? 'URGENT: Bill immediately!' : daysOpen >= 5 ? 'High priority' : 'Track'}</td>
                            </tr>
                        `;
                    }).join('');

                    document.getElementById('billingPriorityTable').innerHTML = tableHTML;

                    // Update badge
                    const today_date = new Date();
                    today_date.setHours(0, 0, 0, 0);
                    const urgentCount = workOrders.filter(wo => {
                        const signoffDate = new Date(wo.signoff_date);
                        const daysOpen = Math.floor((today_date - signoffDate) / (1000 * 60 * 60 * 24));
                        return daysOpen >= 7;
                    }).length;

                    if (urgentCount > 0) {
                        document.getElementById('billingPriorityBadge').textContent = `${urgentCount} Urgent`;
                        document.getElementById('billingPriorityBadge').className = 'badge badge-red';
                    } else {
                        document.getElementById('billingPriorityBadge').textContent = `${workOrders.length} Active`;
                        document.getElementById('billingPriorityBadge').className = 'badge badge-amber';
                    }
                } else {
                    document.getElementById('billingPriorityTable').innerHTML = '<tr><td colspan="8" style="text-align:center;">No active work orders tracked</td></tr>';
                    document.getElementById('billingPriorityBadge').textContent = 'None';
                    document.getElementById('billingPriorityBadge').className = 'badge badge-green';
                }
            } catch (error) {
                console.error('Error loading billing priority WOs:', error);
                document.getElementById('billingPriorityTable').innerHTML = '<tr><td colspan="8" style="text-align:center; color: #ef4444;">Error loading data</td></tr>';
            }
        }

        // Load Over 30 Days Work Orders
        async function loadOver30WOs() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/over_30_wos?select=*&order=days_open.desc`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                const over30WOs = await response.json();

                if (over30WOs.length > 0) {
                    const tableHTML = over30WOs.map(wo => {
                        const daysOpen = wo.days_open || 0;
                        const statusClass = daysOpen >= 60 ? 'badge-red' : daysOpen >= 45 ? 'badge-amber' : 'badge-green';

                        return `
                            <tr>
                                <td><strong>${wo.wo_number || '--'}</strong></td>
                                <td>${wo.customer || '--'}</td>
                                <td>${wo.tail_number || '--'}</td>
                                <td>${wo.open_date ? new Date(wo.open_date).toLocaleDateString() : '--'}</td>
                                <td><span class="badge ${statusClass}">${daysOpen} days</span></td>
                                <td>${wo.status || '--'}</td>
                                <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis;">${wo.justification || '--'}<br/><em style="color: #94a3b8;">${wo.action_plan || ''}</em></td>
                                <td>${wo.owner || '--'}</td>
                            </tr>
                        `;
                    }).join('');

                    document.getElementById('over30Table').innerHTML = tableHTML;

                    // Update badge
                    document.getElementById('over30Badge').textContent = `${over30WOs.length} WOs`;
                    document.getElementById('over30Badge').className = over30WOs.length > 5 ? 'badge badge-red' : 'badge badge-amber';
                } else {
                    document.getElementById('over30Table').innerHTML = '<tr><td colspan="8" style="text-align:center; color: #10b981;">‚úÖ No over 30 work orders - Great job!</td></tr>';
                    document.getElementById('over30Badge').textContent = 'Clear';
                    document.getElementById('over30Badge').className = 'badge badge-green';
                }
            } catch (error) {
                console.error('Error loading over 30 WOs:', error);
                document.getElementById('over30Table').innerHTML = '<tr><td colspan="8" style="text-align:center; color: #ef4444;">Error loading data</td></tr>';
            }
        }

        // Load WIP Data
        async function loadWIP() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/wip_entries?select=*&order=month.desc`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                const wipData = await response.json();

                if (wipData.length > 0) {
                    // Get current month data (most recent month)
                    const latestMonth = wipData[0].month;
                    const currentMonthData = wipData.filter(w => w.month === latestMonth);

                    // Calculate totals
                    const totalWIP = currentMonthData.reduce((sum, w) => sum + (w.wip_value || 0), 0);
                    const totalHours = currentMonthData.reduce((sum, w) => sum + (w.hours || 0), 0);
                    const shopCount = currentMonthData.length;

                    // Update summary metrics
                    document.getElementById('wipTotalValue').textContent = `$${totalWIP.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                    document.getElementById('wipTotalHours').textContent = totalHours.toLocaleString('en-US', {minimumFractionDigits: 1, maximumFractionDigits: 1});
                    document.getElementById('wipShopCount').textContent = shopCount;

                    // Format month display
                    const monthDate = new Date(latestMonth + '-01');
                    const monthName = monthDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                    document.getElementById('wipMonth').textContent = monthName;

                    // Update badge
                    document.getElementById('wipBadge').textContent = monthName;
                    document.getElementById('wipBadge').className = 'badge badge-green';

                    // Build shop details table
                    const tableHTML = currentMonthData
                        .sort((a, b) => (b.wip_value || 0) - (a.wip_value || 0))
                        .map(shop => {
                            const wipValue = shop.wip_value || 0;
                            const percentage = ((wipValue / totalWIP) * 100).toFixed(1);
                            const hours = shop.hours || 0;
                            const rate = shop.rate || 0;

                            // Color-code based on shop
                            let shopBadge = '';
                            if (shop.shop === 'SDV') {
                                shopBadge = '<span class="badge badge-blue">SDV</span>';
                            } else if (['SDN', 'SDR', 'SHC'].includes(shop.shop)) {
                                shopBadge = `<span class="badge badge-green">${shop.shop}</span>`;
                            } else {
                                shopBadge = shop.shop;
                            }

                            return `
                                <tr>
                                    <td>${shopBadge}</td>
                                    <td>${hours.toLocaleString('en-US', {minimumFractionDigits: 1, maximumFractionDigits: 1})} hrs</td>
                                    <td>$${rate.toFixed(2)}/hr</td>
                                    <td><strong>$${wipValue.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</strong></td>
                                    <td>${percentage}%</td>
                                </tr>
                            `;
                        }).join('');

                    document.getElementById('wipShopDetails').innerHTML = tableHTML;
                } else {
                    document.getElementById('wipShopDetails').innerHTML = '<tr><td colspan="5" style="text-align:center;">No WIP data available</td></tr>';
                    document.getElementById('wipBadge').textContent = 'No Data';
                    document.getElementById('wipBadge').className = 'badge badge-gray';
                }
            } catch (error) {
                console.error('Error loading WIP data:', error);
                document.getElementById('wipShopDetails').innerHTML = '<tr><td colspan="5" style="text-align:center; color: #ef4444;">Error loading WIP data</td></tr>';
                document.getElementById('wipBadge').textContent = 'Error';
                document.getElementById('wipBadge').className = 'badge badge-red';
            }
        }

        // Load Training Data
        async function loadTrainingData() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/training?select=*&order=due_date.asc`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                const training = await response.json();

                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const thirtyDaysFromNow = new Date(today);
                thirtyDaysFromNow.setDate(today.getDate() + 30);

                // Categorize training by status
                const completed = training.filter(t => t.status === 'Completed');
                const pastDue = training.filter(t => t.status === 'Past Due');
                const dueSoon = training.filter(t => {
                    if (!t.due_date || t.status === 'Completed' || t.status === 'Past Due') return false;
                    const dueDate = new Date(t.due_date);
                    return dueDate > today && dueDate <= thirtyDaysFromNow;
                });

                // Update summary metrics
                document.getElementById('totalTraining').textContent = training.length;
                document.getElementById('completedTrainingCount').textContent = completed.length;
                document.getElementById('dueSoonTrainingCount').textContent = dueSoon.length;
                document.getElementById('pastDueTrainingCount').textContent = pastDue.length;

                // Badge
                const badge = pastDue.length > 0 ? { text: `${pastDue.length} Past Due`, class: 'badge-red' } :
                              dueSoon.length > 0 ? { text: `${dueSoon.length} Due Soon`, class: 'badge-amber' } :
                              { text: 'All On Track', class: 'badge-green' };
                document.getElementById('trainingBadge').textContent = badge.text;
                document.getElementById('trainingBadge').className = `badge ${badge.class}`;

                // Group by category
                const categories = {};
                training.forEach(t => {
                    const cat = t.category || 'Other';
                    if (!categories[cat]) {
                        categories[cat] = { total: 0, completed: 0, pastDue: 0 };
                    }
                    categories[cat].total++;
                    if (t.status === 'Completed') categories[cat].completed++;
                    if (t.status === 'Past Due') categories[cat].pastDue++;
                });

                // Load category summary
                const categoryHTML = Object.entries(categories).map(([cat, stats]) => {
                    const completionPct = stats.total > 0 ? ((stats.completed / stats.total) * 100).toFixed(1) : '0.0';
                    return `
                        <tr>
                            <td><strong>${cat}</strong></td>
                            <td>${stats.total}</td>
                            <td>${stats.completed}</td>
                            <td>${stats.pastDue}</td>
                            <td>${completionPct}%</td>
                        </tr>
                    `;
                }).join('');
                document.getElementById('trainingByCategory').innerHTML = categoryHTML ||
                    '<tr><td colspan="5" style="text-align:center;">No training data</td></tr>';

                // Build Training Detail Table - Grouped by Employee, then Status Priority

                if (training.length === 0) {
                    document.getElementById('trainingDetail').innerHTML =
                        '<tr><td colspan="5" style="text-align:center;">No training assignments</td></tr>';
                    return;
                }

                // Sort training: Past Due first, then by employee, then by status
                const sortedTraining = training.sort((a, b) => {
                    // Priority 1: Past Due first
                    if (a.status === 'Past Due' && b.status !== 'Past Due') return -1;
                    if (a.status !== 'Past Due' && b.status === 'Past Due') return 1;

                    // Priority 2: Sort by employee name
                    if (a.employee_name !== b.employee_name) {
                        return a.employee_name.localeCompare(b.employee_name);
                    }

                    // Priority 3: Within same employee, sort by status (Due Soon, In Progress, Completed)
                    const statusOrder = { 'Due Soon': 1, 'In Progress': 2, 'Completed': 3 };
                    const aOrder = statusOrder[a.status] || 4;
                    const bOrder = statusOrder[b.status] || 4;
                    if (aOrder !== bOrder) return aOrder - bOrder;

                    // Priority 4: Sort by training title
                    return a.training_title.localeCompare(b.training_title);
                });

                // Build table with employee grouping
                let currentEmployee = '';
                const detailHTML = sortedTraining.map((t, index) => {
                    const showEmployee = t.employee_name !== currentEmployee;
                    if (showEmployee) currentEmployee = t.employee_name;

                    const badgeClass = t.status === 'Past Due' ? 'badge-red' :
                                     t.status === 'Completed' ? 'badge-green' :
                                     t.status === 'Due Soon' ? 'badge-amber' : 'badge-gray';

                    const dueDateStr = t.due_date ?
                        new Date(t.due_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) :
                        '<span style="color: #64748b;">No date set</span>';

                    // Truncate long training titles
                    const shortTitle = t.training_title.length > 80 ?
                        t.training_title.substring(0, 77) + '...' :
                        t.training_title;

                    return `
                        <tr ${showEmployee ? 'style="border-top: 2px solid #475569;"' : ''}>
                            <td style="font-weight: ${showEmployee ? '700' : '400'}; color: ${showEmployee ? '#fff' : '#94a3b8'};">
                                ${showEmployee ? t.employee_name : ''}
                            </td>
                            <td style="font-size: 0.9em;">${shortTitle}</td>
                            <td style="font-size: 0.85em;">${t.category || '<span style="color: #64748b;">Uncategorized</span>'}</td>
                            <td style="font-size: 0.85em;">${dueDateStr}</td>
                            <td><span class="badge ${badgeClass}">${t.status}</span></td>
                        </tr>
                    `;
                }).join('');

                document.getElementById('trainingDetail').innerHTML = detailHTML;

            } catch (error) {
                console.error('Error loading training data:', error);
                document.getElementById('trainingBadge').textContent = 'Error';
                document.getElementById('trainingBadge').className = 'badge badge-red';
            }
        }

        // Load Quality/Inspection Data
        async function loadQualityData() {
            try {
                console.log('Loading quality/inspection data...');
                const response = await fetch(`${SUPABASE_URL}/rest/v1/inspections?year=eq.2026&order=inspection_date.desc`, {
                    headers: HEADERS
                });

                // Check if table exists
                if (response.status === 404) {
                    console.log('Inspections table not created yet');
                    document.getElementById('qualityBadge').textContent = 'Setup Required';
                    document.getElementById('qualityBadge').className = 'badge badge-gray';
                    document.getElementById('totalInspections').textContent = '0';
                    document.getElementById('passedInspections').textContent = '0';
                    document.getElementById('failedInspections').textContent = '0';
                    document.getElementById('passRate').textContent = '0%';
                    document.getElementById('discrepancyByCategory').innerHTML = '<tr><td colspan="3" style="text-align:center;">Table not created yet. Run SQL setup.</td></tr>';
                    document.getElementById('inspectionDetails').innerHTML = '<tr><td colspan="6" style="text-align:center;">Table not created yet. See setup instructions.</td></tr>';
                    return;
                }

                const inspections = await response.json();
                console.log('Inspection data received:', inspections);

                // Calculate metrics
                const total = inspections.length;
                const discrepancies = inspections.filter(i => i.discrepency).length;
                const passed = total - discrepancies;
                const passRate = total > 0 ? ((passed / total) * 100).toFixed(1) : '0';

                // Update summary metrics
                document.getElementById('totalInspections').textContent = total;
                document.getElementById('passedInspections').textContent = passed;
                document.getElementById('failedInspections').textContent = discrepancies;
                document.getElementById('passRate').textContent = passRate + '%';

                // Update progress bar
                const progressBar = document.getElementById('qualityProgressBar');
                progressBar.style.width = `${passRate}%`;
                document.getElementById('qualityProgressText').textContent = `${passRate}% Pass Rate (Target: 95%)`;

                // Color coding for progress bar
                if (parseFloat(passRate) >= 95) {
                    progressBar.style.background = 'linear-gradient(90deg, #10b981, #059669)';
                } else if (parseFloat(passRate) >= 85) {
                    progressBar.style.background = 'linear-gradient(90deg, #f59e0b, #d97706)';
                } else {
                    progressBar.style.background = 'linear-gradient(90deg, #ef4444, #dc2626)';
                }

                // Badge
                const badge = document.getElementById('qualityBadge');
                if (parseFloat(passRate) >= 95) {
                    badge.textContent = 'Excellent';
                    badge.className = 'badge badge-green';
                } else if (parseFloat(passRate) >= 85) {
                    badge.textContent = 'Needs Attention';
                    badge.className = 'badge badge-amber';
                } else {
                    badge.textContent = 'Critical';
                    badge.className = 'badge badge-red';
                }

                // Group by category
                const categories = {};
                inspections.forEach(i => {
                    const cat = i.category || 'Other';
                    if (!categories[cat]) {
                        categories[cat] = { count: 0, description: '' };
                    }
                    categories[cat].count++;
                });

                // Set category descriptions
                const catDescriptions = {
                    'CE': 'Clerical Error - Paperwork, signatures, forms',
                    'MS': 'Missing/Incorrect Information - Part numbers, incomplete docs',
                    'RTS': 'RTS Paperwork - Logbooks, RTS statements, documentation',
                    'Other': 'Other quality issues'
                };

                // Group by technician
                const techStats = {};
                inspections.forEach(i => {
                    const tech = i.tech || 'Unknown';
                    if (!techStats[tech]) {
                        techStats[tech] = { total: 0, discrepancies: 0 };
                    }
                    techStats[tech].total++;
                    if (i.discrepency) {
                        techStats[tech].discrepancies++;
                    }
                });

                // Load technician breakdown
                const techHTML = Object.entries(techStats).map(([tech, stats]) => {
                    const techPassRate = stats.total > 0 ? (((stats.total - stats.discrepancies) / stats.total) * 100).toFixed(1) : '100';
                    const statusBadge = parseFloat(techPassRate) >= 95 ? '<span class="badge badge-green">Excellent</span>' :
                                       parseFloat(techPassRate) >= 85 ? '<span class="badge badge-amber">Good</span>' :
                                       '<span class="badge badge-red">Needs Attention</span>';
                    return `
                        <tr>
                            <td><strong>${tech}</strong></td>
                            <td>${stats.total}</td>
                            <td>${stats.discrepancies}</td>
                            <td>${techPassRate}% ${statusBadge}</td>
                        </tr>
                    `;
                }).join('');
                document.getElementById('discrepancyByTech').innerHTML = techHTML ||
                    '<tr><td colspan="4" style="text-align:center;">No technician data available</td></tr>';

                // Load category breakdown with percentages
                const categoryHTML = Object.entries(categories).map(([cat, data]) => {
                    const pct = discrepancies > 0 ? ((data.count / discrepancies) * 100).toFixed(1) : '0';
                    return `
                        <tr>
                            <td><strong>${cat}</strong></td>
                            <td>${data.count}</td>
                            <td>${pct}%</td>
                            <td style="color: #94a3b8;">${catDescriptions[cat] || 'Quality issue'}</td>
                        </tr>
                    `;
                }).join('');
                document.getElementById('discrepancyByCategory').innerHTML = categoryHTML ||
                    '<tr><td colspan="4" style="text-align:center;">No discrepancies found - excellent work!</td></tr>';

                // Group by month
                const monthlyStats = {};
                inspections.forEach(i => {
                    const month = i.month || 'Unknown';
                    if (!monthlyStats[month]) {
                        monthlyStats[month] = { total: 0, discrepancies: 0 };
                    }
                    monthlyStats[month].total++;
                    if (i.discrepency) {
                        monthlyStats[month].discrepancies++;
                    }
                });

                // Month order for 2026
                const monthOrder = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                const monthlyHTML = monthOrder.map(month => {
                    const stats = monthlyStats[month] || { total: 0, discrepancies: 0 };
                    if (stats.total === 0) return '';
                    const monthPassRate = stats.total > 0 ? (((stats.total - stats.discrepancies) / stats.total) * 100).toFixed(1) : '100';
                    const statusBadge = parseFloat(monthPassRate) >= 95 ? '<span class="badge badge-green">‚úì Target Met</span>' :
                                       parseFloat(monthPassRate) >= 85 ? '<span class="badge badge-amber">Close</span>' :
                                       '<span class="badge badge-red">Below Target</span>';
                    return `
                        <tr>
                            <td><strong>${month}</strong></td>
                            <td>${stats.total}</td>
                            <td>${stats.discrepancies}</td>
                            <td>${monthPassRate}%</td>
                            <td>${statusBadge}</td>
                        </tr>
                    `;
                }).filter(row => row).join('');
                document.getElementById('monthlyTrend').innerHTML = monthlyHTML ||
                    '<tr><td colspan="5" style="text-align:center;">No monthly data available yet</td></tr>';

                // Load inspection details
                const detailHTML = inspections.map(i => {
                    const date = i.inspection_date ? new Date(i.inspection_date).toLocaleDateString() : '--';
                    const catBadge = i.category ? `<span class="badge badge-gray">${i.category}</span>` : '--';
                    return `
                        <tr>
                            <td>${date}</td>
                            <td><strong>${i.work_order || '--'}</strong></td>
                            <td>${i.tech || '--'}</td>
                            <td>${i.discrepency || '--'}</td>
                            <td>${catBadge}</td>
                            <td style="color: #94a3b8; font-size: 0.9em;">${i.resolution || 'Pending'}</td>
                        </tr>
                    `;
                }).join('');
                document.getElementById('inspectionDetails').innerHTML = detailHTML ||
                    '<tr><td colspan="6" style="text-align:center;">No inspection data for 2026</td></tr>';

            } catch (error) {
                console.error('Error loading quality data:', error);
                document.getElementById('qualityBadge').textContent = 'Error';
                document.getElementById('qualityBadge').className = 'badge badge-red';
            }
        }

        // Load Daily Metrics Data
        async function loadDailyMetrics() {
            try {
                console.log('Loading daily metrics...');
                const response = await fetch(`${SUPABASE_URL}/rest/v1/daily_metrics?select=*&order=report_date.desc&limit=10`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                const metrics = await response.json();
                console.log('Daily metrics received:', metrics);

                if (metrics.length > 0) {
                    const latest = metrics[0];

                    // Update current metrics
                    document.getElementById('soldHours').textContent = latest.total_sold_hours ? latest.total_sold_hours.toFixed(1) : '--';
                    document.getElementById('billedWOs').textContent = latest.billed_wo_count || '--';
                    document.getElementById('employeeCount').textContent = latest.employee_count || '--';

                    const avgHours = latest.total_sold_hours && latest.employee_count
                        ? (latest.total_sold_hours / latest.employee_count).toFixed(1)
                        : '--';
                    document.getElementById('hoursPerEmployee').textContent = avgHours;

                    const reportDate = new Date(latest.report_date).toLocaleDateString();
                    document.getElementById('soldHoursDate').textContent = reportDate;

                    // Status badge
                    document.getElementById('dailyMetricsBadge').textContent = 'Up to Date';
                    document.getElementById('dailyMetricsBadge').className = 'badge badge-green';

                    // Load history table
                    const historyHTML = metrics.map(m => {
                        const avg = m.total_sold_hours && m.employee_count
                            ? (m.total_sold_hours / m.employee_count).toFixed(1)
                            : '--';
                        return `
                            <tr>
                                <td>${new Date(m.report_date).toLocaleDateString()}</td>
                                <td><strong>${m.total_sold_hours ? m.total_sold_hours.toFixed(1) : '--'}</strong></td>
                                <td>${m.billed_wo_count || '--'}</td>
                                <td>${m.employee_count || '--'}</td>
                                <td>${avg}</td>
                            </tr>
                        `;
                    }).join('');
                    document.getElementById('dailyMetricsHistory').innerHTML = historyHTML;
                }
            } catch (error) {
                console.error('Error loading daily metrics:', error);
            }

            // Calculate A/B ratios from time_entries
            try {
                const timeResponse = await fetch(`${SUPABASE_URL}/rest/v1/time_entries?select=*`, {
                    headers: HEADERS
                });

                if (timeResponse.status === 200) {
                    const timeEntries = await timeResponse.json();

                    // Calculate Denver real-time A/B
                    let totalHours = 0;
                    let billableHours = 0;
                    let janTotal = 0;
                    let janBillable = 0;
                    let febTotal = 0;
                    let febBillable = 0;

                    timeEntries.forEach(entry => {
                        const hours = parseFloat(entry.hours) || 0;
                        const isBillable = entry.wo_type !== 'Shop' && hours > 0;
                        const entryDate = new Date(entry.entry_date);
                        const month = entryDate.getMonth() + 1;

                        totalHours += hours;
                        if (isBillable) billableHours += hours;

                        if (month === 1) {
                            janTotal += hours;
                            if (isBillable) janBillable += hours;
                        } else if (month === 2) {
                            febTotal += hours;
                            if (isBillable) febBillable += hours;
                        }
                    });

                    const denverAB = totalHours > 0 ? (billableHours / totalHours * 100) : 0;
                    const janAB = janTotal > 0 ? (janBillable / janTotal * 100) : 0;
                    const febAB = febTotal > 0 ? (febBillable / febTotal * 100) : 0;

                    // Calculate 1-month rolling (last 30 days)
                    const thirtyDaysAgo = new Date();
                    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                    let rollingTotal = 0;
                    let rollingBillable = 0;

                    timeEntries.forEach(entry => {
                        const entryDate = new Date(entry.entry_date);
                        if (entryDate >= thirtyDaysAgo) {
                            const hours = parseFloat(entry.hours) || 0;
                            const isBillable = entry.wo_type !== 'Shop' && hours > 0;
                            rollingTotal += hours;
                            if (isBillable) rollingBillable += hours;
                        }
                    });

                    const rollingAB = rollingTotal > 0 ? (rollingBillable / rollingTotal * 100) : 0;

                    // Update Denver side (right - green/blue)
                    document.getElementById('denverAB').textContent = `${denverAB.toFixed(1)}%`;
                    document.getElementById('denverRolling').textContent = `1-Month Rolling: ${rollingAB.toFixed(1)}%`;
                    document.getElementById('denverFebOnly').textContent = `Feb-only: ${febAB.toFixed(1)}% ${febAB >= 50 ? '‚úÖ Improving!' : ''}`;

                    // Update comparison stats
                    document.getElementById('janFinal').textContent = `${janAB.toFixed(1)}%`;
                    document.getElementById('febTrend').textContent = `${febAB.toFixed(1)}%`;
                    document.getElementById('rollingAvg').textContent = `${rollingAB.toFixed(1)}%`;

                    // Update status message
                    let statusMsg = '';
                    let statusBg = '';
                    let statusBorder = '';
                    let statusColor = '';

                    if (febAB >= 58.5) {
                        statusMsg = `üéâ Feb is EXCELLENT! ${febAB.toFixed(1)}% Feb-only A/B vs ${janAB.toFixed(1)}% Jan final. AT TARGET! Keep it up!`;
                        statusBg = '#065f46';
                        statusBorder = '#10b981';
                        statusColor = '#10b981';
                    } else if (febAB >= 50) {
                        statusMsg = `‚úÖ Feb is STRONG! ${febAB.toFixed(1)}% Feb-only A/B vs ${janAB.toFixed(1)}% Jan final. Nearly at 58.5% target! Keep pushing.`;
                        statusBg = '#065f46';
                        statusBorder = '#10b981';
                        statusColor = '#10b981';
                    } else if (febAB > janAB) {
                        statusMsg = `üìà Feb is improving! ${febAB.toFixed(1)}% Feb-only A/B vs ${janAB.toFixed(1)}% Jan final. Still below 58.5% target - push harder!`;
                        statusBg = '#78350f';
                        statusBorder = '#f59e0b';
                        statusColor = '#fbbf24';
                    } else {
                        statusMsg = `üî¥ Feb needs work! ${febAB.toFixed(1)}% Feb-only A/B vs ${janAB.toFixed(1)}% Jan final. Below 58.5% target - critical!`;
                        statusBg = '#7f1d1d';
                        statusBorder = '#ef4444';
                        statusColor = '#ef4444';
                    }

                    const statusEl = document.getElementById('abStatusMessage');
                    if (statusEl) {
                        statusEl.style.background = statusBg;
                        statusEl.style.borderLeft = `4px solid ${statusBorder}`;
                        statusEl.innerHTML = `<div style="color: ${statusColor}; font-weight: bold;">${statusMsg}</div>`;
                    }

                    // Matt's numbers from latest rankings data - fetch from database
                    try {
                        const rankingsResponse = await fetch(`${SUPABASE_URL}/rest/v1/rankings?select=*&order=week_ending.desc&limit=1`, {
                            headers: HEADERS
                        });

                        if (rankingsResponse.status === 200) {
                            const rankings = await rankingsResponse.json();
                            if (rankings.length > 0) {
                                const rank = rankings[0];
                                const mattAB = rank.denver_ab_actual;
                                const mattBudget = rank.denver_ab_budget;
                                const mattGap = (mattAB - mattBudget).toFixed(1);

                                // Parse date correctly (add time to avoid timezone issues)
                                const weekEnding = new Date(rank.week_ending + 'T12:00:00');
                                const monthName = weekEnding.toLocaleDateString('en-US', { month: 'short' });
                                const dayNum = weekEnding.getDate();

                                document.getElementById('mattAB').textContent = `${mattAB}%`;
                                document.getElementById('mattPeriod').textContent = `Latest (${monthName} ${dayNum} Update)`;
                                document.getElementById('mattRank').textContent = `Rank: ${rank.denver_position}${getOrdinalSuffix(rank.denver_position)}/${rank.total_shops} | Gap: ${mattGap} pts`;
                                document.getElementById('janRank').textContent = `${rank.denver_position}${getOrdinalSuffix(rank.denver_position)}`;
                            }
                        }
                    } catch (error) {
                        console.error('Error loading Matt rankings:', error);
                    }
                }
            } catch (error) {
                console.error('Error calculating A/B ratios:', error);
            }
        }

        // OLD FUNCTION - NOT USED
        async function loadOverviewEmployeeAB_OLD() {
            console.log('loadOverviewEmployeeAB: Starting...');

            try {
                // Fetch all time entries
                const response = await fetch(`${SUPABASE_URL}/rest/v1/time_entries?select=*`, {
                    headers: HEADERS
                });

                if (response.status === 404) {
                    document.getElementById('overviewEmployeeABCards').innerHTML = '<p style="text-align:center; color:#94a3b8;">No time data available yet</p>';
                    return;
                }

                const timeEntries = await response.json();

                // Group by employee
                const employeeData = {};

                timeEntries.forEach(entry => {
                    const empCode = entry.emp_code;
                    if (!empCode) return;

                    if (!employeeData[empCode]) {
                        employeeData[empCode] = {
                            name: entry.emp_name,
                            code: empCode,
                            ytd: { total: 0, billable: 0 },
                            feb: { total: 0, billable: 0 }
                        };
                    }

                    const hours = parseFloat(entry.hours) || 0;
                    const isBillable = entry.wo_type !== 'Shop' && hours > 0;
                    const entryDate = new Date(entry.entry_date);
                    const month = entryDate.getMonth() + 1;

                    // YTD
                    employeeData[empCode].ytd.total += hours;
                    if (isBillable) employeeData[empCode].ytd.billable += hours;

                    // Feb MTD
                    if (month === 2) {
                        employeeData[empCode].feb.total += hours;
                        if (isBillable) employeeData[empCode].feb.billable += hours;
                    }
                });

                // Convert to array and sort by YTD A/B
                const employees = Object.values(employeeData).map(emp => {
                    const ytdAB = emp.ytd.total > 0 ? (emp.ytd.billable / emp.ytd.total * 100) : 0;
                    const febAB = emp.feb.total > 0 ? (emp.feb.billable / emp.feb.total * 100) : 0;
                    return { ...emp, ytdAB, febAB };
                });

                employees.sort((a, b) => b.ytdAB - a.ytdAB);

                // Generate employee cards (matching rankings format)
                const cardsHTML = employees.map(emp => {
                    const ytdVariance = (emp.ytdAB - 58.5).toFixed(1);
                    const ytdColor = emp.ytdAB >= 58.5 ? '#10b981' : '#ef4444';
                    const febColor = emp.febAB >= 58.5 ? '#10b981' : emp.febAB >= 40 ? '#f59e0b' : '#ef4444';

                    let statusBadge = '';
                    let statusClass = '';
                    if (emp.ytdAB >= 58.5) {
                        statusBadge = 'On Target';
                        statusClass = 'badge-green';
                    } else if (emp.ytdAB >= 40) {
                        statusBadge = 'Below Target';
                        statusClass = 'badge-amber';
                    } else {
                        statusBadge = 'Critical';
                        statusClass = 'badge-red';
                    }

                    return `
                        <div class="card">
                            <div class="card-header">
                                <span class="card-title">üë§ ${emp.name} (${emp.code})</span>
                                <span class="badge ${statusClass}">${statusBadge}</span>
                            </div>
                            <div class="card-grid">
                                <div class="metric">
                                    <div class="metric-value" style="color:${ytdColor};">${emp.ytdAB.toFixed(1)}%</div>
                                    <div class="metric-label">YTD A/B Percentage</div>
                                    <div class="metric-sub">${emp.ytd.billable.toFixed(1)} / ${emp.ytd.total.toFixed(1)} hrs</div>
                                </div>
                                <div class="metric">
                                    <div class="metric-value">58.5%</div>
                                    <div class="metric-label">A/B Target</div>
                                    <div class="metric-sub">Budget Goal</div>
                                </div>
                                <div class="metric">
                                    <div class="metric-value" style="color:${ytdColor};">${ytdVariance > 0 ? '+' : ''}${ytdVariance}%</div>
                                    <div class="metric-label">Variance</div>
                                    <div class="metric-sub">vs Target</div>
                                </div>
                                <div class="metric">
                                    <div class="metric-value" style="color:${febColor};">${emp.febAB.toFixed(1)}%</div>
                                    <div class="metric-label">Feb MTD A/B</div>
                                    <div class="metric-sub">${emp.feb.billable.toFixed(1)} / ${emp.feb.total.toFixed(1)} hrs</div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                document.getElementById('overviewEmployeeABCards').innerHTML = cardsHTML;

                console.log('loadOverviewEmployeeAB: Complete');
            } catch (error) {
                console.error('Error loading overview employee A/B:', error);
                document.getElementById('overviewEmployeeABCards').innerHTML = '<p style="text-align:center; color:#ef4444;">Error loading employee performance data</p>';
            }
        }

        // Load Goals Data
        async function loadGoalsData() {
            console.log('loadGoalsData: Starting...');
            try {
                // Get latest metrics and rankings data
                const [metricsResp, rankingsResp] = await Promise.all([
                    fetch(`${SUPABASE_URL}/rest/v1/daily_metrics?select=*&order=report_date.desc&limit=1`, {
                        headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
                    }),
                    fetch(`${SUPABASE_URL}/rest/v1/rankings?select=*&order=week_ending.desc&limit=1`, {
                        headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
                    })
                ]);

                const metrics = await metricsResp.json();
                const rankings = await rankingsResp.json();

                console.log('loadGoalsData: Got metrics:', metrics.length, 'rankings:', rankings.length);

                if (metrics.length > 0 && rankings.length > 0) {
                    const latest = metrics[0];
                    const rank = rankings[0];

                    // Calculate A/B ratio (from rankings data which has the actual A/B%)
                    const abPercentage = rank.denver_ab_actual;
                    const target = 58.5;
                    const gap = (target - abPercentage).toFixed(1);

                    // Update Goal #1 metrics
                    document.getElementById('currentAB').textContent = `${abPercentage}%`;
                    document.getElementById('networkRank').textContent = `#${rank.denver_position}`;

                    // Progress bar and status
                    const progress = (abPercentage / target * 100).toFixed(0);
                    const progressBar = document.getElementById('abProgressBar');
                    const progressPct = document.getElementById('abProgressPct');

                    if (progressBar && progressPct) {
                        progressBar.style.width = `${Math.min(progress, 100)}%`;
                        progressPct.textContent = `${abPercentage}%`;
                        console.log('Goal #1: Set progress bar to', progress, '% | A/B:', abPercentage);
                    } else {
                        console.error('Goal #1: Progress bar elements not found!');
                    }

                    if (abPercentage >= target) {
                        document.getElementById('abGoalBadge').textContent = '‚úÖ Goal Met!';
                        document.getElementById('abGoalBadge').className = 'badge badge-green';
                        progressBar.className = 'progress-fill progress-green';
                        progressPct.style.color = '#10b981';
                    } else if (progress >= 75) {
                        document.getElementById('abGoalBadge').textContent = `${progress}% to Goal`;
                        document.getElementById('abGoalBadge').className = 'badge badge-amber';
                        progressBar.className = 'progress-fill progress-amber';
                        progressPct.style.color = '#f59e0b';
                    } else {
                        document.getElementById('abGoalBadge').textContent = `${progress}% to Goal`;
                        document.getElementById('abGoalBadge').className = 'badge badge-red';
                        progressBar.className = 'progress-fill progress-red';
                        progressPct.style.color = '#ef4444';
                    }
                }

                // Goal #2: NPS Program Participation
                // Get current month's data
                const now = new Date();
                const firstDayOfMonth = new Date(now.getFullYear(), now.getMonth(), 1).toISOString().split('T')[0];
                const firstDayOfYear = new Date(now.getFullYear(), 0, 1).toISOString().split('T')[0];

                // Fetch NPS surveys from this month and year
                const [npsMonthResp, npsYearResp, metricsMonthResp] = await Promise.all([
                    fetch(`${SUPABASE_URL}/rest/v1/nps_surveys?select=*&date_sent=gte.${firstDayOfMonth}&order=date_sent.desc`, {
                        headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
                    }),
                    fetch(`${SUPABASE_URL}/rest/v1/nps_surveys?select=*&date_sent=gte.${firstDayOfYear}&order=date_sent.desc`, {
                        headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
                    }),
                    fetch(`${SUPABASE_URL}/rest/v1/daily_metrics?select=billed_wo_count,report_date&report_date=gte.${firstDayOfMonth}&order=report_date.desc`, {
                        headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
                    })
                ]);

                const npsMonth = await npsMonthResp.json();
                const npsYear = await npsYearResp.json();
                const metricsMonth = await metricsMonthResp.json();

                // Sum up billed WOs for the month
                const totalBilledWOs = metricsMonth.reduce((sum, day) => sum + (day.billed_wo_count || 0), 0);

                // Count NPS surveys sent this month and YTD
                const entriesThisMonth = npsMonth.length;
                const entriesYTD = npsYear.length;
                const completedYTD = npsYear.filter(s => s.status === 'Completed').length;
                const monthlyGoal = 1;

                // Update Goal #2 metrics
                document.getElementById('surveysSent').textContent = entriesThisMonth;
                document.getElementById('billedWOsMonth').textContent = totalBilledWOs;
                document.getElementById('pendingSurveys').textContent = completedYTD;

                // Progress bar and status (annual goal: 12 COMPLETED surveys)
                const annualGoal = 12;
                const npsProgress = (completedYTD / annualGoal * 100).toFixed(0);
                const npsProgressBar = document.getElementById('npsProgressBar');
                const npsProgressPct = document.getElementById('npsProgressPct');

                npsProgressBar.style.width = `${Math.min(npsProgress, 100)}%`;
                npsProgressPct.textContent = `${completedYTD}/12`;

                // Badge shows monthly status (monthlyGoal already declared above)
                if (completedYTD >= annualGoal) {
                    document.getElementById('npsGoalBadge').textContent = '‚úÖ Annual Goal Met!';
                    document.getElementById('npsGoalBadge').className = 'badge badge-green';
                    npsProgressBar.className = 'progress-fill progress-green';
                    npsProgressPct.style.color = '#10b981';
                } else if (entriesThisMonth >= monthlyGoal) {
                    document.getElementById('npsGoalBadge').textContent = '‚úÖ This Month Met';
                    document.getElementById('npsGoalBadge').className = 'badge badge-green';
                    npsProgressBar.className = 'progress-fill progress-amber';
                    npsProgressPct.style.color = '#f59e0b';
                } else if (completedYTD > 0) {
                    document.getElementById('npsGoalBadge').textContent = `${npsProgress}% to Annual`;
                    document.getElementById('npsGoalBadge').className = 'badge badge-amber';
                    npsProgressBar.className = 'progress-fill progress-amber';
                    npsProgressPct.style.color = '#f59e0b';
                } else {
                    document.getElementById('npsGoalBadge').textContent = 'No completions yet';
                    document.getElementById('npsGoalBadge').className = 'badge badge-red';
                    npsProgressBar.className = 'progress-fill progress-red';
                    npsProgressPct.style.color = '#ef4444';
                }

                // Goal #3: Training Completion
                const trainingResp = await fetch(`${SUPABASE_URL}/rest/v1/training?select=*&order=due_date.asc`, {
                    headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
                });
                const training = await trainingResp.json();

                // Count by status
                const completedCount = training.filter(t => t.status === 'Completed').length;
                const pastDueCount = training.filter(t => t.status === 'Past Due').length;

                // Count upcoming (due within 30 days)
                const today = new Date();
                const thirtyDaysFromNow = new Date(today);
                thirtyDaysFromNow.setDate(today.getDate() + 30);
                const upcomingCount = training.filter(t => {
                    if (!t.due_date) return false;
                    const dueDate = new Date(t.due_date);
                    return dueDate > today && dueDate <= thirtyDaysFromNow;
                }).length;

                // Calculate completion rate
                const totalTraining = training.length;
                const completionRate = totalTraining > 0 ? ((completedCount / totalTraining) * 100).toFixed(1) : '0.0';

                // Update Goal #3 metrics
                document.getElementById('completedTraining').textContent = completedCount;
                document.getElementById('pastDueTraining').textContent = pastDueCount;
                document.getElementById('upcomingTraining').textContent = upcomingCount;

                // Progress bar and status
                const trainingProgressBar = document.getElementById('trainingProgressBar');
                const trainingProgressPct = document.getElementById('trainingProgressPct');

                trainingProgressBar.style.width = `${completionRate}%`;
                trainingProgressPct.textContent = `${completionRate}%`;

                if (pastDueCount === 0 && parseFloat(completionRate) === 100) {
                    document.getElementById('trainingGoalBadge').textContent = '‚úÖ Goal Met!';
                    document.getElementById('trainingGoalBadge').className = 'badge badge-green';
                    trainingProgressBar.className = 'progress-fill progress-green';
                    trainingProgressPct.style.color = '#10b981';
                } else if (pastDueCount > 0) {
                    document.getElementById('trainingGoalBadge').textContent = `${pastDueCount} Past Due`;
                    document.getElementById('trainingGoalBadge').className = 'badge badge-red';
                    trainingProgressBar.className = 'progress-fill progress-red';
                    trainingProgressPct.style.color = '#ef4444';
                } else {
                    document.getElementById('trainingGoalBadge').textContent = `${completionRate}% Complete`;
                    document.getElementById('trainingGoalBadge').className = 'badge badge-amber';
                    trainingProgressBar.className = 'progress-fill progress-amber';
                    trainingProgressPct.style.color = '#f59e0b';
                }

                // Goal #7: FAA & Internal Audits (No Findings)
                const auditResponse = await fetch(`${SUPABASE_URL}/rest/v1/inspections?year=eq.2026`, {
                    headers: HEADERS
                });

                // Check if table exists
                if (auditResponse.status === 404) {
                    console.log('Inspections table not created yet - Goal #7');
                    document.getElementById('auditGoalBadge').textContent = 'Setup Required';
                    document.getElementById('auditGoalBadge').className = 'badge badge-gray';
                    document.getElementById('auditTotal').textContent = '0';
                    document.getElementById('auditPassed').textContent = '0';
                    document.getElementById('auditFindings').textContent = '0';
                    document.getElementById('auditProgressBar').style.width = '0%';
                    document.getElementById('auditProgressPct').textContent = '0/0';
                } else {
                    const audits = await auditResponse.json();

                    const totalAudits = audits.length;
                const findingsCount = audits.filter(a => a.discrepency).length;
                const noFindingsCount = totalAudits - findingsCount;
                const passRate = totalAudits > 0 ? ((noFindingsCount / totalAudits) * 100).toFixed(0) : '100';

                // Update Goal #7 metrics
                document.getElementById('auditTotal').textContent = totalAudits;
                document.getElementById('auditPassed').textContent = noFindingsCount;
                document.getElementById('auditFindings').textContent = findingsCount;

                // Progress bar and status (100% = no findings target)
                const auditProgressBar = document.getElementById('auditProgressBar');
                const auditProgressPct = document.getElementById('auditProgressPct');

                auditProgressBar.style.width = `${passRate}%`;
                auditProgressPct.textContent = `${noFindingsCount}/${totalAudits}`;

                if (findingsCount === 0 && totalAudits > 0) {
                    document.getElementById('auditGoalBadge').textContent = '‚úÖ Goal Met!';
                    document.getElementById('auditGoalBadge').className = 'badge badge-green';
                    auditProgressBar.className = 'progress-fill progress-green';
                } else if (findingsCount > 0) {
                    document.getElementById('auditGoalBadge').textContent = `${findingsCount} Findings`;
                    document.getElementById('auditGoalBadge').className = 'badge badge-red';
                    auditProgressBar.className = 'progress-fill progress-red';
                } else {
                    document.getElementById('auditGoalBadge').textContent = 'No Audits Yet';
                    document.getElementById('auditGoalBadge').className = 'badge badge-gray';
                    auditProgressBar.className = 'progress-fill progress-gray';
                }
                }

            } catch (error) {
                console.error('Error loading goals data:', error);
                document.getElementById('abGoalBadge').textContent = 'Error';
                document.getElementById('abGoalBadge').className = 'badge badge-red';
                document.getElementById('npsGoalBadge').textContent = 'Error';
                document.getElementById('npsGoalBadge').className = 'badge badge-red';
                document.getElementById('trainingGoalBadge').textContent = 'Error';
                document.getElementById('trainingGoalBadge').className = 'badge badge-red';
                document.getElementById('auditGoalBadge').textContent = 'Error';
                document.getElementById('auditGoalBadge').className = 'badge badge-red';
            }
        }

        // NPS Survey Functions
        function fillNPSForm(customer, email, wo, reg) {
            document.getElementById('customerName').value = customer;
            document.getElementById('customerEmail').value = email;
            document.getElementById('woNumber').value = wo || '';
            document.getElementById('regNumber').value = reg || '';

            // Scroll to form
            document.querySelector('#npsForm').scrollIntoView({ behavior: 'smooth' });
        }

        async function sendNPSSurvey(event) {
            event.preventDefault();

            const customer = document.getElementById('customerName').value;
            const email = document.getElementById('customerEmail').value;
            const wo = document.getElementById('woNumber').value;
            const reg = document.getElementById('regNumber').value;

            // Open Outlook with pre-filled email
            const subject = reg ?
                `Customer Survey - ${reg} - WO ${wo}` :
                `Customer Survey - WO ${wo}`;

            const body = `Dear ${customer},%0D%0A%0D%0AThank you for choosing Denver Satellite for your aircraft maintenance needs. We value your feedback!%0D%0A%0D%0APlease take a moment to complete our brief satisfaction survey:%0D%0A%0D%0Ahttps://form.jotform.com/231574976012155%0D%0A%0D%0AWork Order: ${wo}%0D%0AAircraft: ${reg || 'N/A'}%0D%0A%0D%0ABest regards,%0D%0ADenver Satellite Team`;

            const mailtoLink = `mailto:${email}?subject=${encodeURIComponent(subject)}&body=${body}`;
            window.open(mailtoLink);

            // Log to Supabase
            await logNPSSurvey(customer, email, wo, reg);
        }

        async function logOnlyNPS() {
            const customer = document.getElementById('customerName').value;
            const email = document.getElementById('customerEmail').value;
            const wo = document.getElementById('woNumber').value;
            const reg = document.getElementById('regNumber').value;

            if (!customer || !email || !wo) {
                alert('Please fill in Customer Name, Email, and Work Order #');
                return;
            }

            await logNPSSurvey(customer, email, wo, reg);
        }

        async function logNPSSurvey(customer, email, wo, reg) {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/nps_surveys`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=representation'
                    },
                    body: JSON.stringify({
                        date_sent: new Date().toISOString().split('T')[0],
                        customer: customer,
                        email: email,
                        wo_number: wo,
                        reg_number: reg || null,
                        status: 'Sent',
                        month: new Date().toISOString().slice(0, 7)
                    })
                });

                if (response.ok) {
                    alert(`‚úÖ NPS Survey logged for ${customer}!`);
                    document.getElementById('npsForm').reset();
                    loadActionsData();
                } else {
                    alert('‚ùå Error logging survey. Please try again.');
                }
            } catch (error) {
                console.error('Error logging NPS:', error);
                alert('‚ùå Error logging survey. Please try again.');
            }
        }

        async function loadActionsData() {
            // Load customer recommendations and recent activity
            try {
                // Get recent NPS activity
                const activityResp = await fetch(`${SUPABASE_URL}/rest/v1/nps_surveys?select=*&order=date_sent.desc&limit=10`, {
                    headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
                });
                const activity = await activityResp.json();

                // Update activity table
                const activityHTML = activity.map(survey => {
                    const statusClass = survey.status === 'Completed' ? 'badge-green' : 'badge-amber';
                    return `
                        <tr>
                            <td>${new Date(survey.date_sent).toLocaleDateString()}</td>
                            <td>${survey.customer}</td>
                            <td>${survey.wo_number}</td>
                            <td><span class="badge ${statusClass}">${survey.status}</span></td>
                            <td>${survey.score || '-'}</td>
                        </tr>
                    `;
                }).join('');
                document.getElementById('npsActivity').innerHTML = activityHTML || '<tr><td colspan="5" style="text-align:center; color:#94a3b8;">No recent activity</td></tr>';

                document.getElementById('activityBadge').textContent = `${activity.length} Recent`;
                document.getElementById('activityBadge').className = 'badge badge-green';

                // TODO: Load customer recommendations from work_orders + customers tables
                document.getElementById('recommendBadge').textContent = 'Coming Soon';
                document.getElementById('recommendBadge').className = 'badge badge-amber';

            } catch (error) {
                console.error('Error loading actions data:', error);
            }
        }

        // Load Employee Data
        async function loadEmployeeData() {
            console.log('loadEmployeeData: Starting...');

            // Employee data (from Team Members with emails.xlsx)
            const employees = [
                {name: 'Armando Triana-Cruz', code: 'CRUZA', title: 'Sat Avionics Tech II', qi: 'Y', rts: '2', sra: 'Y', stamps: 'QI 3019, SRI 1324', exp: 15, rating: 'R'},
                {name: 'Michael Hannas', code: 'HMICH', title: 'Sat Avionics Tech III', qi: 'Y', rts: '2', sra: 'Y', stamps: 'QI 2437, SRI 905', exp: 29, rating: 'A&P'},
                {name: 'Michael Huber', code: 'HUBEM', title: 'Crew Ldr - Sat Avionics', qi: 'Y', rts: '2', sra: 'Y', stamps: 'QI 2653, SRI 1070, SRI 641', exp: 10, rating: 'R'},
                {name: 'Julia Langford', code: 'LANJU', title: 'Sat Install Spec II', qi: 'Y', rts: '2', sra: 'Y', stamps: 'QI 3005, SRI 1207', exp: 12, rating: 'A'},
                {name: 'Sean R Macoomb', code: 'MACOS', title: 'Crew Ldr - Sat Avionics', qi: 'Y', rts: '2', sra: 'Y', stamps: 'QI 1111, SRI 415', exp: 32, rating: 'R'},
                {name: 'Juan R Medina', code: 'MEDIJ', title: 'Satellite Sheetmetal Tech III', qi: 'N', rts: '', sra: 'Y', stamps: 'SRI 1120', exp: 0, rating: ''},
                {name: 'Jose Noris', code: 'NORIJ', title: 'Crew Ldr - Sat Install', qi: 'Y', rts: '2', sra: 'Y', stamps: 'QI 3018, SRI 1338', exp: 6, rating: 'R'},
                {name: 'Kim D Owen', code: 'OWEKI', title: 'Customer Account Rep III - Sat', qi: 'N', rts: '', sra: 'Y', stamps: 'SRI 253', exp: 0, rating: ''},
                {name: 'Edduyn Pita', code: 'PITAE', title: 'Manager - Sat Avionics/Install', qi: 'Y', rts: '2', sra: 'Y', stamps: 'QI 1066, SRI 286', exp: 30, rating: 'RAP'},
                {name: 'Douglas Riera Guzman', code: 'RIERD', title: 'Sat Install Spec II', qi: 'N', rts: '', sra: 'Y', stamps: 'SRI 1254', exp: 0, rating: ''},
                {name: 'Kenneth O Smith', code: 'SMIKZ', title: 'Team Ldr - Sat Avionics', qi: 'Y', rts: '2', sra: 'Y', stamps: 'QI 1473, SRI 341', exp: 35, rating: 'R'},
                {name: 'Guillermo Tovar Sanchez', code: 'TOVAG', title: 'Sat Install Spec I', qi: 'N', rts: '', sra: 'N', stamps: 'SRI 1352', exp: 0, rating: ''},
                {name: 'Andrew Watson', code: 'WATAN', title: 'Sat Install Spec II', qi: 'N', rts: '', sra: 'Y', stamps: 'SRI 1412', exp: 0, rating: 'A&P'},
                {name: 'John Watson', code: 'WATJO', title: 'Team Ldr - Sat Install', qi: 'Y', rts: '2', sra: 'Y', stamps: 'QI 2258, SRI 714', exp: 11, rating: 'R'}
            ];

            // Team Roster
            const rosterHTML = employees.map(emp => {
                const qiBadge = emp.qi === 'Y' ? '<span class="badge badge-green">‚úì</span>' : '<span class="badge badge-gray">-</span>';
                const rtsBadge = emp.rts === '2' ? '<span class="badge badge-green">‚úì</span>' : '<span class="badge badge-gray">-</span>';
                const sraBadge = emp.sra === 'Y' ? '<span class="badge badge-green">‚úì</span>' : '<span class="badge badge-gray">-</span>';
                return `
                    <tr>
                        <td><strong>${emp.name}</strong></td>
                        <td>${emp.code}</td>
                        <td>${emp.title}</td>
                        <td>${qiBadge}</td>
                        <td>${rtsBadge}</td>
                        <td>${sraBadge}</td>
                        <td style="color:#94a3b8; font-size:0.85em;">${emp.stamps}</td>
                        <td>${emp.exp > 0 ? emp.exp : '-'}</td>
                        <td>${emp.rating || '-'}</td>
                    </tr>
                `;
            }).join('');
            document.getElementById('rosterTable').innerHTML = rosterHTML;

            // Load A/B Performance data from Supabase
            loadYTDAB();
            loadMonthlyAB();
            loadIndividualAB();

            console.log('loadEmployeeData: Complete');
        }

        // Load YTD A/B Performance
        async function loadYTDAB() {
            console.log('loadYTDAB: Starting...');

            try {
                // Fetch all time entries
                const response = await fetch(`${SUPABASE_URL}/rest/v1/time_entries?select=*`, {
                    headers: HEADERS
                });

                if (response.status === 404) {
                    document.getElementById('ytdABTable').innerHTML = '<tr><td colspan="6" style="text-align:center; color:#94a3b8;">No time data available yet</td></tr>';
                    return;
                }

                const timeEntries = await response.json();

                // Group by employee
                const employeeStats = {};

                timeEntries.forEach(entry => {
                    const empCode = entry.emp_code;
                    if (!empCode) return;

                    if (!employeeStats[empCode]) {
                        employeeStats[empCode] = {
                            name: entry.emp_name,
                            code: empCode,
                            totalHours: 0,
                            billableHours: 0
                        };
                    }

                    const hours = parseFloat(entry.hours) || 0;
                    employeeStats[empCode].totalHours += hours;

                    // Billable = Customer work orders (not Shop WOs)
                    if (entry.wo_type !== 'Shop' && hours > 0) {
                        employeeStats[empCode].billableHours += hours;
                    }
                });

                // Convert to array and calculate A/B
                const employeeData = Object.values(employeeStats).map(emp => {
                    const ab = emp.totalHours > 0 ? (emp.billableHours / emp.totalHours * 100) : 0;
                    return { ...emp, ab };
                });

                // Sort by A/B descending
                employeeData.sort((a, b) => b.ab - a.ab);

                // Generate HTML
                const ytdHTML = employeeData.map(emp => {
                    const abPct = emp.ab.toFixed(1);
                    let statusBadge = '';
                    let statusClass = '';

                    if (emp.ab >= 58.5) {
                        statusBadge = 'On Target';
                        statusClass = 'badge-green';
                    } else if (emp.ab >= 40) {
                        statusBadge = 'Below Target';
                        statusClass = 'badge-amber';
                    } else {
                        statusBadge = 'Critical';
                        statusClass = 'badge-red';
                    }

                    return `
                        <tr>
                            <td><strong>${emp.name}</strong></td>
                            <td>${emp.code}</td>
                            <td>${emp.totalHours.toFixed(1)}</td>
                            <td>${emp.billableHours.toFixed(1)}</td>
                            <td><strong>${abPct}%</strong></td>
                            <td><span class="badge ${statusClass}">${statusBadge}</span></td>
                        </tr>
                    `;
                }).join('');

                document.getElementById('ytdABTable').innerHTML = ytdHTML || '<tr><td colspan="6" style="text-align:center; color:#94a3b8;">No YTD data</td></tr>';

                console.log('loadYTDAB: Complete');
            } catch (error) {
                console.error('Error loading YTD A/B:', error);
                document.getElementById('ytdABTable').innerHTML = '<tr><td colspan="6" style="text-align:center; color:#ef4444;">Error loading YTD A/B data</td></tr>';
            }
        }

        // Load Monthly A/B Breakdown
        async function loadMonthlyAB() {
            console.log('loadMonthlyAB: Starting...');

            try {
                // Fetch all 2026 time entries
                const response = await fetch(`${SUPABASE_URL}/rest/v1/time_entries?select=*`, {
                    headers: HEADERS
                });

                if (response.status === 404) {
                    document.getElementById('monthlyABTable').innerHTML = '<tr><td colspan="7" style="text-align:center; color:#94a3b8;">No time data available yet</td></tr>';
                    return;
                }

                const timeEntries = await response.json();

                // Group by employee and month
                const employeeMonthly = {};

                timeEntries.forEach(entry => {
                    const empCode = entry.emp_code;
                    if (!empCode) return;

                    if (!employeeMonthly[empCode]) {
                        employeeMonthly[empCode] = {
                            name: entry.emp_name,
                            code: empCode,
                            jan: { total: 0, billable: 0 },
                            feb: { total: 0, billable: 0 }
                        };
                    }

                    const hours = parseFloat(entry.hours) || 0;
                    const entryDate = new Date(entry.entry_date);
                    const month = entryDate.getMonth() + 1; // 1 = Jan, 2 = Feb

                    if (month === 1) {
                        employeeMonthly[empCode].jan.total += hours;
                        if (entry.wo_type !== 'Shop' && hours > 0) {
                            employeeMonthly[empCode].jan.billable += hours;
                        }
                    } else if (month === 2) {
                        employeeMonthly[empCode].feb.total += hours;
                        if (entry.wo_type !== 'Shop' && hours > 0) {
                            employeeMonthly[empCode].feb.billable += hours;
                        }
                    }
                });

                // Convert to array
                const employeeData = Object.values(employeeMonthly);

                // Sort by February A/B percentage (descending - best to worst)
                employeeData.sort((a, b) => {
                    const febAB_a = a.feb.total > 0 ? (a.feb.billable / a.feb.total * 100) : 0;
                    const febAB_b = b.feb.total > 0 ? (b.feb.billable / b.feb.total * 100) : 0;
                    return febAB_b - febAB_a;
                });

                // Generate HTML
                const monthlyHTML = employeeData.map(emp => {
                    const janAB = emp.jan.total > 0 ? (emp.jan.billable / emp.jan.total * 100) : 0;
                    const febAB = emp.feb.total > 0 ? (emp.feb.billable / emp.feb.total * 100) : 0;

                    const janABColor = janAB >= 58.5 ? '#10b981' : janAB >= 40 ? '#f59e0b' : '#ef4444';
                    const febABColor = febAB >= 58.5 ? '#10b981' : febAB >= 40 ? '#f59e0b' : '#ef4444';

                    return `
                        <tr>
                            <td><strong>${emp.name}</strong></td>
                            <td>${emp.jan.total.toFixed(1)}</td>
                            <td>${emp.jan.billable.toFixed(1)}</td>
                            <td style="color:${janABColor}; font-weight:bold;">${janAB.toFixed(1)}%</td>
                            <td>${emp.feb.total.toFixed(1)}</td>
                            <td>${emp.feb.billable.toFixed(1)}</td>
                            <td style="color:${febABColor}; font-weight:bold;">${febAB.toFixed(1)}%</td>
                        </tr>
                    `;
                }).join('');

                document.getElementById('monthlyABTable').innerHTML = monthlyHTML || '<tr><td colspan="7" style="text-align:center; color:#94a3b8;">No monthly data</td></tr>';

                console.log('loadMonthlyAB: Complete');
            } catch (error) {
                console.error('Error loading monthly A/B:', error);
                document.getElementById('monthlyABTable').innerHTML = '<tr><td colspan="7" style="text-align:center; color:#ef4444;">Error loading monthly A/B data</td></tr>';
            }
        }

        // Load Individual A/B Performance
        async function loadIndividualAB() {
            console.log('loadIndividualAB: Starting...');

            try {
                // Calculate previous work day (skip weekends)
                const today = new Date();
                let previousWorkDay = new Date(today);
                previousWorkDay.setDate(previousWorkDay.getDate() - 1);

                // If previous day is Sunday (0), go back to Friday
                if (previousWorkDay.getDay() === 0) {
                    previousWorkDay.setDate(previousWorkDay.getDate() - 2);
                }
                // If previous day is Saturday (6), go back to Friday
                else if (previousWorkDay.getDay() === 6) {
                    previousWorkDay.setDate(previousWorkDay.getDate() - 1);
                }

                const previousWorkDayStr = previousWorkDay.toISOString().split('T')[0];
                const displayDate = previousWorkDay.toLocaleDateString('en-US', {
                    weekday: 'short',
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });

                // Update card title with actual date
                document.getElementById('individualABTitle').textContent = `‚è±Ô∏è Individual A/B Performance - ${displayDate}`;

                // Fetch time entries for previous work day
                const response = await fetch(`${SUPABASE_URL}/rest/v1/time_entries?entry_date=eq.${previousWorkDayStr}&select=*`, {
                    headers: HEADERS
                });

                if (response.status === 404) {
                    document.getElementById('individualABTable').innerHTML = '<tr><td colspan="7" style="text-align:center; color:#94a3b8;">No time data available yet</td></tr>';
                    return;
                }

                const timeEntries = await response.json();

                // Group by employee
                const employeeStats = {};
                const employeeWOs = {};

                timeEntries.forEach(entry => {
                    const empCode = entry.emp_code;
                    if (!empCode) return;

                    if (!employeeStats[empCode]) {
                        employeeStats[empCode] = {
                            name: entry.emp_name,
                            code: empCode,
                            totalHours: 0,
                            billableHours: 0
                        };
                        employeeWOs[empCode] = new Set();
                    }

                    const hours = parseFloat(entry.hours) || 0;
                    employeeStats[empCode].totalHours += hours;

                    // Billable = Customer work orders (not Shop WOs)
                    if (entry.wo_type !== 'Shop' && hours > 0) {
                        employeeStats[empCode].billableHours += hours;
                    }

                    // Track work orders
                    if (entry.wo_number && entry.wo_type !== 'Shop') {
                        employeeWOs[empCode].add(entry.wo_number);
                    }
                });

                // Convert to array and calculate A/B
                const employeeData = Object.values(employeeStats).map(emp => {
                    const ab = emp.totalHours > 0 ? (emp.billableHours / emp.totalHours * 100) : 0;
                    const woList = Array.from(employeeWOs[emp.code] || []).slice(0, 5); // First 5 WOs
                    return {
                        ...emp,
                        ab: ab,
                        workOrders: woList.join(', ') || 'Shop work only'
                    };
                });

                // Sort by A/B descending
                employeeData.sort((a, b) => b.ab - a.ab);

                // Generate HTML
                const abHTML = employeeData.map(emp => {
                    const abPct = emp.ab.toFixed(1);
                    let statusBadge = '';
                    let statusClass = '';

                    if (emp.ab >= 80) {
                        statusBadge = 'Excellent';
                        statusClass = 'badge-green';
                    } else if (emp.ab >= 60) {
                        statusBadge = 'Good';
                        statusClass = 'badge-green';
                    } else if (emp.ab >= 40) {
                        statusBadge = 'Fair';
                        statusClass = 'badge-amber';
                    } else {
                        statusBadge = 'Low';
                        statusClass = 'badge-red';
                    }

                    return `
                        <tr>
                            <td><strong>${emp.name}</strong></td>
                            <td>${emp.code}</td>
                            <td>${emp.totalHours.toFixed(1)}</td>
                            <td>${emp.billableHours.toFixed(1)}</td>
                            <td><strong>${abPct}%</strong></td>
                            <td><span class="badge ${statusClass}">${statusBadge}</span></td>
                            <td style="color:#94a3b8; font-size:0.85em;">${emp.workOrders}</td>
                        </tr>
                    `;
                }).join('');

                document.getElementById('individualABTable').innerHTML = abHTML || '<tr><td colspan="7" style="text-align:center; color:#94a3b8;">No employee time data for previous day</td></tr>';

                console.log('loadIndividualAB: Complete');
            } catch (error) {
                console.error('Error loading individual A/B:', error);
                document.getElementById('individualABTable').innerHTML = '<tr><td colspan="7" style="text-align:center; color:#ef4444;">Error loading A/B data</td></tr>';
            }
        }

        // Check for saved auth on page load
        console.log('Checking auth:', localStorage.getItem('denver_auth'));
        if (localStorage.getItem('denver_auth') === 'true') {
            console.log('Auto-login: User authenticated');
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            showTab(tabs[0]);
            loadDashboardData();
        } else {
            console.log('Auto-login: No saved auth, showing login screen');
        }

        // Refresh data every 5 minutes
        setInterval(loadDashboardData, 5 * 60 * 1000);
    </script>
</body>
</html>