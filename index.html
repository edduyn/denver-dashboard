<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Denver Satellite Dashboard</title>
    <link rel="manifest" href="data:application/json,{&quot;name&quot;:&quot;Denver Dashboard&quot;,&quot;short_name&quot;:&quot;Denver&quot;,&quot;display&quot;:&quot;standalone&quot;}">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); color: #fff; min-height: 100vh; }
        
        /* Login Screen */
        .login-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; padding: 20px; }
        .login-box { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border-radius: 20px; padding: 40px; text-align: center; max-width: 400px; width: 100%; }
        .login-box h1 { color: #f59e0b; margin-bottom: 10px; font-size: 1.8em; }
        .login-box p { color: #94a3b8; margin-bottom: 30px; }
        .login-box input { width: 100%; padding: 15px; border: 2px solid #334155; background: #1e293b; color: #fff; border-radius: 10px; font-size: 16px; margin-bottom: 15px; }
        .login-box input:focus { outline: none; border-color: #f59e0b; }
        .login-box button { width: 100%; padding: 15px; background: #f59e0b; color: #000; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; }
        .login-box button:hover { background: #d97706; }
        .error-msg { color: #ef4444; margin-top: 10px; display: none; }
        
        /* Main Dashboard */
        .dashboard { display: none; min-height: 100vh; }
        .header { background: rgba(0,0,0,0.3); padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
        .header-left { display: flex; align-items: center; gap: 15px; }
        .logo { height: 40px; }
        .header h1 { font-size: 1.3em; color: #f59e0b; }
        .header-right { display: flex; gap: 10px; align-items: center; }
        .header-btn { padding: 8px 15px; border-radius: 8px; border: none; cursor: pointer; font-size: 14px; font-weight: 500; }
        .btn-full { background: #3b82f6; color: #fff; }
        .btn-rotate { background: #10b981; color: #fff; }
        .btn-lock { background: #64748b; color: #fff; }
        .status-indicator { padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .status-active { background: #10b981; color: #fff; }
        .status-paused { background: #ef4444; color: #fff; }
        
        /* Tabs */
        .tabs { display: flex; background: rgba(0,0,0,0.2); padding: 10px; gap: 5px; overflow-x: auto; }
        .tab { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 500; white-space: nowrap; transition: all 0.3s; }
        .tab:hover { background: rgba(255,255,255,0.1); }
        .tab.active { background: #f59e0b; color: #000; }
        .tab-goals { border-left: 3px solid #8b5cf6; }
        .tab-actions { border-left: 3px solid #ef4444; }
        .tab-overview { border-left: 3px solid #3b82f6; }
        .tab-employees { border-left: 3px solid #10b981; }
        .tab-workorders { border-left: 3px solid #f97316; }
        .tab-quotes { border-left: 3px solid #ec4899; }
        .tab-quality { border-left: 3px solid #06b6d4; }
        .tab-rankings { border-left: 3px solid #eab308; }
        .tab-wip { border-left: 3px solid #22c55e; }
        .tab-training { border-left: 3px solid #a855f7; }
        
        /* Content */
        .content { padding: 20px; display: none; }
        .content.active { display: block; }
        
        /* Cards */
        .card { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border-radius: 15px; padding: 20px; margin-bottom: 15px; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .card-title { font-size: 1.1em; color: #f59e0b; }
        .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        
        /* Metrics */
        .metric { text-align: center; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px; }
        .metric-value { font-size: 2em; font-weight: bold; color: #f59e0b; }
        .metric-label { color: #94a3b8; font-size: 0.9em; margin-top: 5px; }
        .metric-sub { color: #64748b; font-size: 0.8em; }
        
        /* Progress Bars */
        .progress-container { margin: 10px 0; }
        .progress-bar { height: 20px; background: #334155; border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; border-radius: 10px; transition: width 0.5s; }
        .progress-green { background: linear-gradient(90deg, #10b981, #34d399); }
        .progress-amber { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
        .progress-red { background: linear-gradient(90deg, #ef4444, #f87171); }
        
        /* Tables */
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        th { color: #f59e0b; font-weight: 600; }
        tr:hover { background: rgba(255,255,255,0.05); }
        
        /* Status Badges */
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 0.8em; font-weight: 600; }
        .badge-green { background: #10b981; color: #fff; }
        .badge-amber { background: #f59e0b; color: #000; }
        .badge-red { background: #ef4444; color: #fff; }
        .badge-blue { background: #3b82f6; color: #fff; }
        .badge-gray { background: #64748b; color: #fff; }

        /* Goal Cards */
        .goal-card { background: rgba(0,0,0,0.2); border-radius: 12px; padding: 15px; margin-bottom: 12px; }
        .goal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .goal-title { font-weight: 600; font-size: 0.95em; }
        .goal-progress { display: flex; align-items: center; gap: 10px; }
        .goal-pct { font-size: 1.2em; font-weight: bold; }
        .goal-notes { color: #94a3b8; font-size: 0.85em; margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.1); }
        .goal-timeline { display: flex; align-items: center; gap: 8px; margin-top: 6px; }
        .timeline-bar { flex: 1; height: 6px; background: #334155; border-radius: 3px; overflow: hidden; position: relative; }
        .timeline-fill { height: 100%; border-radius: 3px; background: rgba(245,158,11,0.4); }
        .timeline-marker { position: absolute; top: -3px; width: 3px; height: 12px; background: #f59e0b; border-radius: 2px; }
        .timeline-label { font-size: 0.75em; color: #64748b; white-space: nowrap; }
        .goal-pace { font-size: 0.8em; margin-top: 4px; }
        .pace-ahead { color: #10b981; }
        .pace-behind { color: #ef4444; }
        .pace-ontrack { color: #f59e0b; }
        .goal-section-header { color: #f59e0b; font-size: 0.85em; font-weight: 600; margin: 18px 0 8px 0; padding: 6px 12px; background: rgba(245,158,11,0.1); border-radius: 8px; display: flex; align-items: center; gap: 6px; }
        .goal-section-header:first-of-type { margin-top: 0; }

        /* Month Timeline */
        .month-timeline { display: flex; gap: 4px; }
        .month-block { flex: 1; height: 32px; border-radius: 4px; background: #334155; display: flex; align-items: center; justify-content: center; font-size: 0.7em; font-weight: 600; transition: all 0.3s ease; }
        .month-block span { color: #64748b; }
        .month-block.complete { background: #10b981; }
        .month-block.complete span { color: #fff; }
        .month-block.current { background: #f59e0b; }
        .month-block.current span { color: #fff; }
        .month-block.future { background: #1e293b; }
        .month-block.future span { color: #475569; }
        
        /* Action Items */
        .action-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px; margin-bottom: 8px; }
        .action-check { width: 24px; height: 24px; border: 2px solid #64748b; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .action-check.checked { background: #10b981; border-color: #10b981; }
        .action-check.checked::after { content: '‚úì'; color: #fff; font-weight: bold; }
        .action-text { flex: 1; }
        .action-priority { padding: 2px 8px; border-radius: 4px; font-size: 0.75em; }
        .priority-high { background: #ef4444; color: #fff; }
        .priority-med { background: #f59e0b; color: #000; }
        
        /* Alert Banner */
        .alert-banner { background: linear-gradient(90deg, #ef4444, #dc2626); padding: 15px 20px; text-align: center; font-weight: 600; }
        
        /* Rankings specific */
        .rank-item { display: flex; align-items: center; gap: 15px; padding: 10px; border-radius: 8px; margin-bottom: 5px; }
        .rank-item.denver { background: rgba(245, 158, 11, 0.2); border: 2px solid #f59e0b; }
        .rank-num { width: 30px; height: 30px; background: #334155; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .rank-shop { flex: 1; }
        .rank-value { font-weight: bold; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .card-grid { grid-template-columns: 1fr 1fr; }
            .header h1 { font-size: 1.1em; }
            .metric-value { font-size: 1.5em; }
        }
    </style>
    <!-- Ralph Self-Healing System -->
    <script src="ralph-self-heal.js"></script>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <h1>üõ©Ô∏è Denver Satellite</h1>
            <p>Department 889 Performance Dashboard</p>
            <input type="password" id="passwordInput" placeholder="Enter access code" autocomplete="off" onkeypress="if(event.key==='Enter')login()">
            <button onclick="const p=document.getElementById('passwordInput').value; if(p==='denver889'){console.log('Login successful, setting localStorage');localStorage.setItem('denver_auth','true');console.log('localStorage set to:',localStorage.getItem('denver_auth'));document.getElementById('loginScreen').style.display='none';document.getElementById('dashboard').style.display='block';if(typeof loadDashboardData==='function')loadDashboardData();}else{document.getElementById('errorMsg').style.display='block';setTimeout(()=>document.getElementById('errorMsg').style.display='none',3000);}">Access Dashboard</button>
            <p class="error-msg" id="errorMsg">Invalid access code</p>
        </div>
    </div>
    
    <!-- Main Dashboard -->
    <div class="dashboard" id="dashboard">
        <div class="header">
            <div class="header-left">
                <h1>üõ©Ô∏è Denver Satellite (889)</h1>
                <span id="lastUpdated" style="color: #64748b; font-size: 0.75em; margin-left: 10px; white-space: nowrap;">Loading...</span>
            </div>
            <div class="header-right">
                <span class="status-indicator" id="statusIndicator">Ready</span>
                <button class="header-btn btn-full" onclick="toggleFullscreen()">‚õ∂ Full</button>
                <button class="header-btn btn-rotate" id="rotateBtn" onclick="toggleRotate()">‚ñ∂Ô∏è Auto</button>
                <button class="header-btn btn-lock" onclick="logout()">üîí Lock</button>
            </div>
        </div>
        
        <div class="tabs">
            <div class="tab tab-goals active" data-tab="goals">üéØ Goals</div>
            <div class="tab tab-actions" data-tab="actions">‚ö° Actions</div>
            <div class="tab tab-overview" data-tab="overview">üìä Overview</div>
            <div class="tab tab-employees" data-tab="employees">üë• Employees</div>
            <div class="tab tab-workorders" data-tab="workorders">üìã Work Orders</div>
            <div class="tab tab-training" data-tab="training">üìö Training</div>
            <div class="tab tab-quality" data-tab="quality">‚úÖ Quality</div>
            <div class="tab tab-wip" data-tab="wip">üí∞ WIP</div>
            <div class="tab tab-rankings" data-tab="rankings">üèÜ Rankings</div>
        </div>
        
        <!-- GOALS TAB -->
        <div class="content active" id="goals">
            <!-- All 11 Goals Dashboard -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üéØ 2026 Denver 889 Goals</span>
                    <span class="badge badge-amber" id="goalsActiveBadge">11 Goals</span>
                </div>
                <!-- 12-Month Timeline Indicator -->
                <div style="margin-bottom: 15px; padding: 10px 14px; background: rgba(245,158,11,0.08); border-radius: 10px; border: 1px solid rgba(245,158,11,0.2);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                        <span style="font-size: 0.85em; color: #f59e0b; font-weight: 600;">üìÖ 2026 Annual Timeline</span>
                        <span style="font-size: 0.8em; color: #94a3b8;" id="timelineStatus">--</span>
                    </div>
                    <div class="timeline-bar" style="height: 8px;">
                        <div class="timeline-fill" id="yearProgressFill" style="width: 0%;"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 4px;">
                        <span style="font-size: 0.7em; color: #64748b;">Jan</span>
                        <span style="font-size: 0.7em; color: #64748b;">Mar</span>
                        <span style="font-size: 0.7em; color: #64748b;">Jun</span>
                        <span style="font-size: 0.7em; color: #64748b;">Sep</span>
                        <span style="font-size: 0.7em; color: #64748b;">Dec</span>
                    </div>
                </div>

                <!-- Goal #1: Meet/Exceed Financial Objectives -->
                <div class="goal-card">
                    <div class="goal-header">
                        <span class="goal-title">üìä #1: Meet/Exceed Financial Objectives (A/B Ratio 58.5%, ELR)</span>
                        <span class="badge" id="abGoalBadge">Loading...</span>
                    </div>
                    <div class="goal-notes">
                        <strong>Current A/B:</strong> <span id="currentAB">--</span> |
                        <strong>Target:</strong> 58.5% |
                        <strong>Rank:</strong> <span id="networkRank">--</span> of 21 shops |
                        <strong>Gap:</strong> <span id="abGap">--</span>
                    </div>
                    <div class="goal-pace" id="abPace">Tracked via Dashboard</div>
                    <!-- 12-Month Progress Timeline -->
                    <div style="margin-top: 10px;">
                        <div style="font-size: 0.75em; color: #94a3b8; margin-bottom: 4px;">2026 Progress (Month <span id="abCurrentMonth">--</span>/12)</div>
                        <div class="month-timeline" id="abMonthTimeline">
                            <div class="month-block" data-month="1"><span>J</span></div>
                            <div class="month-block" data-month="2"><span>F</span></div>
                            <div class="month-block" data-month="3"><span>M</span></div>
                            <div class="month-block" data-month="4"><span>A</span></div>
                            <div class="month-block" data-month="5"><span>M</span></div>
                            <div class="month-block" data-month="6"><span>J</span></div>
                            <div class="month-block" data-month="7"><span>J</span></div>
                            <div class="month-block" data-month="8"><span>A</span></div>
                            <div class="month-block" data-month="9"><span>S</span></div>
                            <div class="month-block" data-month="10"><span>O</span></div>
                            <div class="month-block" data-month="11"><span>N</span></div>
                            <div class="month-block" data-month="12"><span>D</span></div>
                        </div>
                    </div>
                </div>

                <!-- Goal #2: NPS Survey - 1 Entry per Month -->
                <div class="goal-card">
                    <div class="goal-header">
                        <span class="goal-title">üìß #2: NPS Survey Program (1 entry per month minimum)</span>
                        <span class="badge" id="npsGoalBadge">Loading...</span>
                    </div>
                    <div class="goal-progress">
                        <div style="flex: 1;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="npsProgressBar" style="width: 0%;"></div>
                            </div>
                        </div>
                        <span class="goal-pct" id="npsProgressPct">--</span>
                    </div>
                    <div class="goal-notes">
                        <strong>YTD Completed:</strong> <span id="pendingSurveys">--</span> of 12 |
                        <strong>This Month Sent:</strong> <span id="surveysSent">--</span> |
                        <strong>Network Goal:</strong> 200 total
                    </div>
                    <div class="goal-pace" id="npsPace">Check NET Promoter results folder</div>

                    <!-- 12-Month Progress Timeline -->
                    <div style="margin-top: 10px;">
                        <div style="font-size: 0.75em; color: #94a3b8; margin-bottom: 4px;">2026 Progress (Month <span id="npsCurrentMonth">--</span>/12)</div>
                        <div class="month-timeline" id="npsMonthTimeline">
                            <div class="month-block" data-month="1"><span>J</span></div>
                            <div class="month-block" data-month="2"><span>F</span></div>
                            <div class="month-block" data-month="3"><span>M</span></div>
                            <div class="month-block" data-month="4"><span>A</span></div>
                            <div class="month-block" data-month="5"><span>M</span></div>
                            <div class="month-block" data-month="6"><span>J</span></div>
                            <div class="month-block" data-month="7"><span>J</span></div>
                            <div class="month-block" data-month="8"><span>A</span></div>
                            <div class="month-block" data-month="9"><span>S</span></div>
                            <div class="month-block" data-month="10"><span>O</span></div>
                            <div class="month-block" data-month="11"><span>N</span></div>
                            <div class="month-block" data-month="12"><span>D</span></div>
                        </div>
                    </div>
                </div>

                <!-- Goal #3: Complete Training On Time (100%) -->
                <div class="goal-card">
                    <div class="goal-header">
                        <span class="goal-title">üìö #3: Complete Mandatory/Technical Training On Time (100%)</span>
                        <span class="badge" id="trainingGoalBadge">Loading...</span>
                    </div>
                    <div class="goal-progress">
                        <div style="flex: 1;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="trainingProgressBar" style="width: 0%;"></div>
                            </div>
                        </div>
                        <span class="goal-pct" id="trainingProgressPct">--</span>
                    </div>
                    <div class="goal-notes">
                        <strong>Completed:</strong> <span id="completedTraining">--</span> |
                        <strong>Past Due:</strong> <span id="pastDueTraining" style="color: #ef4444;">--</span> |
                        <strong>Upcoming:</strong> <span id="upcomingTraining">--</span>
                    </div>
                    <div class="goal-pace" id="trainingPace">Includes NEO/NETO - Check Training Due Report</div>

                    <!-- 12-Month Progress Timeline -->
                    <div style="margin-top: 10px;">
                        <div style="font-size: 0.75em; color: #94a3b8; margin-bottom: 4px;">2026 Progress (Month <span id="trainingCurrentMonth">--</span>/12)</div>
                        <div class="month-timeline" id="trainingMonthTimeline">
                            <div class="month-block" data-month="1"><span>J</span></div>
                            <div class="month-block" data-month="2"><span>F</span></div>
                            <div class="month-block" data-month="3"><span>M</span></div>
                            <div class="month-block" data-month="4"><span>A</span></div>
                            <div class="month-block" data-month="5"><span>M</span></div>
                            <div class="month-block" data-month="6"><span>J</span></div>
                            <div class="month-block" data-month="7"><span>J</span></div>
                            <div class="month-block" data-month="8"><span>A</span></div>
                            <div class="month-block" data-month="9"><span>S</span></div>
                            <div class="month-block" data-month="10"><span>O</span></div>
                            <div class="month-block" data-month="11"><span>N</span></div>
                            <div class="month-block" data-month="12"><span>D</span></div>
                        </div>
                    </div>
                </div>

                <!-- Goal #4: Flat Rate System Re-evaluation -->
                <div class="goal-card">
                    <div class="goal-header">
                        <span class="goal-title">üîß #4: Flat Rate System Re-evaluation Using Hard Data</span>
                        <span class="badge badge-gray">Analysis</span>
                    </div>
                    <div class="goal-notes">
                        <strong>Objective:</strong> Success/Fail analysis of flat rate system<br>
                        <strong>Data Source:</strong> Hours Sold vs Hours Actual<br>
                        <strong>Status:</strong> Tracked via squawk_data.json
                    </div>

                    <!-- 12-Month Progress Timeline -->
                    <div style="margin-top: 10px;">
                        <div style="font-size: 0.75em; color: #94a3b8; margin-bottom: 4px;">2026 Progress (Month <span id="goal4CurrentMonth">--</span>/12)</div>
                        <div class="month-timeline" id="goal4MonthTimeline">
                            <div class="month-block" data-month="1"><span>J</span></div>
                            <div class="month-block" data-month="2"><span>F</span></div>
                            <div class="month-block" data-month="3"><span>M</span></div>
                            <div class="month-block" data-month="4"><span>A</span></div>
                            <div class="month-block" data-month="5"><span>M</span></div>
                            <div class="month-block" data-month="6"><span>J</span></div>
                            <div class="month-block" data-month="7"><span>J</span></div>
                            <div class="month-block" data-month="8"><span>A</span></div>
                            <div class="month-block" data-month="9"><span>S</span></div>
                            <div class="month-block" data-month="10"><span>O</span></div>
                            <div class="month-block" data-month="11"><span>N</span></div>
                            <div class="month-block" data-month="12"><span>D</span></div>
                        </div>
                    </div>
                </div>

                <!-- Goal #5: Customer Experience - Communication -->
                <div class="goal-card">
                    <div class="goal-header">
                        <span class="goal-title">üí¨ #5: Customer Experience - Prompt & Professional Communication</span>
                        <span class="badge badge-gray">Process</span>
                    </div>
                    <div class="goal-notes">
                        <strong>Objective:</strong> Prompt, professional customer communication<br>
                        <strong>Tracking:</strong> Manual/Process-based<br>
                        <strong>Standard:</strong> Timely responses and updates
                    </div>

                    <!-- 12-Month Progress Timeline -->
                    <div style="margin-top: 10px;">
                        <div style="font-size: 0.75em; color: #94a3b8; margin-bottom: 4px;">2026 Progress (Month <span id="goal5CurrentMonth">--</span>/12)</div>
                        <div class="month-timeline" id="goal5MonthTimeline">
                            <div class="month-block" data-month="1"><span>J</span></div>
                            <div class="month-block" data-month="2"><span>F</span></div>
                            <div class="month-block" data-month="3"><span>M</span></div>
                            <div class="month-block" data-month="4"><span>A</span></div>
                            <div class="month-block" data-month="5"><span>M</span></div>
                            <div class="month-block" data-month="6"><span>J</span></div>
                            <div class="month-block" data-month="7"><span>J</span></div>
                            <div class="month-block" data-month="8"><span>A</span></div>
                            <div class="month-block" data-month="9"><span>S</span></div>
                            <div class="month-block" data-month="10"><span>O</span></div>
                            <div class="month-block" data-month="11"><span>N</span></div>
                            <div class="month-block" data-month="12"><span>D</span></div>
                        </div>
                    </div>
                </div>

                <!-- Goal #6: Stay Within Expense Budget -->
                <div class="goal-card">
                    <div class="goal-header">
                        <span class="goal-title">üíµ #6: Stay Within Expense Budget</span>
                        <span class="badge badge-gray">Manual</span>
                    </div>
                    <div class="goal-notes">
                        <strong>Status:</strong> Check Financial Reports vs Budget<br>
                        <strong>Review:</strong> Monthly expense reports<br>
                        <strong>Target:</strong> Budget compliance
                    </div>

                    <!-- 12-Month Progress Timeline -->
                    <div style="margin-top: 10px;">
                        <div style="font-size: 0.75em; color: #94a3b8; margin-bottom: 4px;">2026 Progress (Month <span id="goal6CurrentMonth">--</span>/12)</div>
                        <div class="month-timeline" id="goal6MonthTimeline">
                            <div class="month-block" data-month="1"><span>J</span></div>
                            <div class="month-block" data-month="2"><span>F</span></div>
                            <div class="month-block" data-month="3"><span>M</span></div>
                            <div class="month-block" data-month="4"><span>A</span></div>
                            <div class="month-block" data-month="5"><span>M</span></div>
                            <div class="month-block" data-month="6"><span>J</span></div>
                            <div class="month-block" data-month="7"><span>J</span></div>
                            <div class="month-block" data-month="8"><span>A</span></div>
                            <div class="month-block" data-month="9"><span>S</span></div>
                            <div class="month-block" data-month="10"><span>O</span></div>
                            <div class="month-block" data-month="11"><span>N</span></div>
                            <div class="month-block" data-month="12"><span>D</span></div>
                        </div>
                    </div>
                </div>

                <!-- Goal #7: FAA/Internal Audits - Zero Findings -->
                <div class="goal-card">
                    <div class="goal-header">
                        <span class="goal-title">‚úÖ #7: Complete FAA/Internal Audits with No Findings</span>
                        <span class="badge" id="auditGoalBadge">Loading...</span>
                    </div>
                    <div class="goal-progress">
                        <div style="flex: 1;">
                            <div class="progress-bar">
                                <div class="progress-fill progress-green" id="auditProgressBar" style="width: 0%;"></div>
                            </div>
                        </div>
                        <span class="goal-pct" id="auditProgressPct">--</span>
                    </div>
                    <div class="goal-notes">
                        <strong>Audits Completed:</strong> <span id="auditsCompleted">--</span> |
                        <strong>Findings:</strong> <span id="auditFindings">--</span> |
                        <strong>Target:</strong> Zero findings
                    </div>

                    <!-- 12-Month Progress Timeline -->
                    <div style="margin-top: 10px;">
                        <div style="font-size: 0.75em; color: #94a3b8; margin-bottom: 4px;">2026 Progress (Month <span id="goal7CurrentMonth">--</span>/12)</div>
                        <div class="month-timeline" id="goal7MonthTimeline">
                            <div class="month-block" data-month="1"><span>J</span></div>
                            <div class="month-block" data-month="2"><span>F</span></div>
                            <div class="month-block" data-month="3"><span>M</span></div>
                            <div class="month-block" data-month="4"><span>A</span></div>
                            <div class="month-block" data-month="5"><span>M</span></div>
                            <div class="month-block" data-month="6"><span>J</span></div>
                            <div class="month-block" data-month="7"><span>J</span></div>
                            <div class="month-block" data-month="8"><span>A</span></div>
                            <div class="month-block" data-month="9"><span>S</span></div>
                            <div class="month-block" data-month="10"><span>O</span></div>
                            <div class="month-block" data-month="11"><span>N</span></div>
                            <div class="month-block" data-month="12"><span>D</span></div>
                        </div>
                    </div>
                </div>

                <!-- Goal #8: Plan to Meet A/B Monthly -->
                <div class="goal-card">
                    <div class="goal-header">
                        <span class="goal-title">üìà #8: Plan to Meet A/B Ratio Monthly</span>
                        <span class="badge" id="abPlanGoalBadge">Loading...</span>
                    </div>
                    <div class="goal-notes">
                        <strong>Status:</strong> Monthly planning and execution<br>
                        <strong>Tracked:</strong> Via Dashboard A/B metrics<br>
                        <strong>Target:</strong> Consistent 58.5% performance
                    </div>

                    <!-- 12-Month Progress Timeline -->
                    <div style="margin-top: 10px;">
                        <div style="font-size: 0.75em; color: #94a3b8; margin-bottom: 4px;">2026 Progress (Month <span id="goal8CurrentMonth">--</span>/12)</div>
                        <div class="month-timeline" id="goal8MonthTimeline">
                            <div class="month-block" data-month="1"><span>J</span></div>
                            <div class="month-block" data-month="2"><span>F</span></div>
                            <div class="month-block" data-month="3"><span>M</span></div>
                            <div class="month-block" data-month="4"><span>A</span></div>
                            <div class="month-block" data-month="5"><span>M</span></div>
                            <div class="month-block" data-month="6"><span>J</span></div>
                            <div class="month-block" data-month="7"><span>J</span></div>
                            <div class="month-block" data-month="8"><span>A</span></div>
                            <div class="month-block" data-month="9"><span>S</span></div>
                            <div class="month-block" data-month="10"><span>O</span></div>
                            <div class="month-block" data-month="11"><span>N</span></div>
                            <div class="month-block" data-month="12"><span>D</span></div>
                        </div>
                    </div>
                </div>

                <!-- Goal #9: Use Dealer Programs Tab Exclusively -->
                <div class="goal-card">
                    <div class="goal-header">
                        <span class="goal-title">üìã #9: Use Dealer Programs Tab Exclusively</span>
                        <span class="badge badge-gray">Process</span>
                    </div>
                    <div class="goal-notes">
                        <strong>Objective:</strong> All dealer program work through proper tab<br>
                        <strong>Status:</strong> Check Dealer Programs folder<br>
                        <strong>Compliance:</strong> 100% usage requirement
                    </div>

                    <!-- 12-Month Progress Timeline -->
                    <div style="margin-top: 10px;">
                        <div style="font-size: 0.75em; color: #94a3b8; margin-bottom: 4px;">2026 Progress (Month <span id="goal9CurrentMonth">--</span>/12)</div>
                        <div class="month-timeline" id="goal9MonthTimeline">
                            <div class="month-block" data-month="1"><span>J</span></div>
                            <div class="month-block" data-month="2"><span>F</span></div>
                            <div class="month-block" data-month="3"><span>M</span></div>
                            <div class="month-block" data-month="4"><span>A</span></div>
                            <div class="month-block" data-month="5"><span>M</span></div>
                            <div class="month-block" data-month="6"><span>J</span></div>
                            <div class="month-block" data-month="7"><span>J</span></div>
                            <div class="month-block" data-month="8"><span>A</span></div>
                            <div class="month-block" data-month="9"><span>S</span></div>
                            <div class="month-block" data-month="10"><span>O</span></div>
                            <div class="month-block" data-month="11"><span>N</span></div>
                            <div class="month-block" data-month="12"><span>D</span></div>
                        </div>
                    </div>
                </div>

                <!-- Goal #10: Vendor Disputes - Communicate Within 30 Days -->
                <div class="goal-card">
                    <div class="goal-header">
                        <span class="goal-title">üìû #10: Vendor Disputes - Communicate to BZ Within 30 Days</span>
                        <span class="badge badge-gray">Process</span>
                    </div>
                    <div class="goal-notes">
                        <strong>Objective:</strong> Report disputes to Brian Zitek within 30 days<br>
                        <strong>Status:</strong> Check WO Disputes folder<br>
                        <strong>Target:</strong> 100% on-time communication
                    </div>

                    <!-- 12-Month Progress Timeline -->
                    <div style="margin-top: 10px;">
                        <div style="font-size: 0.75em; color: #94a3b8; margin-bottom: 4px;">2026 Progress (Month <span id="goal10CurrentMonth">--</span>/12)</div>
                        <div class="month-timeline" id="goal10MonthTimeline">
                            <div class="month-block" data-month="1"><span>J</span></div>
                            <div class="month-block" data-month="2"><span>F</span></div>
                            <div class="month-block" data-month="3"><span>M</span></div>
                            <div class="month-block" data-month="4"><span>A</span></div>
                            <div class="month-block" data-month="5"><span>M</span></div>
                            <div class="month-block" data-month="6"><span>J</span></div>
                            <div class="month-block" data-month="7"><span>J</span></div>
                            <div class="month-block" data-month="8"><span>A</span></div>
                            <div class="month-block" data-month="9"><span>S</span></div>
                            <div class="month-block" data-month="10"><span>O</span></div>
                            <div class="month-block" data-month="11"><span>N</span></div>
                            <div class="month-block" data-month="12"><span>D</span></div>
                        </div>
                    </div>
                </div>

                <!-- Goal #11: Identify Risk Areas to Reduce Assessment Score -->
                <div class="goal-card">
                    <div class="goal-header">
                        <span class="goal-title">‚ö†Ô∏è #11: Identify Risk Areas to Reduce Assessment Score</span>
                        <span class="badge badge-gray">Strategic</span>
                    </div>
                    <div class="goal-notes">
                        <strong>Objective:</strong> Proactive risk identification and mitigation<br>
                        <strong>Focus:</strong> Safety, quality, compliance risk areas<br>
                        <strong>Target:</strong> Reduce overall risk assessment score
                    </div>

                    <!-- 12-Month Progress Timeline -->
                    <div style="margin-top: 10px;">
                        <div style="font-size: 0.75em; color: #94a3b8; margin-bottom: 4px;">2026 Progress (Month <span id="goal11CurrentMonth">--</span>/12)</div>
                        <div class="month-timeline" id="goal11MonthTimeline">
                            <div class="month-block" data-month="1"><span>J</span></div>
                            <div class="month-block" data-month="2"><span>F</span></div>
                            <div class="month-block" data-month="3"><span>M</span></div>
                            <div class="month-block" data-month="4"><span>A</span></div>
                            <div class="month-block" data-month="5"><span>M</span></div>
                            <div class="month-block" data-month="6"><span>J</span></div>
                            <div class="month-block" data-month="7"><span>J</span></div>
                            <div class="month-block" data-month="8"><span>A</span></div>
                            <div class="month-block" data-month="9"><span>S</span></div>
                            <div class="month-block" data-month="10"><span>O</span></div>
                            <div class="month-block" data-month="11"><span>N</span></div>
                            <div class="month-block" data-month="12"><span>D</span></div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Other tabs - placeholder content -->
        <!-- ACTIONS TAB -->
        <div class="content" id="actions">
            <!-- NPS Survey Sending Interface -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üìß Send NPS Survey</span>
                    <span class="badge" id="npsSendBadge">Ready</span>
                </div>
                <div style="padding: 20px;">
                    <form id="npsForm" onsubmit="sendNPSSurvey(event)">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; color: #94a3b8; font-size: 0.9em;">Customer Name *</label>
                                <input type="text" id="customerName" required style="width: 100%; padding: 10px; border: 1px solid #334155; border-radius: 8px; background: #1e293b; color: #f1f5f9;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; color: #94a3b8; font-size: 0.9em;">Email Address *</label>
                                <input type="email" id="customerEmail" required style="width: 100%; padding: 10px; border: 1px solid #334155; border-radius: 8px; background: #1e293b; color: #f1f5f9;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; color: #94a3b8; font-size: 0.9em;">Work Order # *</label>
                                <input type="text" id="woNumber" required style="width: 100%; padding: 10px; border: 1px solid #334155; border-radius: 8px; background: #1e293b; color: #f1f5f9;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; color: #94a3b8; font-size: 0.9em;">Aircraft Registration</label>
                                <input type="text" id="regNumber" style="width: 100%; padding: 10px; border: 1px solid #334155; border-radius: 8px; background: #1e293b; color: #f1f5f9;">
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button type="submit" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                                üìß Send & Log Survey
                            </button>
                            <button type="button" onclick="logOnlyNPS()" style="flex: 1; padding: 12px; background: #334155; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                                üìù Log Only (Already Sent)
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Customer Recommendations -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üí° Recommended Customers for NPS Survey</span>
                    <span class="badge" id="recommendBadge">Loading...</span>
                </div>
                <div style="margin-bottom: 10px; padding: 8px 12px; background: #1e293b; border-left: 3px solid #3b82f6; border-radius: 4px; font-size: 0.85em; color: #94a3b8;">
                    üìß Emails auto-populated from <strong style="color:#93c5fd;">Customers email.xlsx</strong> database.
                    ‚ö†Ô∏è = Email not in database (add to spreadsheet).
                    Rule: <strong style="color:#fbbf24;">1 survey per customer per month</strong>.
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Customer</th>
                                <th>Tail#</th>
                                <th>Email</th>
                                <th>Work Order</th>
                                <th>Days</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="customerRecommendations">
                            <tr><td colspan="6" style="text-align:center; color:#94a3b8;">Loading recommendations...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Recent NPS Activity -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üìä Recent NPS Survey Activity</span>
                    <span class="badge" id="activityBadge">Loading...</span>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Date Sent</th>
                                <th>Customer</th>
                                <th>WO #</th>
                                <th>Status</th>
                                <th>Score</th>
                            </tr>
                        </thead>
                        <tbody id="npsActivity">
                            <tr><td colspan="5" style="text-align:center; color:#94a3b8;">Loading activity...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="content" id="overview">
            <!-- A/B Ratio Comparison Header -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0; color: #e2e8f0;">üìä A/B Ratio Comparison</h2>
                <div style="background: #f59e0b; color: #000; padding: 8px 16px; border-radius: 6px; font-weight: bold;">
                    Target: 58.5%
                </div>
            </div>

            <!-- A/B Comparison Cards -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                <!-- Matt's Official Numbers (Left - Orange/Red) -->
                <div style="background: linear-gradient(135deg, #92400e 0%, #78350f 100%); border: 2px solid #d97706; border-radius: 12px; padding: 24px;">
                    <div style="text-align: center; margin-bottom: 16px; color: #fbbf24;">
                        üìß MATT'S FRIDAY UPDATE
                    </div>
                    <div style="text-align: center; font-size: 64px; font-weight: bold; color: #fbbf24; margin-bottom: 12px;" id="mattAB">
                        --
                    </div>
                    <div style="text-align: center; color: #fcd34d; margin-bottom: 8px;" id="mattPeriod">
                        Jan Final (2/6 Update)
                    </div>
                    <div style="text-align: center; color: #fcd34d;" id="mattRank">
                        Rank: 21st/21 | Gap: -20.9 pts
                    </div>
                </div>

                <!-- Denver Real-Time (Right - Blue/Green) -->
                <div style="background: linear-gradient(135deg, #064e3b 0%, #065f46 100%); border: 2px solid #10b981; border-radius: 12px; padding: 24px;">
                    <div style="text-align: center; margin-bottom: 16px; color: #6ee7b7;">
                        üìä DENVER LOCAL (Real-Time)
                    </div>
                    <div style="text-align: center; font-size: 64px; font-weight: bold; color: #10b981; margin-bottom: 12px;" id="denverAB">
                        --
                    </div>
                    <div style="text-align: center; color: #6ee7b7; margin-bottom: 8px;" id="denverRolling">
                        1-Month Rolling: 42.1%
                    </div>
                    <div style="text-align: center; color: #6ee7b7;" id="denverFebOnly">
                        Feb-only: 54.0% ‚úÖ Improving!
                    </div>
                </div>
            </div>

            <!-- Comparison Stats Row -->
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 30px;">
                <div style="background: #1e293b; border-radius: 8px; padding: 16px; text-align: center;">
                    <div style="color: #ef4444; font-size: 24px; font-weight: bold;" id="janFinal">33.1%</div>
                    <div style="color: #94a3b8; font-size: 14px;">Jan Final (Official)</div>
                    <div style="color: #ef4444; font-size: 12px;" id="janRank">21st</div>
                </div>
                <div style="background: #1e293b; border-radius: 8px; padding: 16px; text-align: center;">
                    <div style="color: #10b981; font-size: 24px; font-weight: bold;" id="febTrend">54.0%</div>
                    <div style="color: #94a3b8; font-size: 14px;">Feb Trend (MTD)</div>
                    <div style="color: #10b981; font-size: 12px;">üìàüìà</div>
                </div>
                <div style="background: #1e293b; border-radius: 8px; padding: 16px; text-align: center;">
                    <div style="color: #10b981; font-size: 24px; font-weight: bold;" id="rollingAvg">42.1%</div>
                    <div style="color: #94a3b8; font-size: 14px;">1-Mo Rolling Avg</div>
                    <div style="color: #10b981; font-size: 12px;">üìà</div>
                </div>
            </div>

            <!-- Status Message -->
            <div id="abStatusMessage" style="background: #065f46; border-left: 4px solid #10b981; padding: 16px; border-radius: 8px; margin-bottom: 30px;">
                <div style="color: #10b981; font-weight: bold;">
                    ‚úÖ Feb is STRONG! 54.0% Feb-only A/B vs 33.1% Jan final. Nearly at 58.5% target! Keep pushing.
                </div>
            </div>

            <!-- Jan Final Details -->
            <div style="background: #78350f; border-left: 4px solid #f59e0b; padding: 16px; border-radius: 8px; margin-bottom: 30px;">
                <div style="color: #fbbf24; font-weight: bold;">
                    üìß Jan Final: 33.1% A/B | 21st/21 | $310K Rev | -$1,305 NI
                </div>
            </div>

            <!-- Budget vs Actual Section -->
            <div style="margin-top: 40px;">
                <h2 style="margin: 0 0 20px 0; color: #e2e8f0;">üí∞ Budget vs Actual (2026)</h2>

                <!-- Budget Summary Cards -->
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 20px;">
                    <div class="card" style="background: linear-gradient(135deg, #065f46 0%, #047857 100%); border: 2px solid #10b981;">
                        <div style="text-align: center;">
                            <div style="color: #6ee7b7; font-size: 14px; margin-bottom: 8px;">Total Revenue</div>
                            <div style="color: #10b981; font-size: 32px; font-weight: bold;" id="budgetTotalRevenue">$--</div>
                            <div style="color: #6ee7b7; font-size: 12px; margin-top: 4px;" id="budgetTotalRevenueVar">-- vs budget</div>
                        </div>
                    </div>
                    <div class="card" style="background: linear-gradient(135deg, #7c2d12 0%, #991b1b 100%); border: 2px solid #ef4444;">
                        <div style="text-align: center;">
                            <div style="color: #fca5a5; font-size: 14px; margin-bottom: 8px;">Total Cost</div>
                            <div style="color: #ef4444; font-size: 32px; font-weight: bold;" id="budgetTotalCost">$--</div>
                            <div style="color: #fca5a5; font-size: 12px; margin-top: 4px;" id="budgetTotalCostVar">-- vs budget</div>
                        </div>
                    </div>
                    <div class="card" style="background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%); border: 2px solid #3b82f6;">
                        <div style="text-align: center;">
                            <div style="color: #93c5fd; font-size: 14px; margin-bottom: 8px;">Gross Profit</div>
                            <div style="color: #3b82f6; font-size: 32px; font-weight: bold;" id="budgetGrossProfit">$--</div>
                            <div style="color: #93c5fd; font-size: 12px; margin-top: 4px;" id="budgetGrossProfitVar">-- vs budget</div>
                        </div>
                    </div>
                    <div class="card" style="background: linear-gradient(135deg, #78350f 0%, #92400e 100%); border: 2px solid #f59e0b;">
                        <div style="text-align: center;">
                            <div style="color: #fcd34d; font-size: 14px; margin-bottom: 8px;">Gross Margin</div>
                            <div style="color: #f59e0b; font-size: 32px; font-weight: bold;" id="budgetMargin">--%</div>
                            <div style="color: #fcd34d; font-size: 12px; margin-top: 4px;" id="budgetMarginVar">Target: 28.1%</div>
                        </div>
                    </div>
                </div>

                <!-- Daily Revenue Tracker -->
                <div class="card" style="margin-bottom: 20px;">
                    <div class="card-title">üìÖ Daily Revenue Tracker</div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                        <div style="background: #1e293b; border-radius: 8px; padding: 16px; text-align: center;">
                            <div style="color: #94a3b8; font-size: 14px; margin-bottom: 8px;">Today's Target</div>
                            <div style="color: #f59e0b; font-size: 28px; font-weight: bold;">$9,642</div>
                            <div style="color: #64748b; font-size: 12px; margin-top: 4px;">$702,471 / 21 days</div>
                        </div>
                        <div style="background: #1e293b; border-radius: 8px; padding: 16px; text-align: center;">
                            <div style="color: #94a3b8; font-size: 14px; margin-bottom: 8px;">MTD Revenue</div>
                            <div style="font-size: 28px; font-weight: bold;" id="budgetMTDRevenue">$--</div>
                            <div style="font-size: 12px; margin-top: 4px;" id="budgetMTDStatus">--</div>
                        </div>
                        <div style="background: #1e293b; border-radius: 8px; padding: 16px; text-align: center;">
                            <div style="color: #94a3b8; font-size: 14px; margin-bottom: 8px;">Revenue Pace</div>
                            <div style="font-size: 28px; font-weight: bold;" id="budgetRevenuePace">--</div>
                            <div style="font-size: 12px; margin-top: 4px;" id="budgetPaceStatus">--</div>
                        </div>
                    </div>
                </div>

                <!-- Department Breakdown -->
                <div class="card">
                    <div class="card-title">üè¢ Department Performance</div>
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr>
                                <th style="text-align: left; padding: 12px; color: #f59e0b;">Department</th>
                                <th style="text-align: right; padding: 12px; color: #f59e0b;">Budget Revenue</th>
                                <th style="text-align: right; padding: 12px; color: #f59e0b;">Actual Revenue</th>
                                <th style="text-align: right; padding: 12px; color: #f59e0b;">Variance</th>
                                <th style="text-align: right; padding: 12px; color: #f59e0b;">Margin</th>
                                <th style="text-align: center; padding: 12px; color: #f59e0b;">Status</th>
                            </tr>
                        </thead>
                        <tbody id="budgetDeptTable">
                            <tr><td colspan="6" style="text-align:center; padding: 20px; color: #94a3b8;">Loading budget data...</td></tr>
                        </tbody>
                    </table>
                </div>

                <!-- A/B Ratio Impact Calculator -->
                <div class="card" style="margin-top: 20px; background: linear-gradient(135deg, #581c87 0%, #6b21a8 100%); border: 2px solid #a855f7;">
                    <div class="card-title" style="color: #e9d5ff;">üéØ A/B Ratio Impact Calculator</div>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 16px;">
                        <div style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 16px; text-align: center;">
                            <div style="color: #e9d5ff; font-size: 14px; margin-bottom: 8px;">Current A/B</div>
                            <div style="color: #ef4444; font-size: 32px; font-weight: bold;" id="abCurrentRatio">38.8%</div>
                            <div style="color: #fca5a5; font-size: 12px; margin-top: 4px;">MTD Average</div>
                        </div>
                        <div style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 16px; text-align: center;">
                            <div style="color: #e9d5ff; font-size: 14px; margin-bottom: 8px;">Target A/B</div>
                            <div style="color: #10b981; font-size: 32px; font-weight: bold;">58.5%</div>
                            <div style="color: #6ee7b7; font-size: 12px; margin-top: 4px;">2026 Goal</div>
                        </div>
                        <div style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 16px; text-align: center;">
                            <div style="color: #e9d5ff; font-size: 14px; margin-bottom: 8px;">Gap</div>
                            <div style="color: #f59e0b; font-size: 32px; font-weight: bold;" id="abGap">19.7pp</div>
                            <div style="color: #fcd34d; font-size: 12px; margin-top: 4px;">Points to improve</div>
                        </div>
                        <div style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 16px; text-align: center;">
                            <div style="color: #e9d5ff; font-size: 14px; margin-bottom: 8px;">Revenue Impact</div>
                            <div style="color: #3b82f6; font-size: 32px; font-weight: bold;" id="abRevenueImpact">$--</div>
                            <div style="color: #93c5fd; font-size: 12px; margin-top: 4px;">If at 58.5%</div>
                        </div>
                    </div>
                    <div style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 16px;">
                        <div style="color: #e9d5ff; font-weight: bold; margin-bottom: 8px;">üö® Action Required:</div>
                        <div style="color: #c4b5fd;" id="abActionText">Calculate additional billable hours needed...</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="content" id="employees">
            <!-- YTD A/B Performance by Employee -->
            <div class="card">
                <div class="card-title">üìà YTD A/B Performance (2026)</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Employee</th>
                            <th>Code</th>
                            <th>YTD Total Hrs</th>
                            <th>YTD Billable</th>
                            <th>YTD A/B %</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="ytdABTable">
                        <tr><td colspan="6" style="text-align:center;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Monthly A/B Breakdown -->
            <div class="card">
                <div class="card-title">üìÖ A/B by Month - Per Technician</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Employee</th>
                            <th>Jan Total</th>
                            <th>Jan Bill</th>
                            <th>Jan A/B</th>
                            <th>Feb MTD Total</th>
                            <th>Feb MTD Bill</th>
                            <th>Feb MTD A/B</th>
                        </tr>
                    </thead>
                    <tbody id="monthlyABTable">
                        <tr><td colspan="7" style="text-align:center;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Individual A/B Performance -->
            <div class="card">
                <div class="card-title" id="individualABTitle">‚è±Ô∏è Individual A/B Performance - Loading...</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Employee</th>
                            <th>Code</th>
                            <th>Total Hours</th>
                            <th>Billable Hours</th>
                            <th>A/B %</th>
                            <th>Status</th>
                            <th>Work Orders (Previous Day)</th>
                        </tr>
                    </thead>
                    <tbody id="individualABTable">
                        <tr><td colspan="7" style="text-align:center;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Team Roster -->
            <div class="card">
                <div class="card-title">üìã Complete Team Roster</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Code</th>
                            <th>Title</th>
                            <th>QI</th>
                            <th>RTS</th>
                            <th>SRA</th>
                            <th>Stamps</th>
                            <th>Years Exp</th>
                            <th>Rating</th>
                        </tr>
                    </thead>
                    <tbody id="rosterTable">
                        <tr><td colspan="9" style="text-align:center;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="content" id="workorders">
            <!-- ANCHOR Open Work Orders Summary (Primary Source of Truth) -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">‚öì Open Work Orders ‚Äî ANCHOR Report</span>
                    <span class="badge" id="anchorBadge">Loading...</span>
                </div>
                <div style="margin-bottom: 16px; padding: 10px 14px; background: #1e293b; border-left: 4px solid #3b82f6; border-radius: 6px;">
                    <div style="color: #93c5fd; font-weight: bold;">üì° Source: AS400 ANCHOR Report (Daily Import)</div>
                    <div style="color: #94a3b8; font-size: 0.85em; margin-top: 4px;">Single source of truth for ALL open work orders across Denver shops. Report date: <span id="anchorReportDate">--</span></div>
                </div>
                <div class="card-grid">
                    <div class="metric">
                        <div class="metric-value" id="anchorTotal">--</div>
                        <div class="metric-label">Total Open WOs</div>
                        <div class="metric-sub">All Denver Shops</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" style="color: #ef4444;" id="anchorAOG">--</div>
                        <div class="metric-label">AOG</div>
                        <div class="metric-sub">Aircraft on Ground</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" style="color: #f59e0b;" id="anchorExpHrs">--</div>
                        <div class="metric-label">Expected Hours</div>
                        <div class="metric-sub">Total Backlog</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" style="color: #ef4444;" id="anchorOver30">--</div>
                        <div class="metric-label">Over 30 Days</div>
                        <div class="metric-sub">Aging WOs</div>
                    </div>
                </div>
                <!-- Shop Breakdown -->
                <div class="card-grid" style="margin-top: 12px;">
                    <div class="metric">
                        <div class="metric-value" style="font-size: 1.6em;" id="anchorSDN">--</div>
                        <div class="metric-label">SDN</div>
                        <div class="metric-sub">Airframes</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" style="font-size: 1.6em;" id="anchorSDV">--</div>
                        <div class="metric-label">SDV</div>
                        <div class="metric-sub">Avionics</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" style="font-size: 1.6em;" id="anchorSDR">--</div>
                        <div class="metric-label">SDR</div>
                        <div class="metric-sub">Accessories</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" style="font-size: 1.6em;" id="anchorSHC">--</div>
                        <div class="metric-label">SHC</div>
                        <div class="metric-sub">Structures</div>
                    </div>
                </div>
            </div>

            <!-- ANCHOR Work Orders Table -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üìù All Open Work Orders</span>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <select id="anchorShopFilter" onchange="filterAnchorTable()" style="padding: 6px 10px; border-radius: 6px; background: #1e293b; color: #fff; border: 1px solid #334155; font-size: 0.85em;">
                            <option value="all">All Shops</option>
                            <option value="SDN">SDN - Airframes</option>
                            <option value="SDV">SDV - Avionics</option>
                            <option value="SDR">SDR - Accessories</option>
                            <option value="SHC">SHC - Structures</option>
                        </select>
                        <select id="anchorSortBy" onchange="filterAnchorTable()" style="padding: 6px 10px; border-radius: 6px; background: #1e293b; color: #fff; border: 1px solid #334155; font-size: 0.85em;">
                            <option value="days_open_desc">Days Open (Oldest)</option>
                            <option value="days_open_asc">Days Open (Newest)</option>
                            <option value="exp_hrs_desc">Exp Hours (Highest)</option>
                            <option value="shop">By Shop</option>
                            <option value="aog">AOG First</option>
                        </select>
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>WO#</th>
                                <th>Shop</th>
                                <th>Status</th>
                                <th>Tail#</th>
                                <th>Customer</th>
                                <th>Description</th>
                                <th>Open Date</th>
                                <th>Days Open</th>
                                <th>Exp Hrs</th>
                                <th>AOG</th>
                            </tr>
                        </thead>
                        <tbody id="anchorWorkOrdersList">
                            <tr><td colspan="10" style="text-align:center; color:#94a3b8;">Loading ANCHOR data...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Billing Tracking Section -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üìã Work Orders Pending Billing</span>
                    <span class="badge" id="workOrdersBadge">Loading...</span>
                </div>
                <div class="card-grid">
                    <div class="metric">
                        <div class="metric-value" id="totalWorkOrders">--</div>
                        <div class="metric-label">Total Pending</div>
                        <div class="metric-sub">Awaiting Billing</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" style="color: #10b981;" id="greenWorkOrders">--</div>
                        <div class="metric-label">Green (0-3 days)</div>
                        <div class="metric-sub">On Track</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" style="color: #f59e0b;" id="amberWorkOrders">--</div>
                        <div class="metric-label">Amber (4-7 days)</div>
                        <div class="metric-sub">Watch List</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" style="color: #ef4444;" id="redWorkOrders">--</div>
                        <div class="metric-label">Red (8+ days)</div>
                        <div class="metric-sub">Urgent</div>
                    </div>
                </div>
            </div>

            <!-- Work Orders List -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üìù Billing Detail</span>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>WO Number</th>
                                <th>Tail Number</th>
                                <th>Signoff Date</th>
                                <th>Days Pending</th>
                                <th>Status</th>
                                <th>Notes / Warnings</th>
                            </tr>
                        </thead>
                        <tbody id="workOrdersList">
                            <tr><td colspan="6" style="text-align:center; color:#94a3b8;">Loading data...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Billing Priority: 7-Day Tracking (Daily WOs) -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">‚ö° Billing Priority - 7-Day Tracking</span>
                    <span class="badge badge-amber" id="billingPriorityBadge">Active</span>
                </div>
                <div style="margin-bottom: 16px; padding: 12px; background: #1e293b; border-left: 4px solid #f59e0b; border-radius: 6px;">
                    <div style="color: #fbbf24; font-weight: bold;">üìß From Demarest's Daily Email - Track & Bill within 7 Days</div>
                    <div style="color: #94a3b8; font-size: 0.9em; margin-top: 4px;">Goal: Improve cash flow by billing completed work orders promptly</div>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>WO Number</th>
                            <th>Customer</th>
                            <th>Tail #</th>
                            <th>Completion Date</th>
                            <th>Days Open</th>
                            <th>Status</th>
                            <th>Priority</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody id="billingPriorityTable">
                        <tr><td colspan="8" style="text-align:center;">No active work orders tracked</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Over 30 Days Work Orders -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üìÖ Over 30 Days Work Orders</span>
                    <span class="badge badge-red" id="over30Badge">Monthly Report</span>
                </div>
                <div style="margin-bottom: 16px; padding: 12px; background: #1e293b; border-left: 4px solid #ef4444; border-radius: 6px;">
                    <div style="color: #ef4444; font-weight: bold;">üìß From Brian Zitek's Monthly Email (Last week of month)</div>
                    <div style="color: #94a3b8; font-size: 0.9em; margin-top: 4px;">Goal: Clear this list monthly or have justified notes for each WO</div>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>WO Number</th>
                            <th>Customer</th>
                            <th>Tail #</th>
                            <th>Open Date</th>
                            <th>Days Open</th>
                            <th>Status</th>
                            <th>Justification / Action Plan</th>
                            <th>Owner</th>
                        </tr>
                    </thead>
                    <tbody id="over30Table">
                        <tr><td colspan="8" style="text-align:center;">No over 30 work orders</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="content" id="training">
            <!-- Training Summary -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üìö Training Completion Status</span>
                    <span class="badge" id="trainingBadge">Loading...</span>
                </div>
                <div class="card-grid">
                    <div class="metric">
                        <div class="metric-value" id="totalTraining">--</div>
                        <div class="metric-label">Total Assignments</div>
                        <div class="metric-sub">All Training</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" style="color: #10b981;" id="completedTrainingCount">--</div>
                        <div class="metric-label">Completed</div>
                        <div class="metric-sub">On Time</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" style="color: #f59e0b;" id="dueSoonTrainingCount">--</div>
                        <div class="metric-label">Due Soon</div>
                        <div class="metric-sub">Within 30 Days</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" style="color: #ef4444;" id="pastDueTrainingCount">--</div>
                        <div class="metric-label">Past Due</div>
                        <div class="metric-sub">Overdue</div>
                    </div>
                </div>
            </div>

            <!-- Training by Category -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üìä Training by Category</span>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Total</th>
                                <th>Completed</th>
                                <th>Past Due</th>
                                <th>Completion %</th>
                            </tr>
                        </thead>
                        <tbody id="trainingByCategory">
                            <tr><td colspan="5" style="text-align:center; color:#94a3b8;">Loading data...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Training Detail List -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üìã Training Assignments Detail</span>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 200px;">Employee</th>
                                <th style="width: 450px;">Training Course</th>
                                <th style="width: 120px;">Category</th>
                                <th style="width: 120px;">Due Date</th>
                                <th style="width: 120px;">Status</th>
                            </tr>
                        </thead>
                        <tbody id="trainingDetail">
                            <tr><td colspan="5" style="text-align:center; color:#94a3b8;">Loading training data...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="content" id="quality">
            <!-- Quality Metrics Summary -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">‚úÖ Quality & Inspections - 2026</span>
                    <span class="badge" id="qualityBadge">Loading...</span>
                </div>
                <div class="metrics-grid">
                    <div class="metric">
                        <div class="metric-value" id="totalInspections">--</div>
                        <div class="metric-label">Total Inspections</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="passedInspections">--</div>
                        <div class="metric-label">Passed (No Issues)</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="failedInspections">--</div>
                        <div class="metric-label">Discrepancies Found</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="passRate">--</div>
                        <div class="metric-label">Pass Rate %</div>
                    </div>
                </div>
            </div>

            <!-- Inspection Progress -->
            <div class="card">
                <div class="card-title">üìä 2026 Pass Rate Target: 95%</div>
                <div style="margin-top: 20px;">
                    <div class="progress-bar" style="height: 30px;">
                        <div class="progress-fill" id="qualityProgressBar" style="width: 0%; background: linear-gradient(90deg, #10b981, #059669);"></div>
                    </div>
                    <div style="text-align: center; margin-top: 10px; font-size: 1.2em; font-weight: bold;" id="qualityProgressText">--</div>
                </div>
            </div>

            <!-- Discrepancies by Technician -->
            <div class="card">
                <div class="card-title">üë• Discrepancies by Technician</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Technician</th>
                            <th>Total Work</th>
                            <th>Discrepancies</th>
                            <th>Pass Rate</th>
                        </tr>
                    </thead>
                    <tbody id="discrepancyByTech">
                        <tr><td colspan="4" style="text-align:center;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Discrepancies by Category -->
            <div class="card">
                <div class="card-title">üìã Discrepancies by Category</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Count</th>
                            <th>% of Total</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody id="discrepancyByCategory">
                        <tr><td colspan="4" style="text-align:center;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Monthly Trend -->
            <div class="card">
                <div class="card-title">üìÖ Monthly Quality Trend (2026)</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Month</th>
                            <th>Inspections</th>
                            <th>Discrepancies</th>
                            <th>Pass Rate</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="monthlyTrend">
                        <tr><td colspan="5" style="text-align:center;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Recent Inspections & Discrepancies -->
            <div class="card">
                <div class="card-title">üîç 2026 Inspection Details</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Work Order</th>
                            <th>Tech</th>
                            <th>Discrepancy</th>
                            <th>Category</th>
                            <th>Resolution</th>
                        </tr>
                    </thead>
                    <tbody id="inspectionDetails">
                        <tr><td colspan="6" style="text-align:center;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="content" id="wip">
            <!-- Current Month WIP Summary -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üí∞ Work in Progress (WIP) Summary</span>
                    <span class="badge" id="wipBadge">Loading...</span>
                </div>
                <div class="card-grid">
                    <div class="metric">
                        <div class="metric-value" id="wipTotalValue">--</div>
                        <div class="metric-label">Total WIP Value</div>
                        <div class="metric-sub" id="wipMonth">--</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="wipTotalHours">--</div>
                        <div class="metric-label">Total Hours</div>
                        <div class="metric-sub">Current Month</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="wipShopCount">--</div>
                        <div class="metric-label">Active Shops</div>
                        <div class="metric-sub">With WIP</div>
                    </div>
                </div>
            </div>

            <!-- WIP by Shop -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üìä WIP by Shop</span>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Shop</th>
                            <th>Hours</th>
                            <th>Rate</th>
                            <th>WIP Value</th>
                            <th>% of Total</th>
                        </tr>
                    </thead>
                    <tbody id="wipShopDetails">
                        <tr><td colspan="5" style="text-align:center;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- WIP Explanation -->
            <div class="card">
                <div class="card-title">‚ÑπÔ∏è About WIP</div>
                <p><strong>Work in Progress (WIP)</strong> smooths out billing peaks by accounting for labor and parts sold to work orders on a monthly basis.</p>
                <ul style="margin-left: 20px; line-height: 1.8;">
                    <li><strong>Standard WIP:</strong> SDN, SDR, SHC @ $145/hr (2026 rate)</li>
                    <li><strong>Special WIP:</strong> SDV installs @ $80/hr + 15% parts margin</li>
                    <li><strong>Scope:</strong> Only work orders opened in the current month (or with additional hours sold)</li>
                    <li><strong>Goal:</strong> Stay ahead of the curve and avoid hills/valleys in billing</li>
                </ul>
            </div>
        </div>
        <div class="content" id="rankings">
            <!-- Denver Position Card -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üèÜ Denver Shop Rankings</span>
                    <span class="badge" id="rankingsBadge">Loading...</span>
                </div>
                <div class="card-grid">
                    <div class="metric">
                        <div class="metric-value" id="denverPosition">--</div>
                        <div class="metric-label">Current Position</div>
                        <div class="metric-sub" id="positionDate">--</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="abActual">--</div>
                        <div class="metric-label">A/B Percentage</div>
                        <div class="metric-sub">Actual Performance</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="abBudget">--</div>
                        <div class="metric-label">A/B Budget</div>
                        <div class="metric-sub">Target Goal</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="abVariance">--</div>
                        <div class="metric-label">Variance</div>
                        <div class="metric-sub" id="varianceStatus">vs Budget</div>
                    </div>
                </div>
            </div>

            <!-- Rankings History -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üìà Recent Rankings History</span>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Week Ending</th>
                                <th>Position</th>
                                <th>A/B Actual</th>
                                <th>A/B Budget</th>
                                <th>Variance</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="rankingsHistory">
                            <tr><td colspan="6" style="text-align:center; color:#94a3b8;">Loading data...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const PASSWORD = 'denver889';
        let isRotating = false;
        let isPaused = false;
        let scrollInterval = null;
        let tabSwitchInterval = null;
        let pauseTimeout = null;
        let currentTab = 0;
        const tabs = ['goals', 'actions', 'overview', 'employees', 'workorders', 'training', 'quality', 'wip', 'rankings'];
        
        // Login function (backup - button uses inline code)
        function login() {
            const pwd = document.getElementById('passwordInput').value;
            if (pwd === PASSWORD) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                localStorage.setItem('denver_auth', 'true');
                initializeEventListeners();
                showTab(tabs[0]);
                loadDashboardData();
            } else {
                document.getElementById('errorMsg').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('errorMsg').style.display = 'none';
                }, 3000);
            }
        }
        
        function logout() {
            localStorage.removeItem('denver_auth');
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('passwordInput').value = '';
        }
        
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(()=>{});
            } else if (document.exitFullscreen) {
                document.exitFullscreen();
            }
        }
        
        function showTab(tabId) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');

            // Track current tab index
            const idx = tabs.indexOf(tabId);
            if (idx !== -1) currentTab = idx;

            // Scroll page back to top on tab switch
            window.scrollTo(0, 0);

            // Load tab-specific data
            if (tabId === 'actions') {
                loadActionsData();
            }
        }
        
        function startAutoScroll() {
            // Clear any existing scroll interval
            if (scrollInterval) clearInterval(scrollInterval);

            // Reset scroll to top of page
            window.scrollTo(0, 0);

            // Small delay to let DOM settle after tab switch
            setTimeout(() => {
                const scrollHeight = document.body.scrollHeight - window.innerHeight;
                if (scrollHeight <= 0) return; // Nothing to scroll

                const scrollDuration = 25000; // 25 seconds to scroll, 5 seconds pause at bottom before tab switch
                const scrollStep = scrollHeight / (scrollDuration / 50); // Update every 50ms

                scrollInterval = setInterval(() => {
                    if (!isRotating || isPaused) {
                        clearInterval(scrollInterval);
                        return;
                    }

                    window.scrollBy(0, scrollStep);

                    // If reached bottom, stop scrolling (tab switch timer handles the rest)
                    if ((window.scrollY + window.innerHeight) >= document.body.scrollHeight - 5) {
                        clearInterval(scrollInterval);
                    }
                }, 50);
            }, 200);
        }

        function stopAutoScroll() {
            if (scrollInterval) {
                clearInterval(scrollInterval);
                scrollInterval = null;
            }
            if (tabSwitchInterval) {
                clearInterval(tabSwitchInterval);
                tabSwitchInterval = null;
            }
            if (pauseTimeout) {
                clearTimeout(pauseTimeout);
                pauseTimeout = null;
            }
        }

        function toggleRotate() {
            isRotating = !isRotating;

            if (isRotating) {
                // Start auto-scroll
                document.getElementById('rotateBtn').textContent = '‚èπÔ∏è Stop';
                document.getElementById('rotateBtn').style.background = '#ef4444';
                isPaused = false;
                startAutoRotation();
            } else {
                // Stop everything
                document.getElementById('rotateBtn').textContent = '‚ñ∂Ô∏è Auto';
                document.getElementById('rotateBtn').style.background = '#10b981';
                stopAutoScroll();
                isPaused = false;
                currentTab = 0;
                showTab(tabs[currentTab]);
            }
        }

        function pauseRotation() {
            if (!isRotating) return;

            isPaused = true;
            stopAutoScroll();

            console.log('Paused for 30 seconds - manual scroll enabled');

            // Auto-resume after 30 seconds
            pauseTimeout = setTimeout(() => {
                if (isRotating) {
                    isPaused = false;
                    console.log('Resuming auto-scroll...');
                    startAutoScroll();
                }
            }, 30000);
        }

        function startAutoRotation() {
            // Clear any existing intervals
            stopAutoScroll();

            // Start scrolling current tab
            startAutoScroll();

            // Switch tabs every 30 seconds
            tabSwitchInterval = setInterval(() => {
                if (!isRotating || isPaused) return;

                currentTab = (currentTab + 1) % tabs.length;
                showTab(tabs[currentTab]);
                console.log(`Switched to tab: ${tabs[currentTab]}`);

                // Start scrolling the new tab
                setTimeout(() => {
                    if (isRotating && !isPaused) {
                        startAutoScroll();
                    }
                }, 100);
            }, 30000);
        }

        // Initialize event listeners after DOM is ready
        function initializeEventListeners() {
            // Listen for scroll events to enable pause on manual scroll
            document.addEventListener('wheel', (e) => {
                if (isRotating && !isPaused) {
                    // User is trying to scroll manually - pause auto-scroll
                    pauseRotation();
                }
            }, { passive: true });

            // Tab click handlers
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    // Stop auto-scroll when manually clicking tabs
                    if (isRotating) {
                        isRotating = false;
                        stopAutoScroll();
                        document.getElementById('rotateBtn').textContent = '‚ñ∂Ô∏è Auto';
                        document.getElementById('rotateBtn').style.background = '#10b981';
                    }
                    showTab(tab.dataset.tab);
                });
            });
        }
        
        // Supabase Configuration
        const SUPABASE_URL = 'https://pjielffstfzqffrpmyyt.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBqaWVsZmZzdGZ6cWZmcnBteXl0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2NTQzOTgsImV4cCI6MjA4NjIzMDM5OH0.uAu8sr_oZcAuysJTWUg3CuAnfbXMsPqQ-UzH43BxPSw';
        const HEADERS = {
            'apikey': SUPABASE_KEY,
            'Authorization': `Bearer ${SUPABASE_KEY}`,
            'Content-Type': 'application/json'
        };

        // Global store for ANCHOR data (used by filter/sort)
        let anchorWorkOrdersData = [];

        // Load ANCHOR Work Orders (Primary Source of Truth)
        async function loadAnchorWorkOrders() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/anchor_work_orders?select=*&order=days_open.desc.nullslast`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                const data = await response.json();
                if (!Array.isArray(data)) {
                    console.log('anchor_work_orders returned non-array:', data);
                    document.getElementById('anchorBadge').textContent = 'No Data';
                    document.getElementById('anchorBadge').className = 'badge badge-gray';
                    return;
                }
                anchorWorkOrdersData = data;

                // Summary metrics
                const total = data.length;
                const aogCount = data.filter(wo => wo.is_aog).length;
                const totalExpHrs = data.reduce((sum, wo) => sum + (wo.expected_hours || 0), 0);
                const over30Count = data.filter(wo => wo.days_open && wo.days_open > 30).length;
                const reportDate = data.length > 0 ? data[0].report_date : '--';

                document.getElementById('anchorTotal').textContent = total;
                document.getElementById('anchorAOG').textContent = aogCount;
                document.getElementById('anchorExpHrs').textContent = Math.round(totalExpHrs) + 'h';
                document.getElementById('anchorOver30').textContent = over30Count;
                document.getElementById('anchorReportDate').textContent = reportDate ? new Date(reportDate + 'T00:00:00').toLocaleDateString() : '--';

                // Shop breakdown
                const shopCounts = { SDN: 0, SDV: 0, SDR: 0, SHC: 0 };
                data.forEach(wo => { if (shopCounts.hasOwnProperty(wo.shop)) shopCounts[wo.shop]++; });
                document.getElementById('anchorSDN').textContent = shopCounts.SDN;
                document.getElementById('anchorSDV').textContent = shopCounts.SDV;
                document.getElementById('anchorSDR').textContent = shopCounts.SDR;
                document.getElementById('anchorSHC').textContent = shopCounts.SHC;

                // Badge
                if (aogCount > 0) {
                    document.getElementById('anchorBadge').textContent = `${aogCount} AOG | ${total} WOs`;
                    document.getElementById('anchorBadge').className = 'badge badge-red';
                } else if (over30Count > 0) {
                    document.getElementById('anchorBadge').textContent = `${over30Count} Over 30d | ${total} WOs`;
                    document.getElementById('anchorBadge').className = 'badge badge-amber';
                } else {
                    document.getElementById('anchorBadge').textContent = `${total} Open WOs`;
                    document.getElementById('anchorBadge').className = 'badge badge-green';
                }

                // Render table
                filterAnchorTable();

            } catch (error) {
                console.error('Error loading ANCHOR work orders:', error);
                document.getElementById('anchorBadge').textContent = 'Error';
                document.getElementById('anchorBadge').className = 'badge badge-red';
            }
        }

        // Filter and sort ANCHOR table
        function filterAnchorTable() {
            const shopFilter = document.getElementById('anchorShopFilter').value;
            const sortBy = document.getElementById('anchorSortBy').value;

            let filtered = [...anchorWorkOrdersData];

            // Filter by shop
            if (shopFilter !== 'all') {
                filtered = filtered.filter(wo => wo.shop === shopFilter);
            }

            // Sort
            switch (sortBy) {
                case 'days_open_desc':
                    filtered.sort((a, b) => (b.days_open || 0) - (a.days_open || 0));
                    break;
                case 'days_open_asc':
                    filtered.sort((a, b) => (a.days_open || 0) - (b.days_open || 0));
                    break;
                case 'exp_hrs_desc':
                    filtered.sort((a, b) => (b.expected_hours || 0) - (a.expected_hours || 0));
                    break;
                case 'shop':
                    filtered.sort((a, b) => (a.shop || '').localeCompare(b.shop || '') || (b.days_open || 0) - (a.days_open || 0));
                    break;
                case 'aog':
                    filtered.sort((a, b) => (b.is_aog ? 1 : 0) - (a.is_aog ? 1 : 0) || (b.days_open || 0) - (a.days_open || 0));
                    break;
            }

            const tableHTML = filtered.map(wo => {
                const daysOpen = wo.days_open || 0;
                const daysClass = daysOpen >= 30 ? 'badge-red' : daysOpen >= 14 ? 'badge-amber' : 'badge-green';
                const shopColors = { SDN: '#3b82f6', SDV: '#8b5cf6', SDR: '#f97316', SHC: '#06b6d4' };
                const shopColor = shopColors[wo.shop] || '#64748b';
                const aogFlag = wo.is_aog ? '<span style="background:#ef4444;color:#fff;padding:2px 6px;border-radius:4px;font-weight:bold;font-size:0.75em;">AOG</span>' : '';
                const openDate = wo.open_date ? new Date(wo.open_date + 'T00:00:00').toLocaleDateString() : '--';
                const desc = wo.description ? (wo.description.length > 35 ? wo.description.substring(0, 35) + '...' : wo.description) : '--';

                return `
                    <tr style="${wo.is_aog ? 'background: rgba(239,68,68,0.15);' : daysOpen >= 30 ? 'background: rgba(239,68,68,0.08);' : ''}">
                        <td><strong>${wo.wo_number}</strong></td>
                        <td><span style="color:${shopColor};font-weight:600;">${wo.shop}</span></td>
                        <td>${wo.anchor_status || '--'}</td>
                        <td>${wo.tail_number || '--'}</td>
                        <td>${wo.customer || '--'}</td>
                        <td title="${wo.description || ''}" style="font-size:0.85em;">${desc}</td>
                        <td>${openDate}</td>
                        <td><span class="badge ${daysClass}">${daysOpen}d</span></td>
                        <td>${wo.expected_hours ? Math.round(wo.expected_hours) + 'h' : '0h'}</td>
                        <td>${aogFlag}</td>
                    </tr>
                `;
            }).join('');

            document.getElementById('anchorWorkOrdersList').innerHTML = tableHTML || '<tr><td colspan="10" style="text-align:center; color:#94a3b8;">No ANCHOR work orders found</td></tr>';
        }

        // Load all dashboard data
        async function loadDashboardData() {
            await loadAnchorWorkOrders();
            await loadRankings();
            await loadWorkOrders();
            await loadBillingPriority();
            await loadOver30WOs();
            await loadTrainingData();
            await loadQualityData();
            await loadDailyMetrics();
            await loadBudgetData();
            await loadGoalsData();
            await loadEmployeeData();
            await loadWIP();
            await loadActionsData();

            // Update last refreshed timestamp
            const now = new Date();
            const timeStr = now.toLocaleString('en-US', {
                month: 'short', day: 'numeric',
                hour: 'numeric', minute: '2-digit',
                hour12: true
            });
            document.getElementById('lastUpdated').textContent = `Updated: ${timeStr}`;
            document.getElementById('lastUpdated').style.color = '#10b981';
            // Fade back to gray after 5 seconds
            setTimeout(() => {
                document.getElementById('lastUpdated').style.color = '#64748b';
            }, 5000);
        }

        // Helper function to get ordinal suffix (1st, 2nd, 3rd, etc.)
        function getOrdinalSuffix(num) {
            const j = num % 10;
            const k = num % 100;
            if (j === 1 && k !== 11) return 'st';
            if (j === 2 && k !== 12) return 'nd';
            if (j === 3 && k !== 13) return 'rd';
            return 'th';
        }

        // Load Rankings Data
        async function loadRankings() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/rankings?select=*&order=week_ending.desc&limit=10`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                const rankings = await response.json();

                if (rankings.length > 0) {
                    const latest = rankings[0];

                    // Update current position metrics
                    document.getElementById('denverPosition').textContent = `#${latest.denver_position} of ${latest.total_shops}`;
                    document.getElementById('abActual').textContent = `${latest.denver_ab_actual}%`;
                    document.getElementById('abBudget').textContent = `${latest.denver_ab_budget}%`;

                    const variance = (latest.denver_ab_actual - latest.denver_ab_budget).toFixed(1);
                    document.getElementById('abVariance').textContent = `${variance > 0 ? '+' : ''}${variance}%`;
                    document.getElementById('abVariance').style.color = variance >= 0 ? '#10b981' : '#ef4444';

                    const weekDate = new Date(latest.week_ending).toLocaleDateString();
                    document.getElementById('positionDate').textContent = `Week of ${weekDate}`;

                    // Status badge
                    const isGood = variance >= 0;
                    document.getElementById('rankingsBadge').textContent = isGood ? 'On Target' : 'Below Target';
                    document.getElementById('rankingsBadge').className = `badge ${isGood ? 'badge-green' : 'badge-red'}`;

                    // Load history table
                    const historyHTML = rankings.map(r => {
                        const v = (r.denver_ab_actual - r.denver_ab_budget).toFixed(1);
                        const statusClass = v >= 0 ? 'badge-green' : 'badge-red';
                        const statusText = v >= 0 ? 'On Target' : 'Below';
                        return `
                            <tr>
                                <td>${new Date(r.week_ending).toLocaleDateString()}</td>
                                <td><strong>#${r.denver_position}</strong> of ${r.total_shops}</td>
                                <td>${r.denver_ab_actual}%</td>
                                <td>${r.denver_ab_budget}%</td>
                                <td style="color:${v >= 0 ? '#10b981' : '#ef4444'}">${v > 0 ? '+' : ''}${v}%</td>
                                <td><span class="badge ${statusClass}">${statusText}</span></td>
                            </tr>
                        `;
                    }).join('');
                    document.getElementById('rankingsHistory').innerHTML = historyHTML;
                }
            } catch (error) {
                console.error('Error loading rankings:', error);
                document.getElementById('rankingsBadge').textContent = 'Error';
                document.getElementById('rankingsBadge').className = 'badge badge-red';
            }
        }

        // Load Work Orders Data
        async function loadWorkOrders() {
            try {
                // Fetch pending work orders
                const woResponse = await fetch(`${SUPABASE_URL}/rest/v1/work_orders?select=*&status=eq.pending_billing&order=signoff_date.asc`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                const workOrders = await woResponse.json();

                // Fetch over 30 WOs to get open_date and days_open
                const over30Response = await fetch(`${SUPABASE_URL}/rest/v1/over_30_wos?select=wo_number,open_date,days_open`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                const over30WOs = await over30Response.json();

                // Fetch ANCHOR work orders for open dates
                let anchorWOs = [];
                try {
                    const anchorResponse = await fetch(`${SUPABASE_URL}/rest/v1/anchor_work_orders?select=wo_number,date_in`, {
                        headers: {
                            'apikey': SUPABASE_KEY,
                            'Authorization': `Bearer ${SUPABASE_KEY}`
                        }
                    });
                    const anchorData = await anchorResponse.json();
                    anchorWOs = Array.isArray(anchorData) ? anchorData.map(a => ({ wo_number: a.wo_number, open_date: a.date_in })) : [];
                } catch (err) {
                    console.log('anchor_work_orders table not available yet, skipping...');
                }

                // Create lookup maps - ANCHOR has priority over over_30_wos
                const over30Map = {};
                over30WOs.forEach(wo => {
                    over30Map[wo.wo_number] = {
                        open_date: wo.open_date,
                        days_open: wo.days_open
                    };
                });

                const anchorMap = {};
                anchorWOs.forEach(wo => {
                    anchorMap[wo.wo_number] = {
                        open_date: wo.open_date
                    };
                });

                const today = new Date();
                today.setHours(0, 0, 0, 0);

                // Calculate days pending and categorize
                const workOrdersWithDays = workOrders.map(wo => {
                    const signoffDate = new Date(wo.signoff_date);
                    const daysPending = Math.floor((today - signoffDate) / (1000 * 60 * 60 * 24));
                    let category = 'green';
                    if (daysPending >= 8) category = 'red';
                    else if (daysPending >= 4) category = 'amber';

                    // Priority: ANCHOR data first, then over_30_wos
                    const anchorData = anchorMap[wo.work_order_number];
                    const over30Data = over30Map[wo.work_order_number];

                    let open_date = null;
                    let current_days_open = null;

                    if (anchorData?.open_date) {
                        // Use ANCHOR open date (most reliable source - directly from AS400)
                        open_date = anchorData.open_date;
                        const openDateObj = new Date(open_date);
                        current_days_open = Math.floor((today - openDateObj) / (1000 * 60 * 60 * 24));
                    } else if (over30Data?.open_date) {
                        // Fallback to over_30_wos
                        open_date = over30Data.open_date;
                        current_days_open = over30Data.days_open;
                    }

                    return {
                        ...wo,
                        daysPending,
                        category,
                        open_date,
                        current_days_open
                    };
                });

                // Count by category
                const greenCount = workOrdersWithDays.filter(w => w.category === 'green').length;
                const amberCount = workOrdersWithDays.filter(w => w.category === 'amber').length;
                const redCount = workOrdersWithDays.filter(w => w.category === 'red').length;

                // Update metrics
                document.getElementById('totalWorkOrders').textContent = workOrders.length;
                document.getElementById('greenWorkOrders').textContent = greenCount;
                document.getElementById('amberWorkOrders').textContent = amberCount;
                document.getElementById('redWorkOrders').textContent = redCount;

                // Badge
                const badge = redCount > 0 ? { text: `${redCount} Urgent`, class: 'badge-red' } :
                              amberCount > 0 ? { text: `${amberCount} Watch`, class: 'badge-amber' } :
                              { text: 'All Green', class: 'badge-green' };
                document.getElementById('workOrdersBadge').textContent = badge.text;
                document.getElementById('workOrdersBadge').className = `badge ${badge.class}`;

                // Load work orders list
                const listHTML = workOrdersWithDays.map(wo => {
                    const badgeClass = wo.category === 'green' ? 'badge-green' :
                                     wo.category === 'amber' ? 'badge-amber' : 'badge-red';
                    const statusText = wo.category === 'green' ? 'On Track' :
                                     wo.category === 'amber' ? 'Watch' : 'Urgent';

                    // Calculate if WO will be over 30 days by month-end
                    const endOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                    const daysUntilMonthEnd = Math.floor((endOfMonth - today) / (1000 * 60 * 60 * 24));

                    let warning = '';

                    // Use open_date if available (from over_30_wos table), otherwise estimate
                    if (wo.open_date) {
                        // Calculate actual days open by month-end
                        const openDate = new Date(wo.open_date);
                        const daysOpenByMonthEnd = Math.floor((endOfMonth - openDate) / (1000 * 60 * 60 * 24));
                        const currentDaysOpen = wo.current_days_open || Math.floor((today - openDate) / (1000 * 60 * 60 * 24));

                        if (currentDaysOpen >= 30) {
                            // Already over 30 days!
                            warning = `<div style="background: #7c2d12; padding: 8px; border-radius: 4px; border-left: 3px solid #ef4444;">
                                <strong style="color: #fca5a5;">üî¥ ALREADY OVER 30 DAYS</strong><br/>
                                <span style="color: #fed7aa; font-size: 0.85em;">
                                    Currently <strong>${currentDaysOpen} days</strong> open (opened ${new Date(wo.open_date).toLocaleDateString()})<br/>
                                    <strong>URGENT:</strong> Bill immediately to avoid Brian's report!
                                </span>
                            </div>`;
                        } else if (daysOpenByMonthEnd >= 30) {
                            // Will be over 30 by month-end
                            warning = `<div style="background: #7c2d12; padding: 8px; border-radius: 4px; border-left: 3px solid #f59e0b;">
                                <strong style="color: #fbbf24;">‚ö†Ô∏è Will Hit 30 Days</strong><br/>
                                <span style="color: #fed7aa; font-size: 0.85em;">
                                    Currently ${currentDaysOpen} days, will be <strong>${daysOpenByMonthEnd} days</strong> by month-end<br/>
                                    <strong>${daysUntilMonthEnd} days</strong> to bill before appearing in Brian's report
                                </span>
                            </div>`;
                        }
                    } else {
                        // No open_date available - show info message
                        warning = '<span style="color: #94a3b8; font-size: 0.85em;">‚ÑπÔ∏è Open date unknown - bill ASAP to be safe</span>';
                    }

                    return `
                        <tr>
                            <td><strong>${wo.work_order_number}</strong></td>
                            <td>${wo.tail_number}</td>
                            <td>${new Date(wo.signoff_date).toLocaleDateString()}</td>
                            <td>${wo.daysPending} days</td>
                            <td><span class="badge ${badgeClass}">${statusText}</span></td>
                            <td>${warning || '<span style="color: #10b981;">‚úì Will not exceed 30 days</span>'}</td>
                        </tr>
                    `;
                }).join('');
                document.getElementById('workOrdersList').innerHTML = listHTML || '<tr><td colspan="6" style="text-align:center;">No pending work orders</td></tr>';
            } catch (error) {
                console.error('Error loading work orders:', error);
                document.getElementById('workOrdersBadge').textContent = 'Error';
                document.getElementById('workOrdersBadge').className = 'badge badge-red';
            }
        }

        // Load Billing Priority Work Orders (7-Day Tracking)
        async function loadBillingPriority() {
            try {
                // Pull from work_orders table (pending_billing status)
                const response = await fetch(`${SUPABASE_URL}/rest/v1/work_orders?select=*&status=eq.pending_billing&order=signoff_date.asc`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                const workOrders = await response.json();

                if (workOrders.length > 0) {
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);

                    const tableHTML = workOrders.map(wo => {
                        // Calculate days open since signoff
                        const signoffDate = new Date(wo.signoff_date);
                        const daysOpen = Math.floor((today - signoffDate) / (1000 * 60 * 60 * 24));

                        const priorityClass = daysOpen >= 7 ? 'badge-red' : daysOpen >= 5 ? 'badge-amber' : 'badge-green';
                        const priorityText = daysOpen >= 7 ? 'URGENT' : daysOpen >= 5 ? 'High' : 'Normal';

                        return `
                            <tr>
                                <td><strong>${wo.work_order_number || '--'}</strong></td>
                                <td>${wo.customer || '--'}</td>
                                <td>${wo.tail_number || '--'}</td>
                                <td>${wo.signoff_date ? new Date(wo.signoff_date).toLocaleDateString() : '--'}</td>
                                <td><span class="badge ${priorityClass}">${daysOpen} days</span></td>
                                <td>Pending Billing</td>
                                <td><span class="badge ${priorityClass}">${priorityText}</span></td>
                                <td>${daysOpen >= 7 ? 'URGENT: Bill immediately!' : daysOpen >= 5 ? 'High priority' : 'Track'}</td>
                            </tr>
                        `;
                    }).join('');

                    document.getElementById('billingPriorityTable').innerHTML = tableHTML;

                    // Update badge
                    const today_date = new Date();
                    today_date.setHours(0, 0, 0, 0);
                    const urgentCount = workOrders.filter(wo => {
                        const signoffDate = new Date(wo.signoff_date);
                        const daysOpen = Math.floor((today_date - signoffDate) / (1000 * 60 * 60 * 24));
                        return daysOpen >= 7;
                    }).length;

                    if (urgentCount > 0) {
                        document.getElementById('billingPriorityBadge').textContent = `${urgentCount} Urgent`;
                        document.getElementById('billingPriorityBadge').className = 'badge badge-red';
                    } else {
                        document.getElementById('billingPriorityBadge').textContent = `${workOrders.length} Active`;
                        document.getElementById('billingPriorityBadge').className = 'badge badge-amber';
                    }
                } else {
                    document.getElementById('billingPriorityTable').innerHTML = '<tr><td colspan="8" style="text-align:center;">No active work orders tracked</td></tr>';
                    document.getElementById('billingPriorityBadge').textContent = 'None';
                    document.getElementById('billingPriorityBadge').className = 'badge badge-green';
                }
            } catch (error) {
                console.error('Error loading billing priority WOs:', error);
                document.getElementById('billingPriorityTable').innerHTML = '<tr><td colspan="8" style="text-align:center; color: #ef4444;">Error loading data</td></tr>';
            }
        }

        // Load Over 30 Days Work Orders
        async function loadOver30WOs() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/over_30_wos?select=*&order=days_open.desc`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                const over30WOs = await response.json();

                if (over30WOs.length > 0) {
                    const tableHTML = over30WOs.map(wo => {
                        const daysOpen = wo.days_open || 0;
                        const statusClass = daysOpen >= 60 ? 'badge-red' : daysOpen >= 45 ? 'badge-amber' : 'badge-green';

                        return `
                            <tr>
                                <td><strong>${wo.wo_number || '--'}</strong></td>
                                <td>${wo.customer || '--'}</td>
                                <td>${wo.tail_number || '--'}</td>
                                <td>${wo.open_date ? new Date(wo.open_date).toLocaleDateString() : '--'}</td>
                                <td><span class="badge ${statusClass}">${daysOpen} days</span></td>
                                <td>${wo.status || '--'}</td>
                                <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis;">${wo.justification || '--'}<br/><em style="color: #94a3b8;">${wo.action_plan || ''}</em></td>
                                <td>${wo.owner || '--'}</td>
                            </tr>
                        `;
                    }).join('');

                    document.getElementById('over30Table').innerHTML = tableHTML;

                    // Update badge
                    document.getElementById('over30Badge').textContent = `${over30WOs.length} WOs`;
                    document.getElementById('over30Badge').className = over30WOs.length > 5 ? 'badge badge-red' : 'badge badge-amber';
                } else {
                    document.getElementById('over30Table').innerHTML = '<tr><td colspan="8" style="text-align:center; color: #10b981;">‚úÖ No over 30 work orders - Great job!</td></tr>';
                    document.getElementById('over30Badge').textContent = 'Clear';
                    document.getElementById('over30Badge').className = 'badge badge-green';
                }
            } catch (error) {
                console.error('Error loading over 30 WOs:', error);
                document.getElementById('over30Table').innerHTML = '<tr><td colspan="8" style="text-align:center; color: #ef4444;">Error loading data</td></tr>';
            }
        }

        // Load WIP Data
        async function loadWIP() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/wip_entries?select=*&order=month.desc`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                const wipData = await response.json();

                if (wipData.length > 0) {
                    // Get current month data (most recent month)
                    const latestMonth = wipData[0].month;
                    const currentMonthData = wipData.filter(w => w.month === latestMonth);

                    // Calculate totals
                    const totalWIP = currentMonthData.reduce((sum, w) => sum + (w.wip_value || 0), 0);
                    const totalHours = currentMonthData.reduce((sum, w) => sum + (w.hours || 0), 0);
                    const shopCount = currentMonthData.length;

                    // Update summary metrics
                    document.getElementById('wipTotalValue').textContent = `$${totalWIP.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                    document.getElementById('wipTotalHours').textContent = totalHours.toLocaleString('en-US', {minimumFractionDigits: 1, maximumFractionDigits: 1});
                    document.getElementById('wipShopCount').textContent = shopCount;

                    // Format month display
                    const monthDate = new Date(latestMonth + '-01');
                    const monthName = monthDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                    document.getElementById('wipMonth').textContent = monthName;

                    // Update badge
                    document.getElementById('wipBadge').textContent = monthName;
                    document.getElementById('wipBadge').className = 'badge badge-green';

                    // Build shop details table
                    const tableHTML = currentMonthData
                        .sort((a, b) => (b.wip_value || 0) - (a.wip_value || 0))
                        .map(shop => {
                            const wipValue = shop.wip_value || 0;
                            const percentage = ((wipValue / totalWIP) * 100).toFixed(1);
                            const hours = shop.hours || 0;
                            const rate = shop.rate || 0;

                            // Color-code based on shop
                            let shopBadge = '';
                            if (shop.shop === 'SDV') {
                                shopBadge = '<span class="badge badge-blue">SDV</span>';
                            } else if (['SDN', 'SDR', 'SHC'].includes(shop.shop)) {
                                shopBadge = `<span class="badge badge-green">${shop.shop}</span>`;
                            } else {
                                shopBadge = shop.shop;
                            }

                            return `
                                <tr>
                                    <td>${shopBadge}</td>
                                    <td>${hours.toLocaleString('en-US', {minimumFractionDigits: 1, maximumFractionDigits: 1})} hrs</td>
                                    <td>$${rate.toFixed(2)}/hr</td>
                                    <td><strong>$${wipValue.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</strong></td>
                                    <td>${percentage}%</td>
                                </tr>
                            `;
                        }).join('');

                    document.getElementById('wipShopDetails').innerHTML = tableHTML;
                } else {
                    document.getElementById('wipShopDetails').innerHTML = '<tr><td colspan="5" style="text-align:center;">No WIP data available</td></tr>';
                    document.getElementById('wipBadge').textContent = 'No Data';
                    document.getElementById('wipBadge').className = 'badge badge-gray';
                }
            } catch (error) {
                console.error('Error loading WIP data:', error);
                document.getElementById('wipShopDetails').innerHTML = '<tr><td colspan="5" style="text-align:center; color: #ef4444;">Error loading WIP data</td></tr>';
                document.getElementById('wipBadge').textContent = 'Error';
                document.getElementById('wipBadge').className = 'badge badge-red';
            }
        }

        // Load Training Data
        async function loadTrainingData() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/training?select=*&order=due_date.asc`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                const training = await response.json();

                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const thirtyDaysFromNow = new Date(today);
                thirtyDaysFromNow.setDate(today.getDate() + 30);

                // Categorize training by status
                const completed = training.filter(t => t.status === 'Completed');
                const pastDue = training.filter(t => t.status === 'Past Due');
                const dueSoon = training.filter(t => {
                    if (!t.due_date || t.status === 'Completed' || t.status === 'Past Due') return false;
                    const dueDate = new Date(t.due_date);
                    return dueDate > today && dueDate <= thirtyDaysFromNow;
                });

                // Update summary metrics
                document.getElementById('totalTraining').textContent = training.length;
                document.getElementById('completedTrainingCount').textContent = completed.length;
                document.getElementById('dueSoonTrainingCount').textContent = dueSoon.length;
                document.getElementById('pastDueTrainingCount').textContent = pastDue.length;

                // Badge
                const badge = pastDue.length > 0 ? { text: `${pastDue.length} Past Due`, class: 'badge-red' } :
                              dueSoon.length > 0 ? { text: `${dueSoon.length} Due Soon`, class: 'badge-amber' } :
                              { text: 'All On Track', class: 'badge-green' };
                document.getElementById('trainingBadge').textContent = badge.text;
                document.getElementById('trainingBadge').className = `badge ${badge.class}`;

                // Group by category
                const categories = {};
                training.forEach(t => {
                    const cat = t.category || 'Other';
                    if (!categories[cat]) {
                        categories[cat] = { total: 0, completed: 0, pastDue: 0 };
                    }
                    categories[cat].total++;
                    if (t.status === 'Completed') categories[cat].completed++;
                    if (t.status === 'Past Due') categories[cat].pastDue++;
                });

                // Load category summary
                const categoryHTML = Object.entries(categories).map(([cat, stats]) => {
                    const completionPct = stats.total > 0 ? ((stats.completed / stats.total) * 100).toFixed(1) : '0.0';
                    return `
                        <tr>
                            <td><strong>${cat}</strong></td>
                            <td>${stats.total}</td>
                            <td>${stats.completed}</td>
                            <td>${stats.pastDue}</td>
                            <td>${completionPct}%</td>
                        </tr>
                    `;
                }).join('');
                document.getElementById('trainingByCategory').innerHTML = categoryHTML ||
                    '<tr><td colspan="5" style="text-align:center;">No training data</td></tr>';

                // Build Training Detail Table - Grouped by Employee, then Status Priority

                if (training.length === 0) {
                    document.getElementById('trainingDetail').innerHTML =
                        '<tr><td colspan="5" style="text-align:center;">No training assignments</td></tr>';
                    return;
                }

                // Sort training: Past Due first, then by employee, then by status
                const sortedTraining = training.sort((a, b) => {
                    // Priority 1: Past Due first
                    if (a.status === 'Past Due' && b.status !== 'Past Due') return -1;
                    if (a.status !== 'Past Due' && b.status === 'Past Due') return 1;

                    // Priority 2: Sort by employee name
                    if (a.employee_name !== b.employee_name) {
                        return a.employee_name.localeCompare(b.employee_name);
                    }

                    // Priority 3: Within same employee, sort by status (Due Soon, In Progress, Completed)
                    const statusOrder = { 'Due Soon': 1, 'In Progress': 2, 'Completed': 3 };
                    const aOrder = statusOrder[a.status] || 4;
                    const bOrder = statusOrder[b.status] || 4;
                    if (aOrder !== bOrder) return aOrder - bOrder;

                    // Priority 4: Sort by training title
                    return a.training_title.localeCompare(b.training_title);
                });

                // Build table with employee grouping
                let currentEmployee = '';
                const detailHTML = sortedTraining.map((t, index) => {
                    const showEmployee = t.employee_name !== currentEmployee;
                    if (showEmployee) currentEmployee = t.employee_name;

                    const badgeClass = t.status === 'Past Due' ? 'badge-red' :
                                     t.status === 'Completed' ? 'badge-green' :
                                     t.status === 'Due Soon' ? 'badge-amber' : 'badge-gray';

                    const dueDateStr = t.due_date ?
                        new Date(t.due_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) :
                        '<span style="color: #64748b;">No date set</span>';

                    // Truncate long training titles
                    const shortTitle = t.training_title.length > 80 ?
                        t.training_title.substring(0, 77) + '...' :
                        t.training_title;

                    return `
                        <tr ${showEmployee ? 'style="border-top: 2px solid #475569;"' : ''}>
                            <td style="font-weight: ${showEmployee ? '700' : '400'}; color: ${showEmployee ? '#fff' : '#94a3b8'};">
                                ${showEmployee ? t.employee_name : ''}
                            </td>
                            <td style="font-size: 0.9em;">${shortTitle}</td>
                            <td style="font-size: 0.85em;">${t.category || '<span style="color: #64748b;">Uncategorized</span>'}</td>
                            <td style="font-size: 0.85em;">${dueDateStr}</td>
                            <td><span class="badge ${badgeClass}">${t.status}</span></td>
                        </tr>
                    `;
                }).join('');

                document.getElementById('trainingDetail').innerHTML = detailHTML;

            } catch (error) {
                console.error('Error loading training data:', error);
                document.getElementById('trainingBadge').textContent = 'Error';
                document.getElementById('trainingBadge').className = 'badge badge-red';
            }
        }

        // Load Quality/Inspection Data
        async function loadQualityData() {
            try {
                console.log('Loading quality/inspection data...');
                const response = await fetch(`${SUPABASE_URL}/rest/v1/inspections?year=eq.2026&order=inspection_date.desc`, {
                    headers: HEADERS
                });

                // Check if table exists
                if (response.status === 404) {
                    console.log('Inspections table not created yet');
                    document.getElementById('qualityBadge').textContent = 'Setup Required';
                    document.getElementById('qualityBadge').className = 'badge badge-gray';
                    document.getElementById('totalInspections').textContent = '0';
                    document.getElementById('passedInspections').textContent = '0';
                    document.getElementById('failedInspections').textContent = '0';
                    document.getElementById('passRate').textContent = '0%';
                    document.getElementById('discrepancyByCategory').innerHTML = '<tr><td colspan="3" style="text-align:center;">Table not created yet. Run SQL setup.</td></tr>';
                    document.getElementById('inspectionDetails').innerHTML = '<tr><td colspan="6" style="text-align:center;">Table not created yet. See setup instructions.</td></tr>';
                    return;
                }

                const inspections = await response.json();
                console.log('Inspection data received:', inspections);

                // Calculate metrics
                const total = inspections.length;
                const discrepancies = inspections.filter(i => i.discrepency).length;
                const passed = total - discrepancies;
                const passRate = total > 0 ? ((passed / total) * 100).toFixed(1) : '0';

                // Update summary metrics
                document.getElementById('totalInspections').textContent = total;
                document.getElementById('passedInspections').textContent = passed;
                document.getElementById('failedInspections').textContent = discrepancies;
                document.getElementById('passRate').textContent = passRate + '%';

                // Update progress bar
                const progressBar = document.getElementById('qualityProgressBar');
                progressBar.style.width = `${passRate}%`;
                document.getElementById('qualityProgressText').textContent = `${passRate}% Pass Rate (Target: 95%)`;

                // Color coding for progress bar
                if (parseFloat(passRate) >= 95) {
                    progressBar.style.background = 'linear-gradient(90deg, #10b981, #059669)';
                } else if (parseFloat(passRate) >= 85) {
                    progressBar.style.background = 'linear-gradient(90deg, #f59e0b, #d97706)';
                } else {
                    progressBar.style.background = 'linear-gradient(90deg, #ef4444, #dc2626)';
                }

                // Badge
                const badge = document.getElementById('qualityBadge');
                if (parseFloat(passRate) >= 95) {
                    badge.textContent = 'Excellent';
                    badge.className = 'badge badge-green';
                } else if (parseFloat(passRate) >= 85) {
                    badge.textContent = 'Needs Attention';
                    badge.className = 'badge badge-amber';
                } else {
                    badge.textContent = 'Critical';
                    badge.className = 'badge badge-red';
                }

                // Group by category
                const categories = {};
                inspections.forEach(i => {
                    const cat = i.category || 'Other';
                    if (!categories[cat]) {
                        categories[cat] = { count: 0, description: '' };
                    }
                    categories[cat].count++;
                });

                // Set category descriptions
                const catDescriptions = {
                    'CE': 'Clerical Error - Paperwork, signatures, forms',
                    'MS': 'Missing/Incorrect Information - Part numbers, incomplete docs',
                    'RTS': 'RTS Paperwork - Logbooks, RTS statements, documentation',
                    'Other': 'Other quality issues'
                };

                // Group by technician
                const techStats = {};
                inspections.forEach(i => {
                    const tech = i.tech || 'Unknown';
                    if (!techStats[tech]) {
                        techStats[tech] = { total: 0, discrepancies: 0 };
                    }
                    techStats[tech].total++;
                    if (i.discrepency) {
                        techStats[tech].discrepancies++;
                    }
                });

                // Load technician breakdown
                const techHTML = Object.entries(techStats).map(([tech, stats]) => {
                    const techPassRate = stats.total > 0 ? (((stats.total - stats.discrepancies) / stats.total) * 100).toFixed(1) : '100';
                    const statusBadge = parseFloat(techPassRate) >= 95 ? '<span class="badge badge-green">Excellent</span>' :
                                       parseFloat(techPassRate) >= 85 ? '<span class="badge badge-amber">Good</span>' :
                                       '<span class="badge badge-red">Needs Attention</span>';
                    return `
                        <tr>
                            <td><strong>${tech}</strong></td>
                            <td>${stats.total}</td>
                            <td>${stats.discrepancies}</td>
                            <td>${techPassRate}% ${statusBadge}</td>
                        </tr>
                    `;
                }).join('');
                document.getElementById('discrepancyByTech').innerHTML = techHTML ||
                    '<tr><td colspan="4" style="text-align:center;">No technician data available</td></tr>';

                // Load category breakdown with percentages
                const categoryHTML = Object.entries(categories).map(([cat, data]) => {
                    const pct = discrepancies > 0 ? ((data.count / discrepancies) * 100).toFixed(1) : '0';
                    return `
                        <tr>
                            <td><strong>${cat}</strong></td>
                            <td>${data.count}</td>
                            <td>${pct}%</td>
                            <td style="color: #94a3b8;">${catDescriptions[cat] || 'Quality issue'}</td>
                        </tr>
                    `;
                }).join('');
                document.getElementById('discrepancyByCategory').innerHTML = categoryHTML ||
                    '<tr><td colspan="4" style="text-align:center;">No discrepancies found - excellent work!</td></tr>';

                // Group by month
                const monthlyStats = {};
                inspections.forEach(i => {
                    const month = i.month || 'Unknown';
                    if (!monthlyStats[month]) {
                        monthlyStats[month] = { total: 0, discrepancies: 0 };
                    }
                    monthlyStats[month].total++;
                    if (i.discrepency) {
                        monthlyStats[month].discrepancies++;
                    }
                });

                // Month order for 2026
                const monthOrder = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                const monthlyHTML = monthOrder.map(month => {
                    const stats = monthlyStats[month] || { total: 0, discrepancies: 0 };
                    if (stats.total === 0) return '';
                    const monthPassRate = stats.total > 0 ? (((stats.total - stats.discrepancies) / stats.total) * 100).toFixed(1) : '100';
                    const statusBadge = parseFloat(monthPassRate) >= 95 ? '<span class="badge badge-green">‚úì Target Met</span>' :
                                       parseFloat(monthPassRate) >= 85 ? '<span class="badge badge-amber">Close</span>' :
                                       '<span class="badge badge-red">Below Target</span>';
                    return `
                        <tr>
                            <td><strong>${month}</strong></td>
                            <td>${stats.total}</td>
                            <td>${stats.discrepancies}</td>
                            <td>${monthPassRate}%</td>
                            <td>${statusBadge}</td>
                        </tr>
                    `;
                }).filter(row => row).join('');
                document.getElementById('monthlyTrend').innerHTML = monthlyHTML ||
                    '<tr><td colspan="5" style="text-align:center;">No monthly data available yet</td></tr>';

                // Load inspection details
                const detailHTML = inspections.map(i => {
                    const date = i.inspection_date ? new Date(i.inspection_date).toLocaleDateString() : '--';
                    const catBadge = i.category ? `<span class="badge badge-gray">${i.category}</span>` : '--';
                    return `
                        <tr>
                            <td>${date}</td>
                            <td><strong>${i.work_order || '--'}</strong></td>
                            <td>${i.tech || '--'}</td>
                            <td>${i.discrepency || '--'}</td>
                            <td>${catBadge}</td>
                            <td style="color: #94a3b8; font-size: 0.9em;">${i.resolution || 'Pending'}</td>
                        </tr>
                    `;
                }).join('');
                document.getElementById('inspectionDetails').innerHTML = detailHTML ||
                    '<tr><td colspan="6" style="text-align:center;">No inspection data for 2026</td></tr>';

            } catch (error) {
                console.error('Error loading quality data:', error);
                document.getElementById('qualityBadge').textContent = 'Error';
                document.getElementById('qualityBadge').className = 'badge badge-red';
            }
        }

        // Load Daily Metrics Data
        async function loadDailyMetrics() {
            try {
                console.log('Loading daily metrics...');
                const response = await fetch(`${SUPABASE_URL}/rest/v1/daily_metrics?select=*&order=report_date.desc&limit=10`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                const metrics = await response.json();
                console.log('Daily metrics received:', metrics);

                if (metrics.length > 0) {
                    const latest = metrics[0];

                    // Update current metrics
                    document.getElementById('soldHours').textContent = latest.total_sold_hours ? latest.total_sold_hours.toFixed(1) : '--';
                    document.getElementById('billedWOs').textContent = latest.billed_wo_count || '--';
                    document.getElementById('employeeCount').textContent = latest.employee_count || '--';

                    const avgHours = latest.total_sold_hours && latest.employee_count
                        ? (latest.total_sold_hours / latest.employee_count).toFixed(1)
                        : '--';
                    document.getElementById('hoursPerEmployee').textContent = avgHours;

                    const reportDate = new Date(latest.report_date).toLocaleDateString();
                    document.getElementById('soldHoursDate').textContent = reportDate;

                    // Status badge
                    document.getElementById('dailyMetricsBadge').textContent = 'Up to Date';
                    document.getElementById('dailyMetricsBadge').className = 'badge badge-green';

                    // Load history table
                    const historyHTML = metrics.map(m => {
                        const avg = m.total_sold_hours && m.employee_count
                            ? (m.total_sold_hours / m.employee_count).toFixed(1)
                            : '--';
                        return `
                            <tr>
                                <td>${new Date(m.report_date).toLocaleDateString()}</td>
                                <td><strong>${m.total_sold_hours ? m.total_sold_hours.toFixed(1) : '--'}</strong></td>
                                <td>${m.billed_wo_count || '--'}</td>
                                <td>${m.employee_count || '--'}</td>
                                <td>${avg}</td>
                            </tr>
                        `;
                    }).join('');
                    document.getElementById('dailyMetricsHistory').innerHTML = historyHTML;
                }
            } catch (error) {
                console.error('Error loading daily metrics:', error);
            }

            // Calculate A/B ratios from time_entries
            try {
                const timeResponse = await fetch(`${SUPABASE_URL}/rest/v1/time_entries?select=*`, {
                    headers: HEADERS
                });

                if (timeResponse.status === 200) {
                    const timeEntries = await timeResponse.json();

                    // Calculate Denver real-time A/B
                    let totalHours = 0;
                    let billableHours = 0;
                    let janTotal = 0;
                    let janBillable = 0;
                    let febTotal = 0;
                    let febBillable = 0;

                    timeEntries.forEach(entry => {
                        const hours = parseFloat(entry.hours) || 0;
                        const isBillable = entry.wo_type !== 'Shop' && hours > 0;
                        const entryDate = new Date(entry.entry_date);
                        const month = entryDate.getMonth() + 1;

                        totalHours += hours;
                        if (isBillable) billableHours += hours;

                        if (month === 1) {
                            janTotal += hours;
                            if (isBillable) janBillable += hours;
                        } else if (month === 2) {
                            febTotal += hours;
                            if (isBillable) febBillable += hours;
                        }
                    });

                    const denverAB = totalHours > 0 ? (billableHours / totalHours * 100) : 0;
                    const janAB = janTotal > 0 ? (janBillable / janTotal * 100) : 0;
                    const febAB = febTotal > 0 ? (febBillable / febTotal * 100) : 0;

                    // Calculate 1-month rolling (last 30 days)
                    const thirtyDaysAgo = new Date();
                    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                    let rollingTotal = 0;
                    let rollingBillable = 0;

                    timeEntries.forEach(entry => {
                        const entryDate = new Date(entry.entry_date);
                        if (entryDate >= thirtyDaysAgo) {
                            const hours = parseFloat(entry.hours) || 0;
                            const isBillable = entry.wo_type !== 'Shop' && hours > 0;
                            rollingTotal += hours;
                            if (isBillable) rollingBillable += hours;
                        }
                    });

                    const rollingAB = rollingTotal > 0 ? (rollingBillable / rollingTotal * 100) : 0;

                    // Update Denver side (right - green/blue)
                    document.getElementById('denverAB').textContent = `${denverAB.toFixed(1)}%`;
                    document.getElementById('denverRolling').textContent = `1-Month Rolling: ${rollingAB.toFixed(1)}%`;
                    document.getElementById('denverFebOnly').textContent = `Feb-only: ${febAB.toFixed(1)}% ${febAB >= 50 ? '‚úÖ Improving!' : ''}`;

                    // Update comparison stats
                    document.getElementById('janFinal').textContent = `${janAB.toFixed(1)}%`;
                    document.getElementById('febTrend').textContent = `${febAB.toFixed(1)}%`;
                    document.getElementById('rollingAvg').textContent = `${rollingAB.toFixed(1)}%`;

                    // Update status message
                    let statusMsg = '';
                    let statusBg = '';
                    let statusBorder = '';
                    let statusColor = '';

                    if (febAB >= 58.5) {
                        statusMsg = `üéâ Feb is EXCELLENT! ${febAB.toFixed(1)}% Feb-only A/B vs ${janAB.toFixed(1)}% Jan final. AT TARGET! Keep it up!`;
                        statusBg = '#065f46';
                        statusBorder = '#10b981';
                        statusColor = '#10b981';
                    } else if (febAB >= 50) {
                        statusMsg = `‚úÖ Feb is STRONG! ${febAB.toFixed(1)}% Feb-only A/B vs ${janAB.toFixed(1)}% Jan final. Nearly at 58.5% target! Keep pushing.`;
                        statusBg = '#065f46';
                        statusBorder = '#10b981';
                        statusColor = '#10b981';
                    } else if (febAB > janAB) {
                        statusMsg = `üìà Feb is improving! ${febAB.toFixed(1)}% Feb-only A/B vs ${janAB.toFixed(1)}% Jan final. Still below 58.5% target - push harder!`;
                        statusBg = '#78350f';
                        statusBorder = '#f59e0b';
                        statusColor = '#fbbf24';
                    } else {
                        statusMsg = `üî¥ Feb needs work! ${febAB.toFixed(1)}% Feb-only A/B vs ${janAB.toFixed(1)}% Jan final. Below 58.5% target - critical!`;
                        statusBg = '#7f1d1d';
                        statusBorder = '#ef4444';
                        statusColor = '#ef4444';
                    }

                    const statusEl = document.getElementById('abStatusMessage');
                    if (statusEl) {
                        statusEl.style.background = statusBg;
                        statusEl.style.borderLeft = `4px solid ${statusBorder}`;
                        statusEl.innerHTML = `<div style="color: ${statusColor}; font-weight: bold;">${statusMsg}</div>`;
                    }

                    // Matt's numbers from latest rankings data - fetch from database
                    try {
                        const rankingsResponse = await fetch(`${SUPABASE_URL}/rest/v1/rankings?select=*&order=week_ending.desc&limit=1`, {
                            headers: HEADERS
                        });

                        if (rankingsResponse.status === 200) {
                            const rankings = await rankingsResponse.json();
                            if (rankings.length > 0) {
                                const rank = rankings[0];
                                const mattAB = rank.denver_ab_actual;
                                const mattBudget = rank.denver_ab_budget;
                                const mattGap = (mattAB - mattBudget).toFixed(1);

                                // Parse date correctly (add time to avoid timezone issues)
                                const weekEnding = new Date(rank.week_ending + 'T12:00:00');
                                const monthName = weekEnding.toLocaleDateString('en-US', { month: 'short' });
                                const dayNum = weekEnding.getDate();

                                document.getElementById('mattAB').textContent = `${mattAB}%`;
                                document.getElementById('mattPeriod').textContent = `Latest (${monthName} ${dayNum} Update)`;
                                document.getElementById('mattRank').textContent = `Rank: ${rank.denver_position}${getOrdinalSuffix(rank.denver_position)}/${rank.total_shops} | Gap: ${mattGap} pts`;
                                document.getElementById('janRank').textContent = `${rank.denver_position}${getOrdinalSuffix(rank.denver_position)}`;
                            }
                        }
                    } catch (error) {
                        console.error('Error loading Matt rankings:', error);
                    }
                }
            } catch (error) {
                console.error('Error calculating A/B ratios:', error);
            }
        }

        // OLD FUNCTION - NOT USED
        async function loadOverviewEmployeeAB_OLD() {
            console.log('loadOverviewEmployeeAB: Starting...');

            try {
                // Fetch all time entries
                const response = await fetch(`${SUPABASE_URL}/rest/v1/time_entries?select=*`, {
                    headers: HEADERS
                });

                if (response.status === 404) {
                    document.getElementById('overviewEmployeeABCards').innerHTML = '<p style="text-align:center; color:#94a3b8;">No time data available yet</p>';
                    return;
                }

                const timeEntries = await response.json();

                // Group by employee
                const employeeData = {};

                timeEntries.forEach(entry => {
                    const empCode = entry.emp_code;
                    if (!empCode) return;

                    if (!employeeData[empCode]) {
                        employeeData[empCode] = {
                            name: entry.emp_name,
                            code: empCode,
                            ytd: { total: 0, billable: 0 },
                            feb: { total: 0, billable: 0 }
                        };
                    }

                    const hours = parseFloat(entry.hours) || 0;
                    const isBillable = entry.wo_type !== 'Shop' && hours > 0;
                    const entryDate = new Date(entry.entry_date);
                    const month = entryDate.getMonth() + 1;

                    // YTD
                    employeeData[empCode].ytd.total += hours;
                    if (isBillable) employeeData[empCode].ytd.billable += hours;

                    // Feb MTD
                    if (month === 2) {
                        employeeData[empCode].feb.total += hours;
                        if (isBillable) employeeData[empCode].feb.billable += hours;
                    }
                });

                // Convert to array and sort by YTD A/B
                const employees = Object.values(employeeData).map(emp => {
                    const ytdAB = emp.ytd.total > 0 ? (emp.ytd.billable / emp.ytd.total * 100) : 0;
                    const febAB = emp.feb.total > 0 ? (emp.feb.billable / emp.feb.total * 100) : 0;
                    return { ...emp, ytdAB, febAB };
                });

                employees.sort((a, b) => b.ytdAB - a.ytdAB);

                // Generate employee cards (matching rankings format)
                const cardsHTML = employees.map(emp => {
                    const ytdVariance = (emp.ytdAB - 58.5).toFixed(1);
                    const ytdColor = emp.ytdAB >= 58.5 ? '#10b981' : '#ef4444';
                    const febColor = emp.febAB >= 58.5 ? '#10b981' : emp.febAB >= 40 ? '#f59e0b' : '#ef4444';

                    let statusBadge = '';
                    let statusClass = '';
                    if (emp.ytdAB >= 58.5) {
                        statusBadge = 'On Target';
                        statusClass = 'badge-green';
                    } else if (emp.ytdAB >= 40) {
                        statusBadge = 'Below Target';
                        statusClass = 'badge-amber';
                    } else {
                        statusBadge = 'Critical';
                        statusClass = 'badge-red';
                    }

                    return `
                        <div class="card">
                            <div class="card-header">
                                <span class="card-title">üë§ ${emp.name} (${emp.code})</span>
                                <span class="badge ${statusClass}">${statusBadge}</span>
                            </div>
                            <div class="card-grid">
                                <div class="metric">
                                    <div class="metric-value" style="color:${ytdColor};">${emp.ytdAB.toFixed(1)}%</div>
                                    <div class="metric-label">YTD A/B Percentage</div>
                                    <div class="metric-sub">${emp.ytd.billable.toFixed(1)} / ${emp.ytd.total.toFixed(1)} hrs</div>
                                </div>
                                <div class="metric">
                                    <div class="metric-value">58.5%</div>
                                    <div class="metric-label">A/B Target</div>
                                    <div class="metric-sub">Budget Goal</div>
                                </div>
                                <div class="metric">
                                    <div class="metric-value" style="color:${ytdColor};">${ytdVariance > 0 ? '+' : ''}${ytdVariance}%</div>
                                    <div class="metric-label">Variance</div>
                                    <div class="metric-sub">vs Target</div>
                                </div>
                                <div class="metric">
                                    <div class="metric-value" style="color:${febColor};">${emp.febAB.toFixed(1)}%</div>
                                    <div class="metric-label">Feb MTD A/B</div>
                                    <div class="metric-sub">${emp.feb.billable.toFixed(1)} / ${emp.feb.total.toFixed(1)} hrs</div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                document.getElementById('overviewEmployeeABCards').innerHTML = cardsHTML;

                console.log('loadOverviewEmployeeAB: Complete');
            } catch (error) {
                console.error('Error loading overview employee A/B:', error);
                document.getElementById('overviewEmployeeABCards').innerHTML = '<p style="text-align:center; color:#ef4444;">Error loading employee performance data</p>';
            }
        }

        // ==========================================
        // GOALS DATA ‚Äî All 11 Goals, 12-Month Timeline
        // ==========================================

        // Helper: Calculate year progress and pace
        function getYearProgress() {
            const now = new Date();
            const startOfYear = new Date(now.getFullYear(), 0, 1);
            const endOfYear = new Date(now.getFullYear(), 11, 31);
            const totalDays = (endOfYear - startOfYear) / (1000 * 60 * 60 * 24);
            const elapsed = (now - startOfYear) / (1000 * 60 * 60 * 24);
            const pct = (elapsed / totalDays * 100);
            const currentMonth = now.getMonth() + 1; // 1-12
            return { pct: pct.toFixed(1), currentMonth, elapsed: Math.floor(elapsed), totalDays: Math.floor(totalDays), monthsElapsed: currentMonth };
        }

        // Helper: Set goal status (badge, progress bar, percentage, pace)
        function setGoalStatus(prefix, { value, target, pct, badge, badgeClass, barClass, pctColor, paceText, paceClass }) {
            const badgeEl = document.getElementById(`${prefix}GoalBadge`);
            const barEl = document.getElementById(`${prefix}ProgressBar`);
            const pctEl = document.getElementById(`${prefix}ProgressPct`);
            const paceEl = document.getElementById(`${prefix}Pace`);

            if (badgeEl) { badgeEl.textContent = badge; badgeEl.className = `badge ${badgeClass}`; }
            if (barEl) { barEl.style.width = `${Math.min(pct, 100)}%`; barEl.className = `progress-fill ${barClass}`; }
            if (pctEl) { pctEl.textContent = value; if (pctColor) pctEl.style.color = pctColor; }
            if (paceEl) { paceEl.textContent = paceText; paceEl.className = `goal-pace ${paceClass}`; }
        }

        // Helper: Determine pace context for a goal vs 12-month timeline
        function getPaceInfo(currentPct, yearPct) {
            const diff = currentPct - yearPct;
            if (diff >= 5) return { text: `‚ñ≤ ${diff.toFixed(0)}% ahead of pace`, cls: 'pace-ahead' };
            if (diff >= -5) return { text: `‚óè On pace (Year: ${yearPct}% elapsed)`, cls: 'pace-ontrack' };
            return { text: `‚ñº ${Math.abs(diff).toFixed(0)}% behind pace (Year: ${yearPct}% elapsed)`, cls: 'pace-behind' };
        }

        // Update 12-month timeline for a goal
        function updateMonthTimeline(timelineId, currentMonthId, currentMonth) {
            const timeline = document.getElementById(timelineId);
            const monthSpan = document.getElementById(currentMonthId);

            if (!timeline || !currentMonth) return;

            if (monthSpan) monthSpan.textContent = currentMonth;

            const blocks = timeline.querySelectorAll('.month-block');
            blocks.forEach(block => {
                const month = parseInt(block.dataset.month);
                block.classList.remove('complete', 'current', 'future');

                if (month < currentMonth) {
                    block.classList.add('complete');
                } else if (month === currentMonth) {
                    block.classList.add('current');
                } else {
                    block.classList.add('future');
                }
            });
        }

        // Load Budget vs Actual data
        async function loadBudgetData() {
            console.log('loadBudgetData: Loading 2026 budget tracking...');

            const currentDate = new Date();
            const currentYear = currentDate.getFullYear();
            const currentMonth = currentDate.getMonth() + 1; // 1-12

            try {
                // Fetch budget data for current month and YTD
                const budgetResp = await fetch(
                    `${SUPABASE_URL}/rest/v1/budget_vs_actual?period_year=eq.${currentYear}&select=*&order=period_month.asc`,
                    { headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` } }
                );

                const budgetData = await budgetResp.json();

                if (!budgetData || budgetData.length === 0) {
                    console.log('loadBudgetData: No budget data available');
                    document.getElementById('budgetDeptTable').innerHTML =
                        '<tr><td colspan="6" style="text-align:center; padding: 20px; color: #94a3b8;">No budget data available. Please set up budget_vs_actual table.</td></tr>';
                    return;
                }

                console.log('loadBudgetData: Loaded', budgetData.length, 'records');

                // Calculate YTD totals
                const ytdData = {
                    labor: { budget_revenue: 0, actual_revenue: 0, budget_cost: 0, actual_cost: 0, budget_margin: 43.1 },
                    parts: { budget_revenue: 0, actual_revenue: 0, budget_cost: 0, actual_cost: 0, budget_margin: 25.0 },
                    other: { budget_revenue: 0, actual_revenue: 0, budget_cost: 0, actual_cost: 0, budget_margin: 18.0 },
                    total: { budget_revenue: 0, actual_revenue: 0, budget_cost: 0, actual_cost: 0, budget_margin: 28.1 }
                };

                // Sum up YTD (all months up to current month)
                budgetData.forEach(row => {
                    if (row.period_month <= currentMonth && ytdData[row.category]) {
                        ytdData[row.category].budget_revenue += parseFloat(row.budget_revenue || 0);
                        ytdData[row.category].actual_revenue += parseFloat(row.actual_revenue || 0);
                        ytdData[row.category].budget_cost += parseFloat(row.budget_cost || 0);
                        ytdData[row.category].actual_cost += parseFloat(row.actual_cost || 0);
                    }
                });

                // Update summary cards
                const totalBudgetRev = ytdData.total.budget_revenue;
                const totalActualRev = ytdData.total.actual_revenue;
                const totalBudgetCost = ytdData.total.budget_cost;
                const totalActualCost = ytdData.total.actual_cost;
                const totalGrossProfit = totalActualRev - totalActualCost;
                const totalBudgetProfit = totalBudgetRev - totalBudgetCost;
                const actualMargin = totalActualRev > 0 ? ((totalGrossProfit / totalActualRev) * 100) : 0;

                const revenueVariance = totalActualRev - totalBudgetRev;
                const revenueVariancePct = totalBudgetRev > 0 ? ((revenueVariance / totalBudgetRev) * 100) : 0;
                const costVariance = totalActualCost - totalBudgetCost;
                const profitVariance = totalGrossProfit - totalBudgetProfit;
                const marginVariance = actualMargin - 28.1;

                document.getElementById('budgetTotalRevenue').textContent = formatCurrency(totalActualRev || 0);
                document.getElementById('budgetTotalRevenueVar').textContent =
                    `${revenueVariance >= 0 ? '+' : ''}${formatCurrency(revenueVariance)} (${revenueVariancePct.toFixed(1)}%)`;
                document.getElementById('budgetTotalRevenueVar').style.color = revenueVariance >= 0 ? '#6ee7b7' : '#fca5a5';

                document.getElementById('budgetTotalCost').textContent = formatCurrency(totalActualCost || 0);
                document.getElementById('budgetTotalCostVar').textContent =
                    `${costVariance >= 0 ? '+' : ''}${formatCurrency(costVariance)}`;
                document.getElementById('budgetTotalCostVar').style.color = costVariance <= 0 ? '#6ee7b7' : '#fca5a5';

                document.getElementById('budgetGrossProfit').textContent = formatCurrency(totalGrossProfit);
                document.getElementById('budgetGrossProfitVar').textContent =
                    `${profitVariance >= 0 ? '+' : ''}${formatCurrency(profitVariance)}`;
                document.getElementById('budgetGrossProfitVar').style.color = profitVariance >= 0 ? '#93c5fd' : '#fca5a5';

                document.getElementById('budgetMargin').textContent = `${actualMargin.toFixed(1)}%`;
                document.getElementById('budgetMarginVar').textContent = `Target: 28.1% (${marginVariance >= 0 ? '+' : ''}${marginVariance.toFixed(1)}pp)`;
                document.getElementById('budgetMarginVar').style.color = marginVariance >= 0 ? '#fcd34d' : '#fca5a5';

                // Daily revenue tracker
                const workingDays = 21; // average working days per month
                const dailyTarget = 9642; // $702,471 / 21 days
                const dayOfMonth = currentDate.getDate();
                const mtdTarget = dailyTarget * dayOfMonth;

                document.getElementById('budgetMTDRevenue').textContent = formatCurrency(totalActualRev);
                document.getElementById('budgetMTDRevenue').style.color = totalActualRev >= mtdTarget ? '#10b981' : '#ef4444';

                const mtdStatus = totalActualRev >= mtdTarget ? 'On Track' : 'Behind';
                document.getElementById('budgetMTDStatus').textContent = `${mtdStatus} (Target: ${formatCurrency(mtdTarget)})`;
                document.getElementById('budgetMTDStatus').style.color = totalActualRev >= mtdTarget ? '#10b981' : '#ef4444';

                // Revenue pace (projected to end of year)
                const monthsElapsed = currentMonth;
                const projectedAnnual = monthsElapsed > 0 ? (totalActualRev / monthsElapsed) * 12 : 0;
                const annualBudget = 8429649; // from budget

                document.getElementById('budgetRevenuePace').textContent = formatCurrency(projectedAnnual);
                document.getElementById('budgetRevenuePace').style.color = projectedAnnual >= annualBudget ? '#10b981' : '#f59e0b';

                const paceStatus = projectedAnnual >= annualBudget ? 'Ahead of Budget' : 'Below Budget';
                const paceVar = projectedAnnual - annualBudget;
                document.getElementById('budgetPaceStatus').textContent =
                    `${paceStatus} (${paceVar >= 0 ? '+' : ''}${formatCurrency(paceVar)})`;
                document.getElementById('budgetPaceStatus').style.color = projectedAnnual >= annualBudget ? '#10b981' : '#f59e0b';

                // Department breakdown table
                const deptHTML = ['labor', 'parts', 'other'].map(dept => {
                    const data = ytdData[dept];
                    const variance = data.actual_revenue - data.budget_revenue;
                    const variancePct = data.budget_revenue > 0 ? ((variance / data.budget_revenue) * 100) : 0;
                    const actualDeptMargin = data.actual_revenue > 0 ? (((data.actual_revenue - data.actual_cost) / data.actual_revenue) * 100) : 0;
                    const marginDiff = actualDeptMargin - data.budget_margin;

                    let statusBadge = '';
                    if (variance >= 0 && marginDiff >= 0) statusBadge = '<span class="badge-green">‚úÖ Exceeding</span>';
                    else if (variance >= 0 || marginDiff >= 0) statusBadge = '<span class="badge-amber">‚ö†Ô∏è Mixed</span>';
                    else statusBadge = '<span class="badge-red">üî¥ Below</span>';

                    return `
                        <tr>
                            <td style="padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                ${dept.charAt(0).toUpperCase() + dept.slice(1)}
                            </td>
                            <td style="text-align: right; padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                ${formatCurrency(data.budget_revenue)}
                            </td>
                            <td style="text-align: right; padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.1); color: ${variance >= 0 ? '#10b981' : '#ef4444'};">
                                ${formatCurrency(data.actual_revenue || 0)}
                            </td>
                            <td style="text-align: right; padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.1); color: ${variance >= 0 ? '#10b981' : '#ef4444'};">
                                ${variance >= 0 ? '+' : ''}${formatCurrency(variance)} (${variancePct.toFixed(1)}%)
                            </td>
                            <td style="text-align: right; padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.1); color: ${marginDiff >= 0 ? '#10b981' : '#f59e0b'};">
                                ${actualDeptMargin.toFixed(1)}% / ${data.budget_margin}%
                            </td>
                            <td style="text-align: center; padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                ${statusBadge}
                            </td>
                        </tr>
                    `;
                }).join('');

                document.getElementById('budgetDeptTable').innerHTML = deptHTML;

                // A/B Ratio Impact Calculator
                // This will be populated from actual A/B data
                const currentAB = 38.8; // Get from rankings data
                const targetAB = 58.5;
                const abGap = targetAB - currentAB;

                // Calculate revenue impact if at target A/B
                const laborBudget = 2429649; // annual labor revenue budget
                const currentLaborRevenue = ytdData.labor.actual_revenue || 0;
                const projectedLaborRevenue = monthsElapsed > 0 ? (currentLaborRevenue / monthsElapsed) * 12 : 0;

                // If we were at 58.5% instead of current rate
                const potentialRevenue = projectedLaborRevenue * (targetAB / currentAB);
                const revenueImpact = potentialRevenue - projectedLaborRevenue;

                document.getElementById('abCurrentRatio').textContent = `${currentAB}%`;
                document.getElementById('abGap').textContent = `${abGap.toFixed(1)}pp`;
                document.getElementById('abRevenueImpact').textContent = formatCurrency(revenueImpact);

                // Calculate billable hours needed
                const avgLaborRate = 125; // approximate hourly rate
                const additionalHoursNeeded = revenueImpact / avgLaborRate;
                const monthlyAdditionalHours = additionalHoursNeeded / (12 - monthsElapsed);

                document.getElementById('abActionText').textContent =
                    `Need ${Math.round(additionalHoursNeeded)} additional billable hours this year (‚âà${Math.round(monthlyAdditionalHours)}/month) to reach 58.5% target and capture $${Math.round(revenueImpact/1000)}K in additional revenue.`;

                console.log('loadBudgetData: Complete');

            } catch (error) {
                console.error('loadBudgetData: Error loading budget data:', error);
                document.getElementById('budgetDeptTable').innerHTML =
                    '<tr><td colspan="6" style="text-align:center; padding: 20px; color: #ef4444;">Error loading budget data. Check console for details.</td></tr>';
            }
        }

        function formatCurrency(value) {
            if (value === null || value === undefined || isNaN(value)) return '$0';
            return '$' + Math.round(value).toLocaleString();
        }

        async function loadGoalsData() {
            console.log('loadGoalsData: Loading 2026 Performance Review Goals...');
            const yr = getYearProgress();

            // Set the annual timeline indicator
            document.getElementById('yearProgressFill').style.width = `${yr.pct}%`;
            document.getElementById('timelineStatus').textContent = `Month ${yr.monthsElapsed}/12 ¬∑ Day ${yr.elapsed}/${yr.totalDays} ¬∑ ${yr.pct}% elapsed`;

            // Track scorecard data for bottom table
            const scorecard = [];

            try {
                // ====================================
                // FETCH DATA IN PARALLEL
                // ====================================
                const [rankingsResp, npsYearResp, trainingResp] = await Promise.all([
                    fetch(`${SUPABASE_URL}/rest/v1/rankings?select=*&order=week_ending.desc&limit=1`, {
                        headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
                    }),
                    fetch(`${SUPABASE_URL}/rest/v1/nps_surveys?select=*&date_sent=gte.${new Date(new Date().getFullYear(), 0, 1).toISOString().split('T')[0]}&order=date_sent.desc`, {
                        headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
                    }),
                    fetch(`${SUPABASE_URL}/rest/v1/training?select=*&order=due_date.asc`, {
                        headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
                    })
                ]);

                const rankings = await rankingsResp.json();
                const npsYear = await npsYearResp.json();
                const training = await trainingResp.json();

                console.log('loadGoalsData: Data fetched ‚Äî rankings:', rankings.length, 'npsYear:', npsYear.length, 'training:', training.length);

                // ====================================
                // GOAL #1: Financial Objectives (A/B 58.5%, ELR)
                // ====================================
                if (rankings.length > 0) {
                    const rank = rankings[0];
                    const abPercentage = rank.denver_ab_actual;
                    const yearlyTarget = 58.5;
                    const gap = (yearlyTarget - abPercentage).toFixed(1);
                    const progress = Math.min((abPercentage / yearlyTarget * 100), 100);

                    document.getElementById('currentAB').textContent = `${abPercentage}%`;
                    document.getElementById('networkRank').textContent = `#${rank.denver_position}`;
                    document.getElementById('abGap').textContent = abPercentage >= yearlyTarget ? 'None' : `${gap}pp`;

                    let badge, badgeClass, barClass, pctColor, abPaceText, abPaceClass;
                    if (abPercentage >= yearlyTarget) {
                        badge = '‚úÖ On Target'; badgeClass = 'badge-green'; barClass = 'progress-fill progress-green'; pctColor = '#10b981';
                        abPaceText = `‚ñ≤ Meeting yearly target of 58.5%`; abPaceClass = 'pace-ahead';
                    } else if (progress >= 95) {
                        badge = `${gap}pp gap`; badgeClass = 'badge-amber'; barClass = 'progress-fill progress-amber'; pctColor = '#f59e0b';
                        abPaceText = `‚óè Close to yearly target ‚Äî need +${gap}pp to reach 58.5%`; abPaceClass = 'pace-ontrack';
                    } else {
                        badge = `${gap}pp gap`; badgeClass = 'badge-red'; barClass = 'progress-fill progress-red'; pctColor = '#ef4444';
                        abPaceText = `‚ñº ${gap}pp below yearly target of 58.5%`; abPaceClass = 'pace-behind';
                    }

                    setGoalStatus('ab', {
                        value: `${abPercentage}%`, target: `${yearlyTarget}%`, pct: progress,
                        badge, badgeClass, barClass, pctColor,
                        paceText: abPaceText, paceClass: abPaceClass
                    });

                    scorecard.push({ num: 1, name: 'Financial Objectives (A/B, ELR)', target: '58.5%', current: `${abPercentage}%`, status: abPercentage >= yearlyTarget ? 'green' : (progress >= 95 ? 'amber' : 'red'), statusText: abPercentage >= yearlyTarget ? 'On Target' : `${gap}pp gap` });
                }

                // ====================================
                // GOAL #2: NPS Program (1/month minimum)
                // ====================================
                const sentYTD = npsYear.length;
                const yearlyGoal = 12;
                const expectedByNow = yr.monthsElapsed;
                const npsProgress = Math.min((sentYTD / yearlyGoal * 100), 100);

                document.getElementById('surveysSent').textContent = sentYTD;
                document.getElementById('billedWOsMonth').textContent = '--';
                document.getElementById('pendingSurveys').textContent = sentYTD;

                let npsBadge, npsBadgeClass, npsBarClass, npsPctColor, npsPaceText, npsPaceClass;
                if (sentYTD >= yearlyGoal) {
                    npsBadge = '‚úÖ Yearly Goal Met!'; npsBadgeClass = 'badge-green'; npsBarClass = 'progress-fill progress-green'; npsPctColor = '#10b981';
                    npsPaceText = `‚ñ≤ ${sentYTD} of 12 yearly goal achieved`; npsPaceClass = 'pace-ahead';
                } else if (sentYTD >= expectedByNow) {
                    npsBadge = '‚úÖ On Pace'; npsBadgeClass = 'badge-green'; npsBarClass = 'progress-fill progress-green'; npsPctColor = '#10b981';
                    npsPaceText = `‚ñ≤ ${sentYTD} of 12 yearly ‚Äî on pace (expected ${expectedByNow} by month ${yr.monthsElapsed})`; npsPaceClass = 'pace-ahead';
                } else {
                    const behind = expectedByNow - sentYTD;
                    npsBadge = `Need ${behind} more`; npsBadgeClass = 'badge-red'; npsBarClass = 'progress-fill progress-red'; npsPctColor = '#ef4444';
                    npsPaceText = `‚ñº ${sentYTD} of 12 yearly ‚Äî ${behind} behind pace (expected ${expectedByNow})`; npsPaceClass = 'pace-behind';
                }

                setGoalStatus('nps', {
                    value: `${sentYTD}/12`, pct: npsProgress,
                    badge: npsBadge, badgeClass: npsBadgeClass, barClass: npsBarClass, pctColor: npsPctColor,
                    paceText: npsPaceText, paceClass: npsPaceClass
                });

                scorecard.push({ num: 2, name: 'NPS Program', target: '12/year', current: `${sentYTD}/12`, status: sentYTD >= expectedByNow ? 'green' : 'red', statusText: sentYTD >= expectedByNow ? 'On Pace' : `${expectedByNow - sentYTD} behind` });

                // ====================================
                // GOAL #3: Training Completion (100% On Time)
                // ====================================
                const completedCount = training.filter(t => t.status === 'Completed').length;
                const pastDueCount = training.filter(t => t.status === 'Past Due').length;
                const today = new Date();
                const thirtyDaysFromNow = new Date(today);
                thirtyDaysFromNow.setDate(today.getDate() + 30);
                const upcomingCount = training.filter(t => {
                    if (!t.due_date) return false;
                    const dueDate = new Date(t.due_date);
                    return dueDate > today && dueDate <= thirtyDaysFromNow;
                }).length;
                const totalTraining = training.length;
                const completionRate = totalTraining > 0 ? ((completedCount / totalTraining) * 100) : 0;

                document.getElementById('completedTraining').textContent = `${completedCount}/${totalTraining}`;
                document.getElementById('pastDueTraining').textContent = pastDueCount;
                document.getElementById('upcomingTraining').textContent = upcomingCount;

                let trBadge, trBadgeClass, trBarClass, trPctColor, trPaceText, trPaceClass;
                if (pastDueCount === 0 && completionRate === 100) {
                    trBadge = '‚úÖ 100% Complete'; trBadgeClass = 'badge-green'; trBarClass = 'progress-fill progress-green'; trPctColor = '#10b981';
                    trPaceText = `‚ñ≤ All training complete ‚Äî yearly goal achieved`; trPaceClass = 'pace-ahead';
                } else if (pastDueCount > 0) {
                    trBadge = `‚ö†Ô∏è ${pastDueCount} Past Due`; trBadgeClass = 'badge-red'; trBarClass = 'progress-fill progress-red'; trPctColor = '#ef4444';
                    trPaceText = `‚ñº ${pastDueCount} items past due ‚Äî yearly goal: 100% on time`; trPaceClass = 'pace-behind';
                } else {
                    trBadge = `${completionRate.toFixed(0)}% Done`; trBadgeClass = 'badge-amber'; trBarClass = 'progress-fill progress-amber'; trPctColor = '#f59e0b';
                    trPaceText = `‚óè ${completionRate.toFixed(0)}% complete ‚Äî working toward 100% yearly goal`; trPaceClass = 'pace-ontrack';
                }

                setGoalStatus('training', {
                    value: `${completionRate.toFixed(1)}%`, pct: completionRate,
                    badge: trBadge, badgeClass: trBadgeClass, barClass: trBarClass, pctColor: trPctColor,
                    paceText: trPaceText, paceClass: trPaceClass
                });

                scorecard.push({ num: 3, name: 'Training Completion', target: '100% on time', current: `${completionRate.toFixed(0)}%`, status: pastDueCount > 0 ? 'red' : (completionRate === 100 ? 'green' : 'amber'), statusText: pastDueCount > 0 ? `${pastDueCount} past due` : `${completionRate.toFixed(0)}%` });

                // ====================================
                // GOAL #4: Flat-Rate System Re-evaluation (Manual/Static)
                // ====================================
                scorecard.push({ num: 4, name: 'Flat-Rate Re-evaluation', target: 'Data analysis', current: 'In Progress', status: 'amber', statusText: 'Analysis' });

                // ====================================
                // GOAL #5: Customer Experience - Communication (Manual/Static)
                // ====================================
                scorecard.push({ num: 5, name: 'Customer Communication', target: 'Prompt & Professional', current: 'Ongoing', status: 'green', statusText: 'Process-based' });

                // ====================================
                // GOAL #6: Expense Budget Management (Manual/Static)
                // ====================================
                scorecard.push({ num: 6, name: 'Expense Budget', target: 'Within budget', current: 'Monthly Review', status: 'amber', statusText: 'Tracking' });

                // ====================================
                // GOAL #7: FAA/Internal Audits - Zero Findings
                // ====================================
                // NOTE: Uses 'audit' prefix to match auditGoalBadge in HTML
                setGoalStatus('audit', {
                    value: 'Ongoing', pct: 50,
                    badge: '‚úì Compliant', badgeClass: 'badge-green', barClass: 'progress-fill progress-green', pctColor: '#10b981',
                    paceText: `‚óè Yearly target: Complete all FAA and internal audits with zero findings`, paceClass: 'pace-ontrack'
                });
                document.getElementById('auditsCompleted').textContent = '--';
                document.getElementById('auditFindings').textContent = '0';

                scorecard.push({ num: 7, name: 'Audits - Zero Findings', target: '0 findings', current: 'Ongoing', status: 'green', statusText: 'Compliant' });

                // ====================================
                // GOAL #8: Monthly A/B Plan
                // ====================================
                // NOTE: Uses 'abPlan' prefix to match abPlanGoalBadge in HTML
                setGoalStatus('abPlan', {
                    value: 'Active', pct: 50,
                    badge: 'üìÖ Planning', badgeClass: 'badge-amber', barClass: 'progress-fill progress-amber', pctColor: '#f59e0b',
                    paceText: `‚óè Yearly plan: Meet A/B budget each month (links to Goal #1)`, paceClass: 'pace-ontrack'
                });

                scorecard.push({ num: 8, name: 'Monthly A/B Plan', target: 'Meet monthly', current: 'Active', status: 'amber', statusText: 'Planning' });

                // ====================================
                // GOAL #9: Dealer Programs - Exclusive Use (Manual/Static)
                // ====================================
                scorecard.push({ num: 9, name: 'Dealer Programs', target: '100% use', current: 'Compliant', status: 'green', statusText: 'Compliant' });

                // ====================================
                // GOAL #10: Vendor Dispute Communication (Manual/Static)
                // ====================================
                scorecard.push({ num: 10, name: 'Vendor Disputes', target: '<30 days to BZ', current: 'As Needed', status: 'green', statusText: 'Timely' });

                // ====================================
                // GOAL #11: Risk Area Identification (Manual/Static)
                // ====================================
                scorecard.push({ num: 11, name: 'Risk Identification', target: 'Reduce score', current: 'Strategic', status: 'amber', statusText: 'Ongoing' });

                // ====================================
                // UPDATE 12-MONTH TIMELINES FOR ALL GOALS
                // ====================================
                const currentMonth = yr.monthsElapsed;
                updateMonthTimeline('abMonthTimeline', 'abCurrentMonth', currentMonth);
                updateMonthTimeline('npsMonthTimeline', 'npsCurrentMonth', currentMonth);
                updateMonthTimeline('trainingMonthTimeline', 'trainingCurrentMonth', currentMonth);
                updateMonthTimeline('goal4MonthTimeline', 'goal4CurrentMonth', currentMonth);
                updateMonthTimeline('goal5MonthTimeline', 'goal5CurrentMonth', currentMonth);
                updateMonthTimeline('goal6MonthTimeline', 'goal6CurrentMonth', currentMonth);
                updateMonthTimeline('goal7MonthTimeline', 'goal7CurrentMonth', currentMonth);
                updateMonthTimeline('goal8MonthTimeline', 'goal8CurrentMonth', currentMonth);
                updateMonthTimeline('goal9MonthTimeline', 'goal9CurrentMonth', currentMonth);
                updateMonthTimeline('goal10MonthTimeline', 'goal10CurrentMonth', currentMonth);
                updateMonthTimeline('goal11MonthTimeline', 'goal11CurrentMonth', currentMonth);

                // ====================================
                // UPDATE GOALS SUMMARY BADGE
                // ====================================
                const greenCount = scorecard.filter(s => s.status === 'green').length;
                const redCount = scorecard.filter(s => s.status === 'red').length;
                const amberCount = scorecard.filter(s => s.status === 'amber').length;
                document.getElementById('goalsActiveBadge').textContent = `${greenCount} ‚úÖ ${amberCount} üü° ${redCount} üî¥`;
                document.getElementById('goalsActiveBadge').className = `badge ${redCount > 0 ? 'badge-red' : (amberCount > 3 ? 'badge-amber' : 'badge-green')}`;

            } catch (error) {
                console.error('Error loading goals data:', error);
                ['ab', 'nps', 'training', 'audit', 'abPlan'].forEach(prefix => {
                    const el = document.getElementById(`${prefix}GoalBadge`);
                    if (el) { el.textContent = 'Error'; el.className = 'badge badge-red'; }
                });
            }
        }

        // NPS Survey Functions
        function fillNPSForm(customer, email, wo, reg) {
            document.getElementById('customerName').value = customer;
            document.getElementById('customerEmail').value = email;
            document.getElementById('woNumber').value = wo || '';
            document.getElementById('regNumber').value = reg || '';

            // Scroll to form
            document.querySelector('#npsForm').scrollIntoView({ behavior: 'smooth' });
        }

        async function sendNPSSurvey(event) {
            event.preventDefault();

            const customer = document.getElementById('customerName').value;
            const email = document.getElementById('customerEmail').value;
            const wo = document.getElementById('woNumber').value;
            const reg = document.getElementById('regNumber').value;

            // Open Outlook with pre-filled email
            const subject = reg ?
                `Customer Survey - ${reg} - WO ${wo}` :
                `Customer Survey - WO ${wo}`;

            const body = `Dear ${customer},%0D%0A%0D%0AThank you for choosing Denver Satellite for your aircraft maintenance needs. We value your feedback!%0D%0A%0D%0APlease take a moment to complete our brief satisfaction survey:%0D%0A%0D%0Ahttps://form.jotform.com/231574976012155%0D%0A%0D%0AWork Order: ${wo}%0D%0AAircraft: ${reg || 'N/A'}%0D%0A%0D%0ABest regards,%0D%0ADenver Satellite Team`;

            const mailtoLink = `mailto:${email}?subject=${encodeURIComponent(subject)}&body=${body}`;
            window.open(mailtoLink);

            // Log to Supabase
            await logNPSSurvey(customer, email, wo, reg);
        }

        async function logOnlyNPS() {
            const customer = document.getElementById('customerName').value;
            const email = document.getElementById('customerEmail').value;
            const wo = document.getElementById('woNumber').value;
            const reg = document.getElementById('regNumber').value;

            if (!customer || !email || !wo) {
                alert('Please fill in Customer Name, Email, and Work Order #');
                return;
            }

            await logNPSSurvey(customer, email, wo, reg);
        }

        async function logNPSSurvey(customer, email, wo, reg) {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/nps_surveys`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=representation'
                    },
                    body: JSON.stringify({
                        date_sent: new Date().toISOString().split('T')[0],
                        customer: customer,
                        email: email,
                        wo_number: wo,
                        reg_number: reg || null,
                        status: 'Sent',
                        month: new Date().toISOString().slice(0, 7)
                    })
                });

                if (response.ok) {
                    alert(`‚úÖ NPS Survey logged for ${customer}!`);
                    document.getElementById('npsForm').reset();
                    loadActionsData();
                } else {
                    alert('‚ùå Error logging survey. Please try again.');
                }
            } catch (error) {
                console.error('Error logging NPS:', error);
                alert('‚ùå Error logging survey. Please try again.');
            }
        }

        async function loadNPSRecommendations(existingSurveys) {
            try {
                // 1. Get billed work orders (now includes customer_id from AS400 Billed WO report)
                const [billedWOsResp, custEmailsResp, anchorResp] = await Promise.all([
                    fetch(`${SUPABASE_URL}/rest/v1/work_orders?select=work_order_number,tail_number,billed_date,customer_id,customer_name&status=eq.billed&order=billed_date.desc&limit=50`, {
                        headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
                    }),
                    fetch(`${SUPABASE_URL}/rest/v1/customers?select=customer_number,email,customer_name`, {
                        headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
                    }),
                    fetch(`${SUPABASE_URL}/rest/v1/anchor_work_orders?select=wo_number,customer,customer_id`, {
                        headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
                    })
                ]);

                const billedWOs = await billedWOsResp.json();
                const custEmails = await custEmailsResp.json();
                const anchorWOs = await anchorResp.json();
                if (!Array.isArray(billedWOs)) { console.log('billedWOs not array'); return; }

                // 2. Build customer_number ‚Üí email lookup from Customers email.xlsx database
                const emailByCustomerId = {};
                if (Array.isArray(custEmails)) custEmails.forEach(c => {
                    if (c.customer_number && c.email) {
                        emailByCustomerId[c.customer_number] = c.email;
                    }
                });

                // 3. Build customer_id ‚Üí customer_name lookup from ANCHOR (for display names)
                const customerIdToName = {};
                if (Array.isArray(anchorWOs)) anchorWOs.forEach(a => {
                    if (a.customer_id && a.customer) {
                        customerIdToName[a.customer_id] = a.customer;
                    }
                });

                // 4. Build set of WO#s already surveyed
                const surveyedWOs = new Set(existingSurveys.map(s => s.wo_number));

                // 5. Build set of customer_ids already surveyed THIS MONTH (one per customer per month)
                const now = new Date();
                const firstDayOfMonth = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-01`;
                const surveyedCustomersThisMonth = new Set();
                existingSurveys.forEach(s => {
                    if (s.date_sent >= firstDayOfMonth) {
                        // Track by customer name (lowercase) for deduplication
                        if (s.customer) surveyedCustomersThisMonth.add(s.customer.toLowerCase().trim());
                    }
                });

                // 6. Filter unsurveyed WOs
                const unsurveyed = billedWOs.filter(wo => !surveyedWOs.has(wo.work_order_number));

                if (unsurveyed.length === 0) {
                    document.getElementById('customerRecommendations').innerHTML = '<tr><td colspan="6" style="text-align:center; color:#10b981;">‚úÖ All billed work orders have been surveyed!</td></tr>';
                    document.getElementById('recommendBadge').textContent = '0 Pending';
                    document.getElementById('recommendBadge').className = 'badge badge-green';
                    return;
                }

                // 7. Enrich each WO with email from Customers email.xlsx (matched by customer_id)
                // Track customer_ids we've already assigned a survey to in this pending list
                // Rule: ONE survey per customer per month ‚Äî first WO wins, rest are grayed out
                const pendingCustomerIds = new Set();

                const enriched = unsurveyed.map(wo => {
                    const billedDate = new Date(wo.billed_date);
                    const daysSince = Math.floor((now - billedDate) / (1000 * 60 * 60 * 24));

                    // customer_id comes directly from work_orders (AS400 Billed WO report Cust# field)
                    const customerId = wo.customer_id || null;
                    // Customer name: from work_orders, or look up from ANCHOR by customer_id
                    const customerName = wo.customer_name || customerIdToName[customerId] || null;

                    // Look up email from Customers email.xlsx database by customer_id
                    let email = null;
                    let emailSource = null;
                    if (customerId && emailByCustomerId[customerId]) {
                        email = emailByCustomerId[customerId];
                        emailSource = 'database';
                    }

                    // Check one-per-customer-per-month rule:
                    // 1. Already sent a survey this month (from nps_surveys table)
                    // 2. Already assigned to another WO in this pending list (first WO wins)
                    let alreadySurveyedThisMonth = false;
                    if (customerId && surveyedCustomersThisMonth.has(customerId)) {
                        alreadySurveyedThisMonth = true;
                    } else if (customerName && surveyedCustomersThisMonth.has(customerName.toLowerCase().trim())) {
                        alreadySurveyedThisMonth = true;
                    } else if (customerId && pendingCustomerIds.has(customerId)) {
                        // Another WO for same customer already in pending list ‚Äî one per month max
                        alreadySurveyedThisMonth = true;
                    }

                    // If this customer hasn't been claimed yet, claim them
                    if (!alreadySurveyedThisMonth && customerId) {
                        pendingCustomerIds.add(customerId);
                    }

                    return {
                        ...wo,
                        customerName,
                        customerId,
                        email,
                        emailSource,
                        daysSince,
                        billedDateStr: billedDate.toLocaleDateString(),
                        alreadySurveyedThisMonth
                    };
                });

                // 8. Render table
                const recommendHTML = enriched.slice(0, 20).map(wo => {
                    const hasEmail = !!wo.email;
                    const displayName = wo.customerName || `Unknown (${wo.tail_number || 'N/A'})`;
                    const displayEmail = hasEmail ? wo.email : '';
                    const emailWarning = !hasEmail
                        ? '<span style="color:#ef4444;font-weight:bold;" title="Email not in Customers email.xlsx database">‚ö†Ô∏è NOT IN DB</span>'
                        : `<span style="color:#94a3b8;font-size:0.85em;">${displayEmail}</span>`;

                    // One-per-month badge
                    let monthBadge = '';
                    if (wo.alreadySurveyedThisMonth) {
                        monthBadge = '<br><span style="color:#f59e0b;font-size:0.75em;font-weight:bold;">‚ö†Ô∏è Already surveyed this month</span>';
                    }

                    // Button state
                    const btnDisabled = !hasEmail || wo.alreadySurveyedThisMonth;
                    const btnStyle = btnDisabled
                        ? 'background:#334155;color:#64748b;cursor:not-allowed;'
                        : 'background:#10b981;color:white;cursor:pointer;';
                    const btnOnclick = btnDisabled
                        ? ''
                        : `onclick="fillNPSForm('${(wo.customerName || '').replace(/'/g, "\\'")}', '${wo.email || ''}', '${wo.work_order_number}', '${wo.tail_number || ''}')"`;

                    return `
                        <tr style="${wo.alreadySurveyedThisMonth ? 'opacity:0.5;' : ''}">
                            <td><strong>${displayName}</strong>${wo.customerId ? '<br><span style="color:#64748b;font-size:0.75em;">ID: ' + wo.customerId + '</span>' : ''}${monthBadge}</td>
                            <td>${wo.tail_number || '--'}</td>
                            <td>${emailWarning}</td>
                            <td><strong style="color:#10b981;">${wo.work_order_number}</strong><br>
                                <span style="color:#64748b;font-size:0.85em;">Billed: ${wo.billedDateStr}</span>
                            </td>
                            <td><span style="color:${wo.daysSince > 7 ? '#ef4444' : wo.daysSince > 3 ? '#f59e0b' : '#10b981'};">${wo.daysSince}d</span></td>
                            <td>
                                <button
                                    class="action-btn"
                                    ${btnOnclick}
                                    ${btnDisabled ? 'disabled' : ''}
                                    style="border:none;padding:6px 12px;border-radius:4px;font-size:0.85em;font-weight:bold;${btnStyle}">
                                    ${wo.alreadySurveyedThisMonth ? '‚úÖ Done' : !hasEmail ? '‚ö†Ô∏è No Email' : 'üìß Send Survey'}
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');

                document.getElementById('customerRecommendations').innerHTML = recommendHTML;

                // Count actionable (have email + not surveyed this month)
                const actionable = enriched.filter(wo => wo.email && !wo.alreadySurveyedThisMonth).length;
                const noEmail = enriched.filter(wo => !wo.email).length;
                document.getElementById('recommendBadge').textContent = `${unsurveyed.length} Pending${noEmail > 0 ? ' | ' + noEmail + ' ‚ö†Ô∏è' : ''}`;
                document.getElementById('recommendBadge').className = noEmail > 0 ? 'badge badge-red' : unsurveyed.length > 5 ? 'badge badge-amber' : 'badge badge-green';

            } catch (error) {
                console.error('Error loading NPS recommendations:', error);
                document.getElementById('customerRecommendations').innerHTML = '<tr><td colspan="6" style="text-align:center; color:#ef4444;">Error loading recommendations</td></tr>';
            }
        }

        async function loadActionsData() {
            // Load customer recommendations and recent activity
            try {
                // Get recent NPS activity
                const activityResp = await fetch(`${SUPABASE_URL}/rest/v1/nps_surveys?select=*&order=date_sent.desc&limit=10`, {
                    headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
                });
                const activity = await activityResp.json();

                // Update activity table
                const activityHTML = activity.map(survey => {
                    const statusClass = survey.status === 'Completed' ? 'badge-green' : 'badge-amber';
                    return `
                        <tr>
                            <td>${new Date(survey.date_sent).toLocaleDateString()}</td>
                            <td>${survey.customer}</td>
                            <td>${survey.wo_number}</td>
                            <td><span class="badge ${statusClass}">${survey.status}</span></td>
                            <td>${survey.score || '-'}</td>
                        </tr>
                    `;
                }).join('');
                document.getElementById('npsActivity').innerHTML = activityHTML || '<tr><td colspan="5" style="text-align:center; color:#94a3b8;">No recent activity</td></tr>';

                document.getElementById('activityBadge').textContent = `${activity.length} Recent`;
                document.getElementById('activityBadge').className = 'badge badge-green';

                // Load recommendations: Newly billed work orders (not yet surveyed)
                await loadNPSRecommendations(activity);

            } catch (error) {
                console.error('Error loading actions data:', error);
            }
        }

        // Load Employee Data
        async function loadEmployeeData() {
            console.log('loadEmployeeData: Starting...');

            // Employee data (from Team Members with emails.xlsx)
            const employees = [
                {name: 'Armando Triana-Cruz', code: 'CRUZA', title: 'Sat Avionics Tech II', qi: 'Y', rts: '2', sra: 'Y', stamps: 'QI 3019, SRI 1324', exp: 15, rating: 'R'},
                {name: 'Michael Hannas', code: 'HMICH', title: 'Sat Avionics Tech III', qi: 'Y', rts: '2', sra: 'Y', stamps: 'QI 2437, SRI 905', exp: 29, rating: 'A&P'},
                {name: 'Michael Huber', code: 'HUBEM', title: 'Crew Ldr - Sat Avionics', qi: 'Y', rts: '2', sra: 'Y', stamps: 'QI 2653, SRI 1070, SRI 641', exp: 10, rating: 'R'},
                {name: 'Julia Langford', code: 'LANJU', title: 'Sat Install Spec II', qi: 'Y', rts: '2', sra: 'Y', stamps: 'QI 3005, SRI 1207', exp: 12, rating: 'A'},
                {name: 'Sean R Macoomb', code: 'MACOS', title: 'Crew Ldr - Sat Avionics', qi: 'Y', rts: '2', sra: 'Y', stamps: 'QI 1111, SRI 415', exp: 32, rating: 'R'},
                {name: 'Juan R Medina', code: 'MEDIJ', title: 'Satellite Sheetmetal Tech III', qi: 'N', rts: '', sra: 'Y', stamps: 'SRI 1120', exp: 0, rating: ''},
                {name: 'Jose Noris', code: 'NORIJ', title: 'Crew Ldr - Sat Install', qi: 'Y', rts: '2', sra: 'Y', stamps: 'QI 3018, SRI 1338', exp: 6, rating: 'R'},
                {name: 'Kim D Owen', code: 'OWEKI', title: 'Customer Account Rep III - Sat', qi: 'N', rts: '', sra: 'Y', stamps: 'SRI 253', exp: 0, rating: ''},
                {name: 'Edduyn Pita', code: 'PITAE', title: 'Manager - Sat Avionics/Install', qi: 'Y', rts: '2', sra: 'Y', stamps: 'QI 1066, SRI 286', exp: 30, rating: 'RAP'},
                {name: 'Douglas Riera Guzman', code: 'RIERD', title: 'Sat Install Spec II', qi: 'N', rts: '', sra: 'Y', stamps: 'SRI 1254', exp: 0, rating: ''},
                {name: 'Kenneth O Smith', code: 'SMIKZ', title: 'Team Ldr - Sat Avionics', qi: 'Y', rts: '2', sra: 'Y', stamps: 'QI 1473, SRI 341', exp: 35, rating: 'R'},
                {name: 'Guillermo Tovar Sanchez', code: 'TOVAG', title: 'Sat Install Spec I', qi: 'N', rts: '', sra: 'N', stamps: 'SRI 1352', exp: 0, rating: ''},
                {name: 'Andrew Watson', code: 'WATAN', title: 'Sat Install Spec II', qi: 'N', rts: '', sra: 'Y', stamps: 'SRI 1412', exp: 0, rating: 'A&P'},
                {name: 'John Watson', code: 'WATJO', title: 'Team Ldr - Sat Install', qi: 'Y', rts: '2', sra: 'Y', stamps: 'QI 2258, SRI 714', exp: 11, rating: 'R'}
            ];

            // Team Roster
            const rosterHTML = employees.map(emp => {
                const qiBadge = emp.qi === 'Y' ? '<span class="badge badge-green">‚úì</span>' : '<span class="badge badge-gray">-</span>';
                const rtsBadge = emp.rts === '2' ? '<span class="badge badge-green">‚úì</span>' : '<span class="badge badge-gray">-</span>';
                const sraBadge = emp.sra === 'Y' ? '<span class="badge badge-green">‚úì</span>' : '<span class="badge badge-gray">-</span>';
                return `
                    <tr>
                        <td><strong>${emp.name}</strong></td>
                        <td>${emp.code}</td>
                        <td>${emp.title}</td>
                        <td>${qiBadge}</td>
                        <td>${rtsBadge}</td>
                        <td>${sraBadge}</td>
                        <td style="color:#94a3b8; font-size:0.85em;">${emp.stamps}</td>
                        <td>${emp.exp > 0 ? emp.exp : '-'}</td>
                        <td>${emp.rating || '-'}</td>
                    </tr>
                `;
            }).join('');
            document.getElementById('rosterTable').innerHTML = rosterHTML;

            // Load A/B Performance data from Supabase
            loadYTDAB();
            loadMonthlyAB();
            loadIndividualAB();

            console.log('loadEmployeeData: Complete');
        }

        // Load YTD A/B Performance
        async function loadYTDAB() {
            console.log('loadYTDAB: Starting...');

            try {
                // Fetch all time entries
                const response = await fetch(`${SUPABASE_URL}/rest/v1/time_entries?select=*`, {
                    headers: HEADERS
                });

                if (response.status === 404) {
                    document.getElementById('ytdABTable').innerHTML = '<tr><td colspan="6" style="text-align:center; color:#94a3b8;">No time data available yet</td></tr>';
                    return;
                }

                const timeEntries = await response.json();

                // Group by employee
                const employeeStats = {};

                timeEntries.forEach(entry => {
                    const empCode = entry.emp_code;
                    if (!empCode) return;

                    if (!employeeStats[empCode]) {
                        employeeStats[empCode] = {
                            name: entry.emp_name,
                            code: empCode,
                            totalHours: 0,
                            billableHours: 0
                        };
                    }

                    const hours = parseFloat(entry.hours) || 0;
                    employeeStats[empCode].totalHours += hours;

                    // Billable = Customer work orders (not Shop WOs)
                    if (entry.wo_type !== 'Shop' && hours > 0) {
                        employeeStats[empCode].billableHours += hours;
                    }
                });

                // Convert to array and calculate A/B
                const employeeData = Object.values(employeeStats).map(emp => {
                    const ab = emp.totalHours > 0 ? (emp.billableHours / emp.totalHours * 100) : 0;
                    return { ...emp, ab };
                });

                // Sort by A/B descending
                employeeData.sort((a, b) => b.ab - a.ab);

                // Generate HTML
                const ytdHTML = employeeData.map(emp => {
                    const abPct = emp.ab.toFixed(1);
                    let statusBadge = '';
                    let statusClass = '';

                    if (emp.ab >= 58.5) {
                        statusBadge = 'On Target';
                        statusClass = 'badge-green';
                    } else if (emp.ab >= 40) {
                        statusBadge = 'Below Target';
                        statusClass = 'badge-amber';
                    } else {
                        statusBadge = 'Critical';
                        statusClass = 'badge-red';
                    }

                    return `
                        <tr>
                            <td><strong>${emp.name}</strong></td>
                            <td>${emp.code}</td>
                            <td>${emp.totalHours.toFixed(1)}</td>
                            <td>${emp.billableHours.toFixed(1)}</td>
                            <td><strong>${abPct}%</strong></td>
                            <td><span class="badge ${statusClass}">${statusBadge}</span></td>
                        </tr>
                    `;
                }).join('');

                document.getElementById('ytdABTable').innerHTML = ytdHTML || '<tr><td colspan="6" style="text-align:center; color:#94a3b8;">No YTD data</td></tr>';

                console.log('loadYTDAB: Complete');
            } catch (error) {
                console.error('Error loading YTD A/B:', error);
                document.getElementById('ytdABTable').innerHTML = '<tr><td colspan="6" style="text-align:center; color:#ef4444;">Error loading YTD A/B data</td></tr>';
            }
        }

        // Load Monthly A/B Breakdown
        async function loadMonthlyAB() {
            console.log('loadMonthlyAB: Starting...');

            try {
                // Fetch all 2026 time entries
                const response = await fetch(`${SUPABASE_URL}/rest/v1/time_entries?select=*`, {
                    headers: HEADERS
                });

                if (response.status === 404) {
                    document.getElementById('monthlyABTable').innerHTML = '<tr><td colspan="7" style="text-align:center; color:#94a3b8;">No time data available yet</td></tr>';
                    return;
                }

                const timeEntries = await response.json();

                // Group by employee and month
                const employeeMonthly = {};

                timeEntries.forEach(entry => {
                    const empCode = entry.emp_code;
                    if (!empCode) return;

                    if (!employeeMonthly[empCode]) {
                        employeeMonthly[empCode] = {
                            name: entry.emp_name,
                            code: empCode,
                            jan: { total: 0, billable: 0 },
                            feb: { total: 0, billable: 0 }
                        };
                    }

                    const hours = parseFloat(entry.hours) || 0;
                    const entryDate = new Date(entry.entry_date);
                    const month = entryDate.getMonth() + 1; // 1 = Jan, 2 = Feb

                    if (month === 1) {
                        employeeMonthly[empCode].jan.total += hours;
                        if (entry.wo_type !== 'Shop' && hours > 0) {
                            employeeMonthly[empCode].jan.billable += hours;
                        }
                    } else if (month === 2) {
                        employeeMonthly[empCode].feb.total += hours;
                        if (entry.wo_type !== 'Shop' && hours > 0) {
                            employeeMonthly[empCode].feb.billable += hours;
                        }
                    }
                });

                // Convert to array
                const employeeData = Object.values(employeeMonthly);

                // Sort by February A/B percentage (descending - best to worst)
                employeeData.sort((a, b) => {
                    const febAB_a = a.feb.total > 0 ? (a.feb.billable / a.feb.total * 100) : 0;
                    const febAB_b = b.feb.total > 0 ? (b.feb.billable / b.feb.total * 100) : 0;
                    return febAB_b - febAB_a;
                });

                // Generate HTML
                const monthlyHTML = employeeData.map(emp => {
                    const janAB = emp.jan.total > 0 ? (emp.jan.billable / emp.jan.total * 100) : 0;
                    const febAB = emp.feb.total > 0 ? (emp.feb.billable / emp.feb.total * 100) : 0;

                    const janABColor = janAB >= 58.5 ? '#10b981' : janAB >= 40 ? '#f59e0b' : '#ef4444';
                    const febABColor = febAB >= 58.5 ? '#10b981' : febAB >= 40 ? '#f59e0b' : '#ef4444';

                    return `
                        <tr>
                            <td><strong>${emp.name}</strong></td>
                            <td>${emp.jan.total.toFixed(1)}</td>
                            <td>${emp.jan.billable.toFixed(1)}</td>
                            <td style="color:${janABColor}; font-weight:bold;">${janAB.toFixed(1)}%</td>
                            <td>${emp.feb.total.toFixed(1)}</td>
                            <td>${emp.feb.billable.toFixed(1)}</td>
                            <td style="color:${febABColor}; font-weight:bold;">${febAB.toFixed(1)}%</td>
                        </tr>
                    `;
                }).join('');

                document.getElementById('monthlyABTable').innerHTML = monthlyHTML || '<tr><td colspan="7" style="text-align:center; color:#94a3b8;">No monthly data</td></tr>';

                console.log('loadMonthlyAB: Complete');
            } catch (error) {
                console.error('Error loading monthly A/B:', error);
                document.getElementById('monthlyABTable').innerHTML = '<tr><td colspan="7" style="text-align:center; color:#ef4444;">Error loading monthly A/B data</td></tr>';
            }
        }

        // Load Individual A/B Performance
        async function loadIndividualAB() {
            console.log('loadIndividualAB: Starting...');

            try {
                // Calculate previous work day (skip weekends)
                const today = new Date();
                let previousWorkDay = new Date(today);
                previousWorkDay.setDate(previousWorkDay.getDate() - 1);

                // If previous day is Sunday (0), go back to Friday
                if (previousWorkDay.getDay() === 0) {
                    previousWorkDay.setDate(previousWorkDay.getDate() - 2);
                }
                // If previous day is Saturday (6), go back to Friday
                else if (previousWorkDay.getDay() === 6) {
                    previousWorkDay.setDate(previousWorkDay.getDate() - 1);
                }

                const previousWorkDayStr = previousWorkDay.toISOString().split('T')[0];
                const displayDate = previousWorkDay.toLocaleDateString('en-US', {
                    weekday: 'short',
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });

                // Update card title with actual date
                document.getElementById('individualABTitle').textContent = `‚è±Ô∏è Individual A/B Performance - ${displayDate}`;

                // Fetch time entries for previous work day
                const response = await fetch(`${SUPABASE_URL}/rest/v1/time_entries?entry_date=eq.${previousWorkDayStr}&select=*`, {
                    headers: HEADERS
                });

                if (response.status === 404) {
                    document.getElementById('individualABTable').innerHTML = '<tr><td colspan="7" style="text-align:center; color:#94a3b8;">No time data available yet</td></tr>';
                    return;
                }

                const timeEntries = await response.json();

                // Group by employee
                const employeeStats = {};
                const employeeWOs = {};

                timeEntries.forEach(entry => {
                    const empCode = entry.emp_code;
                    if (!empCode) return;

                    if (!employeeStats[empCode]) {
                        employeeStats[empCode] = {
                            name: entry.emp_name,
                            code: empCode,
                            totalHours: 0,
                            billableHours: 0
                        };
                        employeeWOs[empCode] = new Set();
                    }

                    const hours = parseFloat(entry.hours) || 0;
                    employeeStats[empCode].totalHours += hours;

                    // Billable = Customer work orders (not Shop WOs)
                    if (entry.wo_type !== 'Shop' && hours > 0) {
                        employeeStats[empCode].billableHours += hours;
                    }

                    // Track work orders
                    if (entry.wo_number && entry.wo_type !== 'Shop') {
                        employeeWOs[empCode].add(entry.wo_number);
                    }
                });

                // Convert to array and calculate A/B
                const employeeData = Object.values(employeeStats).map(emp => {
                    const ab = emp.totalHours > 0 ? (emp.billableHours / emp.totalHours * 100) : 0;
                    const woList = Array.from(employeeWOs[emp.code] || []).slice(0, 5); // First 5 WOs
                    return {
                        ...emp,
                        ab: ab,
                        workOrders: woList.join(', ') || 'Shop work only'
                    };
                });

                // Sort by A/B descending
                employeeData.sort((a, b) => b.ab - a.ab);

                // Generate HTML
                const abHTML = employeeData.map(emp => {
                    const abPct = emp.ab.toFixed(1);
                    let statusBadge = '';
                    let statusClass = '';

                    if (emp.ab >= 80) {
                        statusBadge = 'Excellent';
                        statusClass = 'badge-green';
                    } else if (emp.ab >= 60) {
                        statusBadge = 'Good';
                        statusClass = 'badge-green';
                    } else if (emp.ab >= 40) {
                        statusBadge = 'Fair';
                        statusClass = 'badge-amber';
                    } else {
                        statusBadge = 'Low';
                        statusClass = 'badge-red';
                    }

                    return `
                        <tr>
                            <td><strong>${emp.name}</strong></td>
                            <td>${emp.code}</td>
                            <td>${emp.totalHours.toFixed(1)}</td>
                            <td>${emp.billableHours.toFixed(1)}</td>
                            <td><strong>${abPct}%</strong></td>
                            <td><span class="badge ${statusClass}">${statusBadge}</span></td>
                            <td style="color:#94a3b8; font-size:0.85em;">${emp.workOrders}</td>
                        </tr>
                    `;
                }).join('');

                document.getElementById('individualABTable').innerHTML = abHTML || '<tr><td colspan="7" style="text-align:center; color:#94a3b8;">No employee time data for previous day</td></tr>';

                console.log('loadIndividualAB: Complete');
            } catch (error) {
                console.error('Error loading individual A/B:', error);
                document.getElementById('individualABTable').innerHTML = '<tr><td colspan="7" style="text-align:center; color:#ef4444;">Error loading A/B data</td></tr>';
            }
        }

        // Check for saved auth on page load
        console.log('Checking auth:', localStorage.getItem('denver_auth'));
        if (localStorage.getItem('denver_auth') === 'true') {
            console.log('Auto-login: User authenticated');
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            initializeEventListeners();
            showTab(tabs[0]);
            loadDashboardData();
        } else {
            console.log('Auto-login: No saved auth, showing login screen');
        }

        // Refresh data every 5 minutes
        setInterval(loadDashboardData, 5 * 60 * 1000);
    </script>
</body>
</html>